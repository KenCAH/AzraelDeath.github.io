<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>AC自动机基础例题 | NIRVANA</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="AC&amp;#x81EA;&amp;#x52A8;&amp;#x673A;(Aho-Corasick Automation)&amp;#x7528;&amp;#x4E8E;&amp;#x89E3;&amp;#x51B3;&amp;#x591A;&amp;#x6A21;&amp;#x5F0F;&amp;#x4E32;&amp;#x5339;&amp;#x914D;&amp;#x4E3B;&amp;#x4E32;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#x7ED9;&amp;#x6240;&amp;#x6709;&amp;#x6A">
<meta name="keywords" content="AC自动机,数据结构">
<meta property="og:type" content="article">
<meta property="og:title" content="AC自动机基础例题">
<meta property="og:url" content="http://yoursite.com/AC自动机基础例题/index.html">
<meta property="og:site_name" content="NIRVANA">
<meta property="og:description" content="AC&amp;#x81EA;&amp;#x52A8;&amp;#x673A;(Aho-Corasick Automation)&amp;#x7528;&amp;#x4E8E;&amp;#x89E3;&amp;#x51B3;&amp;#x591A;&amp;#x6A21;&amp;#x5F0F;&amp;#x4E32;&amp;#x5339;&amp;#x914D;&amp;#x4E3B;&amp;#x4E32;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#x7ED9;&amp;#x6240;&amp;#x6709;&amp;#x6A">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-11-09T08:51:13.130Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AC自动机基础例题">
<meta name="twitter:description" content="AC&amp;#x81EA;&amp;#x52A8;&amp;#x673A;(Aho-Corasick Automation)&amp;#x7528;&amp;#x4E8E;&amp;#x89E3;&amp;#x51B3;&amp;#x591A;&amp;#x6A21;&amp;#x5F0F;&amp;#x4E32;&amp;#x5339;&amp;#x914D;&amp;#x4E3B;&amp;#x4E32;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#x7ED9;&amp;#x6240;&amp;#x6709;&amp;#x6A">
  
    <link rel="alternative" href="/atom.xml" title="NIRVANA" type="application/atom+xml">
  
  
    <link rel="icon" href="http://chuantu.biz/t6/89/1507626502x2728279003.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
  
  

  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
</head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://chuantu.biz/t6/89/1507626502x2728279003.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Azrael_Death</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Veni Vidi Vici</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/AzraelDeath" title="github">github</a>
					        
								<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/azraeldeath" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/2-SAT/" style="font-size: 10.83px;">2-SAT</a> <a href="/tags/AC自动机/" style="font-size: 10.83px;">AC自动机</a> <a href="/tags/APIO/" style="font-size: 10px;">APIO</a> <a href="/tags/BZOJ/" style="font-size: 20px;">BZOJ</a> <a href="/tags/DFS序/" style="font-size: 10px;">DFS序</a> <a href="/tags/DP/" style="font-size: 15.83px;">DP</a> <a href="/tags/HDU/" style="font-size: 12.5px;">HDU</a> <a href="/tags/LCA/" style="font-size: 12.5px;">LCA</a> <a href="/tags/LG/" style="font-size: 12.5px;">LG</a> <a href="/tags/MST/" style="font-size: 12.5px;">MST</a> <a href="/tags/Manacher/" style="font-size: 10.83px;">Manacher</a> <a href="/tags/NOI/" style="font-size: 10.83px;">NOI</a> <a href="/tags/NOIp/" style="font-size: 13.33px;">NOIp</a> <a href="/tags/POI/" style="font-size: 10px;">POI</a> <a href="/tags/POJ/" style="font-size: 15px;">POJ</a> <a href="/tags/Tarjan/" style="font-size: 10.83px;">Tarjan</a> <a href="/tags/Trie/" style="font-size: 10px;">Trie</a> <a href="/tags/UVa/" style="font-size: 10px;">UVa</a> <a href="/tags/主席树/" style="font-size: 12.5px;">主席树</a> <a href="/tags/二分图/" style="font-size: 10px;">二分图</a> <a href="/tags/二分答案/" style="font-size: 10.83px;">二分答案</a> <a href="/tags/分块/" style="font-size: 10px;">分块</a> <a href="/tags/图论/" style="font-size: 17.5px;">图论</a> <a href="/tags/字符串/" style="font-size: 12.5px;">字符串</a> <a href="/tags/差分/" style="font-size: 10px;">差分</a> <a href="/tags/差分约束系统/" style="font-size: 10px;">差分约束系统</a> <a href="/tags/并查集/" style="font-size: 10.83px;">并查集</a> <a href="/tags/总结/" style="font-size: 16.67px;">总结</a> <a href="/tags/搜索/" style="font-size: 10px;">搜索</a> <a href="/tags/数位DP/" style="font-size: 10.83px;">数位DP</a> <a href="/tags/数据结构/" style="font-size: 18.33px;">数据结构</a> <a href="/tags/数论数学/" style="font-size: 11.67px;">数论数学</a> <a href="/tags/期望DP/" style="font-size: 10px;">期望DP</a> <a href="/tags/树套树/" style="font-size: 10.83px;">树套树</a> <a href="/tags/树状数组/" style="font-size: 11.67px;">树状数组</a> <a href="/tags/树链剖分/" style="font-size: 10px;">树链剖分</a> <a href="/tags/模拟/" style="font-size: 10.83px;">模拟</a> <a href="/tags/状压DP/" style="font-size: 10.83px;">状压DP</a> <a href="/tags/省选/" style="font-size: 19.17px;">省选</a> <a href="/tags/线段树/" style="font-size: 13.33px;">线段树</a> <a href="/tags/组合数学/" style="font-size: 10px;">组合数学</a> <a href="/tags/网络流/" style="font-size: 14.17px;">网络流</a> <a href="/tags/莫队/" style="font-size: 10.83px;">莫队</a> <a href="/tags/补集转换/" style="font-size: 10px;">补集转换</a> <a href="/tags/贪心/" style="font-size: 10px;">贪心</a> <a href="/tags/费用流/" style="font-size: 10px;">费用流</a> <a href="/tags/队列/" style="font-size: 10px;">队列</a> <a href="/tags/高斯消元/" style="font-size: 10px;">高斯消元</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/OwenOwl">OwenOwl</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/Joker_69">Joker</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://dangxingyu.com">DXY</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://309459245.lofter.com">YJQ</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/candy99">Candy</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/zig-zag">ZigZag</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://cxjyxx.me">cxjyxx_me</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.shuizilong.com">ShuiZiLong</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/kuangbin">KuangBin</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Azrael_Death</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://chuantu.biz/t6/89/1507626502x2728279003.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Azrael_Death</h1>
			</hgroup>
			
			<p class="header-subtitle">Veni Vidi Vici</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/AzraelDeath" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/azraeldeath" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-AC自动机基础例题" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/AC自动机基础例题/" class="article-date">
  	<time datetime="2017-07-13T16:00:00.000Z" itemprop="datePublished">2017-07-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      AC自动机基础例题
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AC自动机/">AC自动机</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据结构/">数据结构</a></li></ul>
	</div>

        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>AC&#x81EA;&#x52A8;&#x673A;(Aho-Corasick Automation)&#x7528;&#x4E8E;&#x89E3;&#x51B3;&#x591A;&#x6A21;&#x5F0F;&#x4E32;&#x5339;&#x914D;&#x4E3B;&#x4E32;&#x7684;&#x95EE;&#x9898;<br>&#x7ED9;&#x6240;&#x6709;&#x6A21;&#x5F0F;&#x4E32;&#x5199;&#x4E00;&#x4E2A;Trie&#xFF0C;&#x5728;Trie&#x4E0A;&#x8DD1;KMP&#xFF0C;&#x5176;&#x4E2D;KMP&#x7684;next&#x6570;&#x7EC4;&#x53D8;&#x6210;&#x4E86;AC&#x81EA;&#x52A8;&#x673A;&#x7684;Fail&#x6307;&#x9488;<br>&#x8BA1;&#x7B97;fail&#x548C;&#x8BA1;&#x7B97;next&#x4E00;&#x6837;&#xFF0C;&#x7528;dp&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x662F;&#x6811;&#x4E0A;dp<br>&#x539F;&#x7406;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#xFF0C;&#x4E0A;&#x6A21;&#x677F;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ACautomation</span> {</span></div><div class="line"><span class="keyword">private</span>:</div><div class="line">	<span class="keyword">int</span> cnt, root;</div><div class="line">	<span class="keyword">int</span> **child, *sta, *fail;</div><div class="line">	<span class="keyword">bool</span> *flag;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">	ACautomation(<span class="keyword">int</span> tot) {</div><div class="line">		cnt = root = <span class="number">1</span>;</div><div class="line">		sta = <span class="keyword">new</span> <span class="keyword">int</span>[tot+<span class="number">1</span>];</div><div class="line">		<span class="built_in">memset</span>(sta, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>)*(tot+<span class="number">1</span>));</div><div class="line">		fail = <span class="keyword">new</span> <span class="keyword">int</span>[tot+<span class="number">1</span>];</div><div class="line">		<span class="built_in">memset</span>(fail, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>)*(tot+<span class="number">1</span>));</div><div class="line">		flag = <span class="keyword">new</span> <span class="keyword">bool</span>[tot+<span class="number">1</span>];</div><div class="line">		<span class="built_in">memset</span>(flag, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">bool</span>)*(tot+<span class="number">1</span>));</div><div class="line">		child = <span class="keyword">new</span> <span class="keyword">int</span>*[tot+<span class="number">1</span>];</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tot; i++) {</div><div class="line">			child[i] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">26</span>];</div><div class="line">			<span class="built_in">memset</span>(child[i], <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>)*<span class="number">26</span>);</div><div class="line">		}</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)	child[<span class="number">0</span>][i] = <span class="number">1</span>;</div><div class="line">	}</div><div class="line">	~ACautomation() {</div><div class="line">		<span class="keyword">delete</span>[] sta;</div><div class="line">		<span class="keyword">delete</span>[] fail;</div><div class="line">		<span class="keyword">delete</span>[] flag;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</div><div class="line">			<span class="keyword">delete</span>[] child[i];</div><div class="line">		<span class="keyword">delete</span>[] child;</div><div class="line">	}</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span>&amp; s)</span> </span>{</div><div class="line">		<span class="keyword">int</span> cur = <span class="number">1</span>, i;</div><div class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; s.length(); cur = child[cur][s[i++]-<span class="string">&apos;a&apos;</span>])</div><div class="line">			<span class="keyword">if</span> (!child[cur][s[i]-<span class="string">&apos;a&apos;</span>])	child[cur][s[i]-<span class="string">&apos;a&apos;</span>] = ++cnt;</div><div class="line">		sta[cur]++;</div><div class="line">	}</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setFail</span><span class="params">()</span> </span>{</div><div class="line">		<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;</div><div class="line">		que.push(<span class="number">1</span>);</div><div class="line">		<span class="keyword">while</span> (!que.empty()) {</div><div class="line">			<span class="keyword">int</span> u = que.front();</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) {</div><div class="line">				<span class="keyword">if</span> (child[u][i]) {</div><div class="line">					fail[child[u][i]] = child[fail[u]][i];</div><div class="line">					que.push(child[u][i]);</div><div class="line">				} <span class="keyword">else</span> {</div><div class="line">					child[u][i] = child[fail[u]][i];</div><div class="line">				}</div><div class="line">			}</div><div class="line">			que.pop();</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="built_in">string</span>&amp; s)</span> </span>{</div><div class="line">		<span class="keyword">int</span> ret = <span class="number">0</span>, cur = <span class="number">1</span>, index;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) {</div><div class="line">			flag[cur] = <span class="literal">true</span>;</div><div class="line">			index = s[i]-<span class="string">&apos;a&apos;</span>;</div><div class="line">			<span class="keyword">while</span> (!child[cur][index])	cur = fail[cur];</div><div class="line">			cur = child[cur][index];</div><div class="line">			<span class="keyword">if</span> (flag[cur])	<span class="keyword">continue</span>;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = cur; j; j = fail[j]) {</div><div class="line">				ret += sta[j];</div><div class="line">				sta[j] = <span class="number">0</span>;</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">	}</div><div class="line">};</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</div><div class="line">	<span class="keyword">int</span> n;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; n;</div><div class="line">	<span class="function">ACautomation <span class="title">T</span><span class="params">(n*<span class="number">50</span>)</span></span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) {</div><div class="line">		<span class="built_in">string</span> s;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; s;</div><div class="line">		T.insert(s);</div><div class="line">	}</div><div class="line">	T.setFail();</div><div class="line">	<span class="built_in">string</span> str;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; str;</div><div class="line">	<span class="built_in">cout</span> &lt;&lt; T.query(str);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x662F;&#x672C;&#x4EBA;&#x7B2C;&#x4E00;&#x6B21;&#x5199;AC&#x81EA;&#x52A8;&#x673A;&#x5C01;&#x88C5;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5F88;&#x62D9;&#x52A3;&#x3002;&#x7531;&#x4E8E;&#x6211;&#x5199;Trie&#x6811;&#x4E00;&#x76F4;&#x628A;&#x6839;&#x8282;&#x70B9;&#x8BBE;&#x4E3A;1&#x53F7;&#xFF0C;&#x6240;&#x4EE5;&#x60F3;&#x51FA;&#x628A;0&#x53F7;&#x8282;&#x70B9;&#x6240;&#x6709;&#x513F;&#x5B50;&#x90FD;&#x6307;&#x5411;1&#xFF0C;&#x8FD9;&#x6837;&#x5982;&#x679C;fail&#x6307;&#x56DE;&#x5230;0&#x7684;&#x65F6;&#x5019;&#xFF0C;child[u][i]&#x90FD;&#x4F1A;&#x5C06;&#x5176;&#x91CD;&#x65B0;&#x6307;&#x5411;&#x6839;&#x8282;&#x70B9;1&#xFF0C;&#x8FD9;&#x6837;&#x601D;&#x8003;&#x4F1A;&#x7B80;&#x5355;&#x4E00;&#x4E9B;&#x3002;&#x4F46;&#x662F;&#x6709;&#x65F6;&#x5019;&#x8981;TLE</p>
<p>&#x6211;&#x505A;&#x7684;&#x7B2C;&#x4E00;&#x9053;AC&#x81EA;&#x52A8;&#x673A;&#x9898;&#x76EE;&#x662F;HDU2222&#xFF0C;&#x8FD9;&#x662F;&#x88F8;&#x7684;&#x6A21;&#x677F;&#xFF0C;&#x6570;&#x636E;&#x4E5F;&#x5F88;&#x6C34;</p>
<blockquote>
<p>&#x3010;HDU2222&#x3011; Keywords Search<br>Time Limit: 2000/1000 MS (Java/Others)<br>Memory Limit: 131072/131072 K (Java/Others)</p>
<p>Problem Description<br>In the modern time, Search engine came into the life of everybody like Google, Baidu, etc.<br>Wiskey also wants to bring this feature to his image retrieval system.<br>Every image have a long description, when users type some keywords to find the image, the system will match the keywords with description of image and show the image which the most keywords be matched.<br>To simplify the problem, giving you a description of image, and some keywords, you should tell me how many keywords will be match.</p>
<p>Input<br>First line will contain one integer means how many cases will follow by.<br>Each case will contain two integers N means the number of keywords and N keywords follow. (N &lt;= 10000)<br>Each keyword will only contains characters &#x2018;a&#x2019;-&#x2018;z&#x2019;, and the length will be not longer than 50.<br>The last line is the description, and the length will be not longer than 1000000.<br>Output<br>Print how many keywords are contained in the description.</p>
<p>Sample Input<br>1<br>5<br>she<br>he<br>say<br>shr<br>her<br>yasherhs<br>Sample Output<br>3</p>
</blockquote>
<p>AC&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LETTER 500000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> trie[MAX_LETTER+<span class="number">5</span>][<span class="number">26</span>], tag[MAX_LETTER+<span class="number">5</span>], cnt;</div><div class="line"><span class="keyword">int</span> fail[MAX_LETTER+<span class="number">5</span>], flag[MAX_LETTER+<span class="number">5</span>], que[MAX_LETTER+<span class="number">5</span>];</div><div class="line"><span class="keyword">char</span> s[<span class="number">55</span>], str[<span class="number">1000005</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>{</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s);</div><div class="line">	<span class="keyword">int</span> cur, i, l = <span class="built_in">strlen</span>(s);</div><div class="line">	<span class="keyword">for</span> (cur = <span class="number">1</span>, i = <span class="number">0</span>; i &lt; l; cur = trie[cur][s[i++]-<span class="string">&apos;a&apos;</span>])</div><div class="line">		<span class="keyword">if</span> (!trie[cur][s[i]-<span class="string">&apos;a&apos;</span>])	trie[cur][s[i]-<span class="string">&apos;a&apos;</span>] = ++cnt;</div><div class="line">	tag[cur]++;</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">()</span> </span>{</div><div class="line">	<span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">1</span>;</div><div class="line">	que[head] = <span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span> (head &lt; tail) {</div><div class="line">		<span class="keyword">int</span> u = que[head++];</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) {</div><div class="line">			<span class="keyword">if</span> (trie[u][i]) {</div><div class="line">				que[tail++] = trie[u][i];</div><div class="line">				fail[trie[u][i]] = trie[fail[u]][i];</div><div class="line">			} <span class="keyword">else</span> {</div><div class="line">				trie[u][i] = trie[fail[u]][i];</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>{</div><div class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>, cur = <span class="number">1</span>, index;</div><div class="line">	<span class="keyword">int</span> len = <span class="built_in">strlen</span>(str);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) {</div><div class="line">		flag[cur] = <span class="number">1</span>;</div><div class="line">		index = str[i]-<span class="string">&apos;a&apos;</span>;</div><div class="line">		<span class="keyword">while</span> (!trie[cur][index])	cur = fail[cur];</div><div class="line">		cur = trie[cur][index];</div><div class="line">		<span class="keyword">if</span> (flag[cur])	<span class="keyword">continue</span>;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = cur; j; j = fail[j]) {</div><div class="line">			ret += tag[j];</div><div class="line">			tag[j] = <span class="number">0</span>;</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ret);</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</div><div class="line">	<span class="keyword">int</span> T, n;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)	trie[<span class="number">0</span>][i] = <span class="number">1</span>;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</div><div class="line">	<span class="keyword">while</span> (T--) {</div><div class="line">		cnt = <span class="number">1</span>;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)	insert();</div><div class="line">		BFS();</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str);</div><div class="line">		query();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; i++) {</div><div class="line">			tag[i] = fail[i] = flag[i] = <span class="number">0</span>;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">26</span>; j++)</div><div class="line">				trie[i][j] = <span class="number">0</span>;</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>HDU3065&#x548C;&#x8FD9;&#x9053;&#x9898;&#x5F88;&#x50CF;&#xFF0C;&#x4E5F;&#x662F;&#x51E0;&#x4E4E;&#x88F8;&#x7684;&#x6A21;&#x677F;<br>&gt;<br>&#x3010;HDU3065&#x3011;&#x75C5;&#x6BD2;&#x4FB5;&#x88AD;&#x6301;&#x7EED;&#x4E2D;<br>Time Limit: 2000/1000 MS (Java/Others)<br>Memory Limit: 32768/32768 K (Java/Others)<br>&gt;<br>Problem Description<br>&#x5C0F;t&#x975E;&#x5E38;&#x611F;&#x8C22;&#x5927;&#x5BB6;&#x5E2E;&#x5FD9;&#x89E3;&#x51B3;&#x4E86;&#x4ED6;&#x7684;&#x4E0A;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x7136;&#x800C;&#x75C5;&#x6BD2;&#x4FB5;&#x88AD;&#x6301;&#x7EED;&#x4E2D;&#x3002;&#x5728;&#x5C0F;t&#x7684;&#x4E0D;&#x61C8;&#x52AA;&#x529B;&#x4E0B;&#xFF0C;&#x4ED6;&#x53D1;&#x73B0;&#x4E86;&#x7F51;&#x8DEF;&#x4E2D;&#x7684;&#x201C;&#x4E07;&#x6076;&#x4E4B;&#x6E90;&#x201D;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5E9E;&#x5927;&#x7684;&#x75C5;&#x6BD2;&#x7F51;&#x7AD9;&#xFF0C;&#x4ED6;&#x6709;&#x7740;&#x597D;&#x591A;&#x597D;&#x591A;&#x7684;&#x75C5;&#x6BD2;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x7F51;&#x7AD9;&#x5305;&#x542B;&#x7684;&#x75C5;&#x6BD2;&#x5F88;&#x5947;&#x602A;&#xFF0C;&#x8FD9;&#x4E9B;&#x75C5;&#x6BD2;&#x7684;&#x7279;&#x5F81;&#x7801;&#x5F88;&#x77ED;&#xFF0C;&#x800C;&#x4E14;&#x53EA;&#x5305;&#x542B;&#x201C;&#x82F1;&#x6587;&#x5927;&#x5199;&#x5B57;&#x7B26;&#x201D;&#x3002;&#x5F53;&#x7136;&#x5C0F;t&#x597D;&#x60F3;&#x597D;&#x60F3;&#x4E3A;&#x6C11;&#x9664;&#x5BB3;&#xFF0C;&#x4F46;&#x662F;&#x5C0F;t&#x4ECE;&#x6765;&#x4E0D;&#x6253;&#x6CA1;&#x6709;&#x51C6;&#x5907;&#x7684;&#x6218;&#x4E89;&#x3002;&#x77E5;&#x5DF1;&#x77E5;&#x5F7C;&#xFF0C;&#x767E;&#x6218;&#x4E0D;&#x6B86;&#xFF0C;&#x5C0F;t&#x9996;&#x5148;&#x8981;&#x505A;&#x7684;&#x662F;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;&#x75C5;&#x6BD2;&#x7F51;&#x7AD9;&#x7279;&#x5F81;&#xFF1A;&#x5305;&#x542B;&#x591A;&#x5C11;&#x4E0D;&#x540C;&#x7684;&#x75C5;&#x6BD2;&#xFF0C;&#x6BCF;&#x79CD;&#x75C5;&#x6BD2;&#x51FA;&#x73B0;&#x4E86;&#x591A;&#x5C11;&#x6B21;&#x3002;&#x5927;&#x5BB6;&#x80FD;&#x518D;&#x5E2E;&#x5E2E;&#x4ED6;&#x5417;&#xFF1F;<br>&gt;<br>Input<br>&#x7B2C;&#x4E00;&#x884C;&#xFF0C;&#x4E00;&#x4E2A;&#x6574;&#x6570;N&#xFF08;1&lt;=N&lt;=1000&#xFF09;&#xFF0C;&#x8868;&#x793A;&#x75C5;&#x6BD2;&#x7279;&#x5F81;&#x7801;&#x7684;&#x4E2A;&#x6570;&#x3002;<br>&#x63A5;&#x4E0B;&#x6765;N&#x884C;&#xFF0C;&#x6BCF;&#x884C;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x75C5;&#x6BD2;&#x7279;&#x5F81;&#x7801;&#xFF0C;&#x7279;&#x5F81;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x957F;&#x5EA6;&#x5728;1&#x2014;50&#x4E4B;&#x95F4;&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x5305;&#x542B;&#x201C;&#x82F1;&#x6587;&#x5927;&#x5199;&#x5B57;&#x7B26;&#x201D;&#x3002;&#x4EFB;&#x610F;&#x4E24;&#x4E2A;&#x75C5;&#x6BD2;&#x7279;&#x5F81;&#x7801;&#xFF0C;&#x4E0D;&#x4F1A;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x3002;<br>&#x5728;&#x8FD9;&#x4E4B;&#x540E;&#x4E00;&#x884C;&#xFF0C;&#x8868;&#x793A;&#x201C;&#x4E07;&#x6076;&#x4E4B;&#x6E90;&#x201D;&#x7F51;&#x7AD9;&#x6E90;&#x7801;&#xFF0C;&#x6E90;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x957F;&#x5EA6;&#x5728;2000000&#x4E4B;&#x5185;&#x3002;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x5B57;&#x7B26;&#x90FD;&#x662F;ASCII&#x7801;&#x53EF;&#x89C1;&#x5B57;&#x7B26;&#xFF08;&#x4E0D;&#x5305;&#x62EC;&#x56DE;&#x8F66;&#xFF09;&#x3002;<br>Output<br>&#x6309;&#x4EE5;&#x4E0B;&#x683C;&#x5F0F;&#x6BCF;&#x884C;&#x4E00;&#x4E2A;&#xFF0C;&#x8F93;&#x51FA;&#x6BCF;&#x4E2A;&#x75C5;&#x6BD2;&#x51FA;&#x73B0;&#x6B21;&#x6570;&#x3002;&#x672A;&#x51FA;&#x73B0;&#x7684;&#x75C5;&#x6BD2;&#x4E0D;&#x9700;&#x8981;&#x8F93;&#x51FA;&#x3002;<br>&#x75C5;&#x6BD2;&#x7279;&#x5F81;&#x7801;: &#x51FA;&#x73B0;&#x6B21;&#x6570;<br>&#x5192;&#x53F7;&#x540E;&#x6709;&#x4E00;&#x4E2A;&#x7A7A;&#x683C;&#xFF0C;&#x6309;&#x75C5;&#x6BD2;&#x7279;&#x5F81;&#x7801;&#x7684;&#x8F93;&#x5165;&#x987A;&#x5E8F;&#x8FDB;&#x884C;&#x8F93;&#x51FA;&#x3002;<br>&gt;<br>Sample Input<br>3<br>AA<br>BB<br>CC<br>ooxxCC%dAAAoen&#x2026;.END<br>Sample Output<br>AA: 2<br>CC: 1<br>&gt;<br>Hint<br>&#x9898;&#x76EE;&#x63CF;&#x8FF0;&#x4E2D;&#x6CA1;&#x6709;&#x88AB;&#x63D0;&#x53CA;&#x7684;&#x6240;&#x6709;&#x60C5;&#x51B5;&#x90FD;&#x5E94;&#x8BE5;&#x8FDB;&#x884C;&#x8003;&#x8651;&#x3002;&#x6BD4;&#x5982;&#x4E24;&#x4E2A;&#x75C5;&#x6BD2;&#x7279;&#x5F81;&#x7801;&#x53EF;&#x80FD;&#x6709;&#x76F8;&#x4E92;&#x5305;&#x542B;&#x6216;&#x8005;&#x6709;&#x91CD;&#x53E0;&#x7684;&#x7279;&#x5F81;&#x7801;&#x6BB5;&#x3002;<br>&#x8BA1;&#x6570;&#x7B56;&#x7565;&#x4E5F;&#x53EF;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x4ECE;Sample&#x4E2D;&#x63A8;&#x6D4B;&#x3002;</p>
<p>AC&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LETTER 100000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DICNUM 26</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, cnt;</div><div class="line"><span class="keyword">int</span> child[MAX_LETTER+<span class="number">5</span>][DICNUM], id[MAX_LETTER+<span class="number">5</span>], fail[MAX_LETTER+<span class="number">5</span>], ans[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> que[MAX_LETTER+<span class="number">5</span>];</div><div class="line"><span class="keyword">char</span> s[<span class="number">2000005</span>], dic[<span class="number">1005</span>][<span class="number">55</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</div><div class="line">	cnt = <span class="number">1</span>;</div><div class="line">	<span class="built_in">memset</span>(child, <span class="number">0</span>, <span class="keyword">sizeof</span>(child));</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++)	child[<span class="number">0</span>][i] = <span class="number">1</span>;</div><div class="line">	<span class="built_in">memset</span>(id, <span class="number">0</span>, <span class="keyword">sizeof</span>(id));</div><div class="line">	<span class="built_in">memset</span>(fail, <span class="number">0</span>, <span class="keyword">sizeof</span>(fail));</div><div class="line">	<span class="built_in">memset</span>(ans, <span class="number">0</span>, <span class="keyword">sizeof</span>(ans));</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>{</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++) {</div><div class="line">		<span class="keyword">int</span> cur = <span class="number">1</span>, l = <span class="built_in">strlen</span>(dic[j]);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; l; cur = child[cur][dic[j][i++]-<span class="string">&apos;A&apos;</span>])</div><div class="line">			<span class="keyword">if</span> (!child[cur][dic[j][i]-<span class="string">&apos;A&apos;</span>])	child[cur][dic[j][i]-<span class="string">&apos;A&apos;</span>] = ++cnt;</div><div class="line">		id[cur] = j;</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">setFail</span><span class="params">()</span> </span>{</div><div class="line">	<span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">1</span>;</div><div class="line">	que[head] = <span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span> (head &lt; tail) {</div><div class="line">		<span class="keyword">int</span> u = que[head++];</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++) {</div><div class="line">			<span class="keyword">if</span> (child[u][i]) {</div><div class="line">				que[tail++] = child[u][i];</div><div class="line">				<span class="keyword">int</span> cur = fail[u];</div><div class="line">				<span class="keyword">while</span> (!child[cur][i])	cur = fail[cur];</div><div class="line">				fail[child[u][i]] = child[cur][i];</div><div class="line">			} <span class="keyword">else</span> {</div><div class="line">				child[u][i] = child[fail[u]][i];</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>{</div><div class="line">	<span class="keyword">int</span> cur = <span class="number">1</span>, index, l = <span class="built_in">strlen</span>(s);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; l; i++) {</div><div class="line">		index = s[i]-<span class="string">&apos;A&apos;</span>;</div><div class="line">		<span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; <span class="number">25</span>) {</div><div class="line">			cur = <span class="number">1</span>;</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">			<span class="keyword">while</span> (!child[cur][index])	cur = fail[cur];</div><div class="line">			cur = child[cur][index];</div><div class="line">		}</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = cur; j; j = fail[j])</div><div class="line">			<span class="keyword">if</span> (id[j])</div><div class="line">				ans[id[j]]++;</div><div class="line">	}</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</div><div class="line">	<span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) != EOF) {</div><div class="line">		init();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, dic[i]);</div><div class="line">		insert();</div><div class="line">		setFail();</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s);</div><div class="line">		query();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</div><div class="line">			<span class="keyword">if</span> (ans[i])</div><div class="line">				<span class="built_in">printf</span>(<span class="string">&quot;%s: %d\n&quot;</span>, dic[i], ans[i]);</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E24;&#x9053;&#x9898;&#x7528;&#x6211;&#x62D9;&#x52A3;&#x7684;&#x5199;&#x6CD5;&#x8FD8;&#x53EF;&#x4EE5;&#x8FC7;&#xFF0C;&#x4F46;&#x662F;HDU2896&#x5C31;&#x8FC7;&#x4E0D;&#x4E86;</p>
<blockquote>
<p>&#x3010;HDU2896&#x3011;&#x75C5;&#x6BD2;&#x4FB5;&#x88AD;<br>Time Limit: 2000/1000 MS (Java/Others)<br>Memory Limit: 32768/32768 K (Java/Others)</p>
<p>Problem Description<br>&#x5F53;&#x592A;&#x9633;&#x7684;&#x5149;&#x8F89;&#x9010;&#x6E10;&#x88AB;&#x6708;&#x4EAE;&#x906E;&#x853D;&#xFF0C;&#x4E16;&#x754C;&#x5931;&#x53BB;&#x4E86;&#x5149;&#x660E;&#xFF0C;&#x5927;&#x5730;&#x8FCE;&#x6765;&#x6700;&#x9ED1;&#x6697;&#x7684;&#x65F6;&#x523B;&#x3002;&#x3002;&#x3002;&#x3002;&#x5728;&#x8FD9;&#x6837;&#x7684;&#x65F6;&#x523B;&#xFF0C;&#x4EBA;&#x4EEC;&#x5374;&#x5F02;&#x5E38;&#x5174;&#x594B;&#x2014;&#x2014;&#x6211;&#x4EEC;&#x80FD;&#x5728;&#x6709;&#x751F;&#x4E4B;&#x5E74;&#x770B;&#x5230;500&#x5E74;&#x4E00;&#x9047;&#x7684;&#x4E16;&#x754C;&#x5947;&#x89C2;&#xFF0C;&#x90A3;&#x662F;&#x591A;&#x4E48;&#x5E78;&#x798F;&#x7684;&#x4E8B;&#x513F;&#x554A;~~<br>&#x4F46;&#x7F51;&#x8DEF;&#x4E0A;&#x603B;&#x6709;&#x90A3;&#x4E48;&#x4E9B;&#x7F51;&#x7AD9;&#xFF0C;&#x5F00;&#x59CB;&#x501F;&#x7740;&#x6C11;&#x4F17;&#x7684;&#x597D;&#x5947;&#x5FC3;&#xFF0C;&#x6253;&#x7740;&#x4ECB;&#x7ECD;&#x65E5;&#x98DF;&#x7684;&#x65D7;&#x53F7;&#xFF0C;&#x5927;&#x8086;&#x4F20;&#x64AD;&#x75C5;&#x6BD2;&#x3002;&#x5C0F;t&#x4E0D;&#x5E78;&#x6210;&#x4E3A;&#x53D7;&#x5BB3;&#x8005;&#x4E4B;&#x4E00;&#x3002;&#x5C0F;t&#x5982;&#x6B64;&#x751F;&#x6C14;&#xFF0C;&#x4ED6;&#x51B3;&#x5B9A;&#x8981;&#x628A;&#x4E16;&#x754C;&#x4E0A;&#x6240;&#x6709;&#x5E26;&#x75C5;&#x6BD2;&#x7684;&#x7F51;&#x7AD9;&#x90FD;&#x627E;&#x51FA;&#x6765;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x8C01;&#x90FD;&#x77E5;&#x9053;&#x8FD9;&#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x7684;&#x3002;&#x5C0F;t&#x5374;&#x6267;&#x610F;&#x8981;&#x5B8C;&#x6210;&#x8FD9;&#x4E0D;&#x80FD;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x4ED6;&#x8BF4;&#xFF1A;&#x201C;&#x5B50;&#x5B50;&#x5B59;&#x5B59;&#x65E0;&#x7A77;&#x532E;&#x4E5F;&#xFF01;&#x201D;&#xFF08;&#x611A;&#x516C;&#x540E;&#x7EE7;&#x6709;&#x4EBA;&#x4E86;&#xFF09;&#x3002;<br>&#x4E07;&#x4E8B;&#x5F00;&#x5934;&#x96BE;&#xFF0C;&#x5C0F;t&#x6536;&#x96C6;&#x4E86;&#x597D;&#x591A;&#x75C5;&#x6BD2;&#x7684;&#x7279;&#x5F81;&#x7801;&#xFF0C;&#x53C8;&#x6536;&#x96C6;&#x4E86;&#x4E00;&#x6279;&#x8BE1;&#x5F02;&#x7F51;&#x7AD9;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x4ED6;&#x60F3;&#x77E5;&#x9053;&#x8FD9;&#x4E9B;&#x7F51;&#x7AD9;&#x4E2D;&#x54EA;&#x4E9B;&#x662F;&#x6709;&#x75C5;&#x6BD2;&#x7684;&#xFF0C;&#x53C8;&#x662F;&#x5E26;&#x4E86;&#x600E;&#x6837;&#x7684;&#x75C5;&#x6BD2;&#x5462;&#xFF1F;&#x987A;&#x4FBF;&#x8FD8;&#x60F3;&#x77E5;&#x9053;&#x4ED6;&#x5230;&#x5E95;&#x6536;&#x96C6;&#x4E86;&#x591A;&#x5C11;&#x5E26;&#x75C5;&#x6BD2;&#x7684;&#x7F51;&#x7AD9;&#x3002;&#x8FD9;&#x65F6;&#x5019;&#x4ED6;&#x5374;&#x4E0D;&#x77E5;&#x9053;&#x4F55;&#x4ECE;&#x4E0B;&#x624B;&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x60F3;&#x8BF7;&#x5927;&#x5BB6;&#x5E2E;&#x5E2E;&#x5FD9;&#x3002;&#x5C0F;t&#x53C8;&#x662F;&#x4E2A;&#x6025;&#x6027;&#x5B50;&#x54E6;&#xFF0C;&#x6240;&#x4EE5;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x8D8A;&#x5FEB;&#x8D8A;&#x597D;&#x54E6;~~</p>
<p>Input<br>&#x7B2C;&#x4E00;&#x884C;&#xFF0C;&#x4E00;&#x4E2A;&#x6574;&#x6570;N&#xFF08;1&lt;=N&lt;=500&#xFF09;&#xFF0C;&#x8868;&#x793A;&#x75C5;&#x6BD2;&#x7279;&#x5F81;&#x7801;&#x7684;&#x4E2A;&#x6570;&#x3002;<br>&#x63A5;&#x4E0B;&#x6765;N&#x884C;&#xFF0C;&#x6BCF;&#x884C;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x75C5;&#x6BD2;&#x7279;&#x5F81;&#x7801;&#xFF0C;&#x7279;&#x5F81;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x957F;&#x5EA6;&#x5728;20&#x2014;200&#x4E4B;&#x95F4;&#x3002;<br>&#x6BCF;&#x4E2A;&#x75C5;&#x6BD2;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x7F16;&#x53F7;&#xFF0C;&#x4F9D;&#x6B64;&#x4E3A;1&#x2014;N&#x3002;<br>&#x4E0D;&#x540C;&#x7F16;&#x53F7;&#x7684;&#x75C5;&#x6BD2;&#x7279;&#x5F81;&#x7801;&#x4E0D;&#x4F1A;&#x76F8;&#x540C;&#x3002;<br>&#x5728;&#x8FD9;&#x4E4B;&#x540E;&#x4E00;&#x884C;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x6574;&#x6570;M&#xFF08;1&lt;=M&lt;=1000&#xFF09;&#xFF0C;&#x8868;&#x793A;&#x7F51;&#x7AD9;&#x6570;&#x3002;<br>&#x63A5;&#x4E0B;&#x6765;M&#x884C;&#xFF0C;&#x6BCF;&#x884C;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x7F51;&#x7AD9;&#x6E90;&#x7801;&#xFF0C;&#x6E90;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x957F;&#x5EA6;&#x5728;7000&#x2014;10000&#x4E4B;&#x95F4;&#x3002;<br>&#x6BCF;&#x4E2A;&#x7F51;&#x7AD9;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x7F16;&#x53F7;&#xFF0C;&#x4F9D;&#x6B64;&#x4E3A;1&#x2014;M&#x3002;<br>&#x4EE5;&#x4E0A;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x5B57;&#x7B26;&#x90FD;&#x662F;ASCII&#x7801;&#x53EF;&#x89C1;&#x5B57;&#x7B26;&#xFF08;&#x4E0D;&#x5305;&#x62EC;&#x56DE;&#x8F66;&#xFF09;&#x3002;<br>Output<br>&#x4F9D;&#x6B21;&#x6309;&#x5982;&#x4E0B;&#x683C;&#x5F0F;&#x8F93;&#x51FA;&#x6309;&#x7F51;&#x7AD9;&#x7F16;&#x53F7;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x8F93;&#x51FA;&#xFF0C;&#x5E26;&#x75C5;&#x6BD2;&#x7684;&#x7F51;&#x7AD9;&#x7F16;&#x53F7;&#x548C;&#x5305;&#x542B;&#x75C5;&#x6BD2;&#x7F16;&#x53F7;&#xFF0C;&#x6BCF;&#x884C;&#x4E00;&#x4E2A;&#x542B;&#x6BD2;&#x7F51;&#x7AD9;&#x4FE1;&#x606F;&#x3002;<br>web &#x7F51;&#x7AD9;&#x7F16;&#x53F7;: &#x75C5;&#x6BD2;&#x7F16;&#x53F7; &#x75C5;&#x6BD2;&#x7F16;&#x53F7; &#x2026;<br>&#x5192;&#x53F7;&#x540E;&#x6709;&#x4E00;&#x4E2A;&#x7A7A;&#x683C;&#xFF0C;&#x75C5;&#x6BD2;&#x7F16;&#x53F7;&#x6309;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x6392;&#x5217;&#xFF0C;&#x4E24;&#x4E2A;&#x75C5;&#x6BD2;&#x7F16;&#x53F7;&#x4E4B;&#x95F4;&#x7528;&#x4E00;&#x4E2A;&#x7A7A;&#x683C;&#x9694;&#x5F00;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7F51;&#x7AD9;&#x5305;&#x542B;&#x75C5;&#x6BD2;&#xFF0C;&#x75C5;&#x6BD2;&#x6570;&#x4E0D;&#x4F1A;&#x8D85;&#x8FC7;3&#x4E2A;&#x3002;<br>&#x6700;&#x540E;&#x4E00;&#x884C;&#x8F93;&#x51FA;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x4E0B;&#x683C;&#x5F0F;<br>total: &#x5E26;&#x75C5;&#x6BD2;&#x7F51;&#x7AD9;&#x6570;<br>&#x5192;&#x53F7;&#x540E;&#x6709;&#x4E00;&#x4E2A;&#x7A7A;&#x683C;&#x3002;</p>
<p>Sample Input<br>3<br>aaa<br>bbb<br>ccc<br>2<br>aaabbbccc<br>bbaacc<br>Sample Output<br>web 1: 1 2 3<br>total: 1</p>
</blockquote>
<p>AC&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AC</span> {</span></div><div class="line">	<span class="keyword">int</span> child[<span class="number">200</span>*<span class="number">500</span>+<span class="number">500</span>][<span class="number">128</span>], fail[<span class="number">200</span>*<span class="number">500</span>+<span class="number">500</span>], end[<span class="number">200</span>*<span class="number">500</span>+<span class="number">500</span>];</div><div class="line">	<span class="keyword">int</span> root, cnt;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">()</span> </span>{</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">128</span>; i++)	child[cnt][i] = <span class="number">-1</span>;</div><div class="line">		end[cnt++] = <span class="number">-1</span>;</div><div class="line">		<span class="keyword">return</span> cnt<span class="number">-1</span>;</div><div class="line">	}</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</div><div class="line">		cnt = <span class="number">0</span>;</div><div class="line">		root = newnode();</div><div class="line">	}</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">char</span> s[])</span> </span>{</div><div class="line">		<span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), cur = root;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; cur = child[cur][s[i++]])</div><div class="line">			<span class="keyword">if</span> (child[cur][s[i]] == <span class="number">-1</span>)	child[cur][s[i]] = newnode();</div><div class="line">		end[cur] = id;</div><div class="line">	}</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setFail</span><span class="params">()</span> </span>{</div><div class="line">		<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;</div><div class="line">		fail[root] = root;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">128</span>; i++) {</div><div class="line">			<span class="keyword">if</span> (child[root][i] == <span class="number">-1</span>) {</div><div class="line">				child[root][i] = root;</div><div class="line">			} <span class="keyword">else</span> {</div><div class="line">				fail[child[root][i]] = root;</div><div class="line">				que.push(child[root][i]);</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="keyword">while</span> (!que.empty()) {</div><div class="line">			<span class="keyword">int</span> u = que.front();</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">128</span>; i++) {</div><div class="line">				<span class="keyword">if</span> (child[u][i] != <span class="number">-1</span>) {</div><div class="line">					fail[child[u][i]] = child[fail[u]][i];</div><div class="line">					que.push(child[u][i]);</div><div class="line">				} <span class="keyword">else</span> {</div><div class="line">					child[u][i] = child[fail[u]][i];</div><div class="line">				}</div><div class="line">			}</div><div class="line">			que.pop();</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="keyword">bool</span> flag[<span class="number">505</span>];</div><div class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> id, <span class="keyword">char</span> s[])</span> </span>{</div><div class="line">		<span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</div><div class="line">		<span class="keyword">int</span> cur = root;</div><div class="line">		<span class="keyword">bool</span> mark = <span class="literal">false</span>;</div><div class="line">		<span class="built_in">memset</span>(flag, <span class="number">0</span>, <span class="keyword">sizeof</span>(flag));</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) {</div><div class="line">			cur = child[cur][s[i]];</div><div class="line">			<span class="keyword">int</span> tmp = cur;</div><div class="line">			<span class="keyword">while</span> (tmp != root) {</div><div class="line">				<span class="keyword">if</span> (end[tmp] != <span class="number">-1</span>)	flag[end[tmp]] = mark = <span class="literal">true</span>;</div><div class="line">				tmp = fail[tmp];</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="keyword">if</span> (!mark)	<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">&quot;web %d:&quot;</span>, id);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</div><div class="line">			<span class="keyword">if</span> (flag[i])</div><div class="line">				<span class="built_in">printf</span>(<span class="string">&quot; %d&quot;</span>, i);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">	}</div><div class="line">} ac;</div><div class="line"><span class="keyword">char</span> str[<span class="number">10005</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</div><div class="line">	<span class="keyword">int</span> n, m, ans;</div><div class="line">	<span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) != EOF) {</div><div class="line">		ac.init();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) {</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str);</div><div class="line">			ac.insert(i, str);</div><div class="line">		}</div><div class="line">		ac.setFail();</div><div class="line">		ans = <span class="number">0</span>;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) {</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str);</div><div class="line">			ans += ac.query(n, i, str);</div><div class="line">		}</div><div class="line">		<span class="built_in">printf</span>(<span class="string">&quot;total: %d\n&quot;</span>, ans);</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x4E00;&#x9053;&#x7A0D;&#x5FAE;&#x6709;&#x4E9B;&#x53D8;&#x5316;&#x7684;&#x9898;&#xFF08;&#x867D;&#x7136;&#x8FD8;&#x662F;&#x57FA;&#x7840;&#x6C34;&#x9898;&#xFF09;</p>
<blockquote>
<p>&#x3010;ZOJ3034&#x3011; Detect the Virus<br>One day, Nobita found that his computer is extremely slow. After several hours&#x2019; work, he finally found that it was a virus that made his poor computer slow and the virus was activated by a misoperation of opening an attachment of an email.<br>Nobita did use an outstanding anti-virus software, however, for some strange reason, this software did not check email attachments. Now Nobita decide to detect viruses in emails by himself.<br>To detect an virus, a virus sample (several binary bytes) is needed. If these binary bytes can be found in the email attachment (binary data), then the attachment contains the virus.<br>Note that attachments (binary data) in emails are usually encoded in base64. To encode a binary stream in base64, first write the binary stream into bits. Then take 6 bits from the stream in turn, encode these 6 bits into a base64 character according the following table:<br>That is, translate every 3 bytes into 4 base64 characters. If the original binary stream contains 3k + 1 bytes, where k is an integer, fill last bits using zero when encoding and append &#x2018;==&#x2019; as padding. If the original binary stream contains 3k + 2 bytes, fill last bits using zero when encoding and append &#x2018;=&#x2019; as padding. No padding is needed when the original binary stream contains 3k bytes. </p>
<p>Value    Encoding    Value    Encoding<br>0        A            32        g<br>1        B            33        h<br>2        C            34        i<br>3        D            35        j<br>4        E            36        k<br>5        F            37        l<br>6        G             38        m<br>7        H            39        n<br>8        I            40        o<br>9        J            41        p<br>10        K            42        q<br>11        L            43        r<br>12        M            44        s<br>13        N            45        t<br>14        O            46        u<br>15        P            47        v<br>16        Q            48        w<br>17        R            49        x<br>18        S            50        y<br>19        T            51        z<br>20        U            52        0<br>21        V            53        1<br>22        W            54        2<br>23        X            55        3<br>24        Y            56        4<br>25        Z            57        5<br>26        a            58        6<br>27        b            59        7<br>28        c            60        8<br>29        d            61        9<br>30        e            62        +<br>31        f            63        /</p>
<p>For example, to encode &#x2018;hello&#x2019; into base64, first write &#x2018;hello&#x2019; as binary bits, that is: 01101000 01100101 01101100 01101100 01101111<br>Then, take 6 bits in turn and fill last bits as zero as padding (zero padding bits are marked in bold): 011010 000110 010101 101100 011011 000110 111100<br>They are 26 6 21 44 27 6 60 in decimal. Look up the table above and use corresponding characters: aGVsbG8<br>Since original binary data contains 1 * 3 + 2 bytes, padding is needed, append &#x2018;=&#x2019; and &#x2018;hello&#x2019; is finally encoded in base64: aGVsbG8=<br>Section 5.2 of RFC 1521 describes how to encode a binary stream in base64 much more detailedly:<br>Here is a piece of ANSI C code that can encode binary data in base64. It contains a function, encode (infile, outfile), to encode binary file infile in base64 and output result to outfile.</p>
<p>Input<br>Input contains multiple cases (about 15, of which most are small ones). The first line of each case contains an integer N (0 &lt;= N &lt;= 512). In the next N distinct lines, each line contains a sample of a kind of virus, which is not empty, has not more than 64 bytes in binary and is encoded in base64. Then, the next line contains an integer M (1 &lt;= M &lt;= 128). In the following M lines, each line contains the content of a file to be detected, which is not empty, has no more than 2048 bytes in binary and is encoded in base64.<br>There is a blank line after each case.<br>Output<br>For each case, output M lines. The ith line contains the number of kinds of virus detected in the ith file.<br>Output a blank line after each case.</p>
<p>Sample Input<br>3<br>YmFzZTY0<br>dmlydXM=<br>dDog<br>1<br>dGVzdDogdmlydXMu</p>
<p>1<br>QA==<br>2<br>QA==<br>ICAgICAgICA=<br>Sample Output<br>2</p>
<p>1<br>0</p>
<p>Hint<br>In the first sample case, there are three virus samples: base64, virus and t: , the data to be checked is test: virus., which contains the second and the third, two virus samples.</p>
</blockquote>
<p>&#x601D;&#x8DEF;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5148;&#x89E3;&#x7801;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x662F;&#x6A21;&#x677F;&#x9898;&#x4E86;</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DICNUM 256</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ACautomation</span> {</span></div><div class="line">	<span class="keyword">int</span> cnt, root;</div><div class="line">	<span class="keyword">int</span> child[<span class="number">50000</span>+<span class="number">50</span>][DICNUM], end[<span class="number">50000</span>+<span class="number">50</span>], fail[<span class="number">50000</span>+<span class="number">50</span>];</div><div class="line">	<span class="keyword">int</span> Map[<span class="number">256</span>];</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">()</span> </span>{</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++)	child[cnt][i] = <span class="number">-1</span>;</div><div class="line">		end[cnt++] = <span class="number">-1</span>;</div><div class="line">		<span class="keyword">return</span> cnt<span class="number">-1</span>;</div><div class="line">	}</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</div><div class="line">		cnt = <span class="number">0</span>;</div><div class="line">		root = newnode();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)	Map[i+<span class="string">&apos;A&apos;</span>] = i;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">26</span>; i &lt; <span class="number">52</span>; i++)	Map[i<span class="number">-26</span>+<span class="string">&apos;a&apos;</span>] = i;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">52</span>; i &lt; <span class="number">62</span>; i++)	Map[i<span class="number">-52</span>+<span class="string">&apos;0&apos;</span>] = i;</div><div class="line">		Map[<span class="string">&apos;+&apos;</span>] = <span class="number">62</span>, Map[<span class="string">&apos;/&apos;</span>] = <span class="number">63</span>;</div><div class="line">	}</div><div class="line">	<span class="keyword">int</span> tmp[<span class="number">5000</span>+<span class="number">5</span>], tmpl;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ReEncode</span><span class="params">(<span class="keyword">char</span> s[])</span> </span>{</div><div class="line">		<span class="built_in">memset</span>(tmp, <span class="number">0</span>, <span class="keyword">sizeof</span>(tmp));</div><div class="line">		tmpl = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, len = <span class="number">0</span>, x = <span class="number">0</span>; s[i] &amp;&amp; s[i] != <span class="string">&apos;=&apos;</span>; i++) {</div><div class="line">			len += <span class="number">6</span>, x = (x&lt;&lt;<span class="number">6</span>)|Map[s[i]];</div><div class="line">			<span class="keyword">if</span> (len &gt;= <span class="number">8</span>) {</div><div class="line">				tmp[tmpl++] = (x&gt;&gt;(len<span class="number">-8</span>))&amp;<span class="number">0xff</span>;</div><div class="line">				len -= <span class="number">8</span>;</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">char</span> s[])</span> </span>{</div><div class="line">		ReEncode(s);</div><div class="line">		<span class="keyword">int</span> cur = root;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tmpl; cur = child[cur][tmp[i++]])</div><div class="line">			<span class="keyword">if</span> (child[cur][tmp[i]] == <span class="number">-1</span>)	child[cur][tmp[i]] = newnode();</div><div class="line">		end[cur] = id;</div><div class="line">	}</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setFail</span><span class="params">()</span> </span>{</div><div class="line">		<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;</div><div class="line">		fail[root] = root;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++) {</div><div class="line">			<span class="keyword">if</span> (child[root][i] == <span class="number">-1</span>) {</div><div class="line">				child[root][i] = root;</div><div class="line">			} <span class="keyword">else</span> {</div><div class="line">				fail[child[root][i]] = root;</div><div class="line">				que.push(child[root][i]);</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="keyword">while</span> (!que.empty()) {</div><div class="line">			<span class="keyword">int</span> cur = que.front();</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++) {</div><div class="line">				<span class="keyword">if</span> (child[cur][i] == <span class="number">-1</span>) {</div><div class="line">					child[cur][i] = child[fail[cur]][i];</div><div class="line">				} <span class="keyword">else</span> {</div><div class="line">					fail[child[cur][i]] = child[fail[cur]][i];</div><div class="line">					que.push(child[cur][i]);</div><div class="line">				}</div><div class="line">			}</div><div class="line">			que.pop();</div><div class="line">		}</div><div class="line">	}</div><div class="line">	<span class="keyword">bool</span> flag[<span class="number">50000</span>+<span class="number">50</span>];</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">char</span> s[])</span> </span>{</div><div class="line">		ReEncode(s);</div><div class="line">		<span class="keyword">int</span> cur = root, ret = <span class="number">0</span>;</div><div class="line">		<span class="built_in">memset</span>(flag, <span class="number">0</span>, <span class="keyword">sizeof</span>(flag));</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tmpl; i++) {</div><div class="line">			cur = child[cur][tmp[i]];</div><div class="line">			<span class="keyword">int</span> t = cur;</div><div class="line">			<span class="keyword">while</span> (t != root) {</div><div class="line">				<span class="keyword">if</span> (end[t] != <span class="number">-1</span> &amp;&amp; !flag[end[t]])	ret++, flag[end[t]] = <span class="literal">true</span>;</div><div class="line">				t = fail[t];</div><div class="line">			}</div><div class="line">		}</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">	} </div><div class="line">} ACauto;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</div><div class="line">	<span class="keyword">int</span> n, m;</div><div class="line">	<span class="keyword">char</span> str[<span class="number">5000</span>+<span class="number">5</span>];</div><div class="line">	<span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) != EOF) {</div><div class="line">		ACauto.init();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) {</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str);</div><div class="line">			ACauto.insert(i, str);</div><div class="line">		}</div><div class="line">		ACauto.setFail();</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) {</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str);</div><div class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ACauto.query(i, str));</div><div class="line">		}</div><div class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</div><div class="line">	}</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>AC&#x81EA;&#x52A8;&#x673A;&#x7684;&#x7384;&#x5B66;&#x535A;&#x5927;&#x7CBE;&#x6DF1;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x548C;dp&#x626F;&#x4E0A;&#x5173;&#x7CFB;&#xFF0C;&#x8FD8;&#x662F;&#x591A;&#x7EC3;&#x9898;&#x4E3A;&#x597D;</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/主席树原理与基础例题/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          主席树原理与基础例题
        
      </div>
    </a>
  
  
    <a href="/20170710总结/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">20170710总结</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="ds-share share" data-thread-key="AC自动机基础例题" data-title="AC自动机基础例题" data-url="http://yoursite.com/AC自动机基础例题/"  data-images="http://chuantu.biz/t6/89/1507626502x2728279003.jpg" data-content="AC自动机基础例题">
    <div class="ds-share-inline">
      <ul  class="ds-share-icons-16">
      	<li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
        <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
        <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
      </ul>
      <div class="ds-share-icons-more">
      </div>
    </div>
 </div>
 





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2017 Azrael_Death
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
  </script>
  <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  
</footer>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>
<!--
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
-->



<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

  </div>
</body>
</html>