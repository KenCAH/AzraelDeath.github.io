<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>【福利】洛谷模板汇总 | NIRVANA</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Graph Theory Disjoint Set  【模板】并查集 题目描述 如题，现在有一个并查集，你需要完成合并和查询操作。 输入输出格式 输入格式： 第一行包含两个整数N、M，表示共有N个元素和M个操作。 接下来M行，每行包含三个整数Zi、Xi、Yi 当Zi=1时，将Xi与Yi所在的集合合并 当Zi=2时，输出Xi与Yi是否在同一集合内，是的话输出Y；否则话输出N 输出格式： 如">
<meta name="keywords" content="LG">
<meta property="og:type" content="article">
<meta property="og:title" content="【福利】洛谷模板汇总">
<meta property="og:url" content="http://yoursite.com/洛谷模板汇总/index.html">
<meta property="og:site_name" content="NIRVANA">
<meta property="og:description" content="Graph Theory Disjoint Set  【模板】并查集 题目描述 如题，现在有一个并查集，你需要完成合并和查询操作。 输入输出格式 输入格式： 第一行包含两个整数N、M，表示共有N个元素和M个操作。 接下来M行，每行包含三个整数Zi、Xi、Yi 当Zi=1时，将Xi与Yi所在的集合合并 当Zi=2时，输出Xi与Yi是否在同一集合内，是的话输出Y；否则话输出N 输出格式： 如">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-10-12T04:54:37.762Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【福利】洛谷模板汇总">
<meta name="twitter:description" content="Graph Theory Disjoint Set  【模板】并查集 题目描述 如题，现在有一个并查集，你需要完成合并和查询操作。 输入输出格式 输入格式： 第一行包含两个整数N、M，表示共有N个元素和M个操作。 接下来M行，每行包含三个整数Zi、Xi、Yi 当Zi=1时，将Xi与Yi所在的集合合并 当Zi=2时，输出Xi与Yi是否在同一集合内，是的话输出Y；否则话输出N 输出格式： 如">
  
    <link rel="alternative" href="/atom.xml" title="NIRVANA" type="application/atom+xml">
  
  
    <link rel="icon" href="http://chuantu.biz/t6/89/1507626502x2728279003.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
  
  

  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

  
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://chuantu.biz/t6/89/1507626502x2728279003.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Azrael_Death</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Veni Vidi Vici</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/AzraelDeath" title="github">github</a>
					        
								<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/azraeldeath" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/2-SAT/" style="font-size: 11.43px;">2-SAT</a> <a href="/tags/AC自动机/" style="font-size: 11.43px;">AC自动机</a> <a href="/tags/APIO/" style="font-size: 10px;">APIO</a> <a href="/tags/BZOJ/" style="font-size: 20px;">BZOJ</a> <a href="/tags/DFS序/" style="font-size: 10px;">DFS序</a> <a href="/tags/DP/" style="font-size: 11.43px;">DP</a> <a href="/tags/HDU/" style="font-size: 14.29px;">HDU</a> <a href="/tags/LCA/" style="font-size: 12.86px;">LCA</a> <a href="/tags/LG/" style="font-size: 11.43px;">LG</a> <a href="/tags/Manacher/" style="font-size: 11.43px;">Manacher</a> <a href="/tags/NOI/" style="font-size: 11.43px;">NOI</a> <a href="/tags/NOIp/" style="font-size: 10px;">NOIp</a> <a href="/tags/POI/" style="font-size: 10px;">POI</a> <a href="/tags/POJ/" style="font-size: 15.71px;">POJ</a> <a href="/tags/Tarjan/" style="font-size: 11.43px;">Tarjan</a> <a href="/tags/Trie/" style="font-size: 10px;">Trie</a> <a href="/tags/UVa/" style="font-size: 10px;">UVa</a> <a href="/tags/主席树/" style="font-size: 14.29px;">主席树</a> <a href="/tags/分块/" style="font-size: 10px;">分块</a> <a href="/tags/差分/" style="font-size: 10px;">差分</a> <a href="/tags/差分约束系统/" style="font-size: 10px;">差分约束系统</a> <a href="/tags/并查集/" style="font-size: 11.43px;">并查集</a> <a href="/tags/总结/" style="font-size: 18.57px;">总结</a> <a href="/tags/树套树/" style="font-size: 11.43px;">树套树</a> <a href="/tags/树状数组/" style="font-size: 12.86px;">树状数组</a> <a href="/tags/模拟/" style="font-size: 10px;">模拟</a> <a href="/tags/省选/" style="font-size: 17.14px;">省选</a> <a href="/tags/线段树/" style="font-size: 12.86px;">线段树</a> <a href="/tags/组合数学/" style="font-size: 10px;">组合数学</a> <a href="/tags/网络流/" style="font-size: 15.71px;">网络流</a> <a href="/tags/莫队/" style="font-size: 11.43px;">莫队</a> <a href="/tags/补集转换/" style="font-size: 10px;">补集转换</a> <a href="/tags/费用流/" style="font-size: 10px;">费用流</a> <a href="/tags/高斯消元/" style="font-size: 10px;">高斯消元</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/OwenOwl">OwenOwl</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/Joker_69">Joker</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://dangxingyu.com">DXY</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://309459245.lofter.com">YJQ</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/candy99">Candy</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/zig-zag">ZigZag</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://cxjyxx.me">cxjyxx_me</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.shuizilong.com">ShuiZiLong</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/kuangbin">KuangBin</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Azrael_Death</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://chuantu.biz/t6/89/1507626502x2728279003.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Azrael_Death</h1>
			</hgroup>
			
			<p class="header-subtitle">Veni Vidi Vici</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/AzraelDeath" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/azraeldeath" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-洛谷模板汇总" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/洛谷模板汇总/" class="article-date">
  	<time datetime="2017-09-28T16:00:00.000Z" itemprop="datePublished">2017-09-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      【福利】洛谷模板汇总
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LG/">LG</a></li></ul>
	</div>

        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="graph-theory">Graph Theory</h1>
<h2 id="disjoint-set">Disjoint Set</h2>
<blockquote>
<p>【模板】并查集</p>
<p>题目描述 如题，现在有一个并查集，你需要完成合并和查询操作。</p>
<p>输入输出格式 输入格式： 第一行包含两个整数N、M，表示共有N个元素和M个操作。 接下来M行，每行包含三个整数Zi、Xi、Yi 当Zi=1时，将Xi与Yi所在的集合合并 当Zi=2时，输出Xi与Yi是否在同一集合内，是的话输出Y；否则话输出N 输出格式： 如上，对于每一个Zi=2的操作，都有一行输出，每行包含一个大写字母，为Y或者N</p>
<p>输入输出样例 输入样例： 4 7 2 1 2 1 1 2 2 1 2 1 3 4 2 1 4 1 2 3 2 1 4 输出样例： N Y N Y</p>
<p>说明 时空限制：1000ms,128M 数据规模： 对于30%的数据，N&lt;=10，M&lt;=20； 对于70%的数据，N&lt;=100，M&lt;=1000； 对于100%的数据，N&lt;=10000，M&lt;=200000。 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 10000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, m, f, x, y, father[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getfather</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (father[v] == v) &#123;</div><div class="line">        <span class="keyword">return</span> v;</div><div class="line">    &#125;</div><div class="line">    father[v] = getfather(father[v]);</div><div class="line">    <span class="keyword">return</span> father[v];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">        father[i] = i;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">        <span class="built_in">cin</span> &gt;&gt; f &gt;&gt; x &gt;&gt; y;</div><div class="line">        <span class="keyword">if</span> (f == <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">int</span> f1 = getfather(x);</div><div class="line">            <span class="keyword">int</span> f2 = getfather(y);</div><div class="line">            <span class="keyword">if</span> (f1 != f2) &#123;</div><div class="line">                father[f1] = f2;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">int</span> f1 = getfather(x);</div><div class="line">            <span class="keyword">int</span> f2 = getfather(y);</div><div class="line">            <span class="keyword">if</span> (f1 != f2) &#123;</div><div class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">"N"</span> &lt;&lt; <span class="built_in">endl</span>;            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">"Y"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="minimum-spanning-tree-kruskal">Minimum Spanning Tree (Kruskal)</h2>
<blockquote>
<p>【模板】最小生成树</p>
<p>题目描述 如题，给出一个无向图，求出最小生成树，如果该图不连通，则输出orz</p>
<p>输入输出格式 输入格式： 第一行包含两个整数N、M，表示该图共有N个结点和M条无向边。（N&lt;=5000，M&lt;=200000） 接下来M行每行包含三个整数Xi、Yi、Zi，表示有一条长度为Zi的无向边连接结点Xi、Yi 输出格式： 输出包含一个数，即最小生成树的各边的长度之和；如果该图不连通则输出orz</p>
<p>输入输出样例 输入样例： 4 5 1 2 2 1 3 2 1 4 3 2 3 4 3 4 3 输出样例： 7</p>
<p>说明 时空限制：1000ms,128M 数据规模： 对于20%的数据：N&lt;=5，M&lt;=20 对于40%的数据：N&lt;=50，M&lt;=2500 对于70%的数据：N&lt;=500，M&lt;=10000 对于100%的数据：N&lt;=5000，M&lt;=200000 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 5000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 200000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></div><div class="line">	<span class="keyword">int</span> u, v, l;</div><div class="line">&#125; edge[MAX_M+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> n, m, tot = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> father[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">const</span> node &amp;a, <span class="keyword">const</span> node &amp;b)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> a.l &lt; b.l;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getfather</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (father[v] == v) &#123;</div><div class="line">		<span class="keyword">return</span> v;</div><div class="line">	&#125;</div><div class="line">	father[v] = getfather(father[v]);</div><div class="line">	<span class="keyword">return</span> father[v];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; edge[i].u &gt;&gt; edge[i].v &gt;&gt; edge[i].l;</div><div class="line">	&#125;</div><div class="line">	sort(edge, edge+m, comp);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	father[i] = i;</div><div class="line">	<span class="keyword">int</span> flag = n<span class="number">-1</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">		<span class="keyword">int</span> f1 = getfather(edge[i].u);</div><div class="line">		<span class="keyword">int</span> f2 = getfather(edge[i].v);</div><div class="line">		<span class="keyword">if</span> (f1 != f2) &#123;</div><div class="line">			father[f1] = f2;</div><div class="line">			tot += edge[i].l;</div><div class="line">			flag--;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (flag == <span class="number">0</span>)	<span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (flag == <span class="number">0</span>) &#123;</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; tot;</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"orz"</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="shortest-path-fastest-algorithm">Shortest Path Fastest Algorithm</h2>
<blockquote>
<p>【模板】单源最短路径</p>
<p>题目描述 如题，给出一个有向图，请输出从某一点出发到所有点的最短路径长度。</p>
<p>输入输出格式 输入格式： 第一行包含三个整数N、M、S，分别表示点的个数、有向边的个数、出发点的编号。 接下来M行每行包含三个整数Fi、Gi、Wi，分别表示第i条有向边的出发点、目标点和长度。 输出格式： 一行，包含N个用空格分隔的整数，其中第i个整数表示从点S出发到点i的最短路径长度（若S=i则最短路径长度为0，若从点S无法到达点i，则最短路径长度为2147483647）</p>
<p>输入输出样例 输入样例： 4 6 1 1 2 2 2 3 2 2 4 1 1 3 5 3 4 3 1 4 4 输出样例： 0 2 4 3</p>
<p>说明 时空限制：1000ms,128M 数据规模： 对于20%的数据：N&lt;=5，M&lt;=15 对于40%的数据：N&lt;=100，M&lt;=10000 对于70%的数据：N&lt;=1000，M&lt;=100000 对于100%的数据：N&lt;=10000，M&lt;=500000 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 500000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 10000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2147483647</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></div><div class="line">	<span class="keyword">int</span> v, len, next;</div><div class="line">	node() &#123;</div><div class="line">		v = len = next = <span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">&#125; edge[MAX_M+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> n, m, s;</div><div class="line"><span class="keyword">int</span> first[MAX_N+<span class="number">5</span>], cnt = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> dis[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> l)</span> </span>&#123;</div><div class="line">	cnt++;</div><div class="line">	edge[cnt].v = v;</div><div class="line">	edge[cnt].len = l;</div><div class="line">	edge[cnt].next = first[u];</div><div class="line">	first[u] = cnt;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">SPFA</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">		dis[i] = INF;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">int</span> que[MAX_N*<span class="number">20</span>+<span class="number">5</span>], mark[MAX_N+<span class="number">5</span>];</div><div class="line">	<span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">1</span>;</div><div class="line">	<span class="built_in">memset</span>(mark, <span class="number">0</span>, <span class="keyword">sizeof</span>(mark));</div><div class="line">	que[<span class="number">1</span>] = s;</div><div class="line">	mark[s] = <span class="number">1</span>;</div><div class="line">	dis[s] = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span> (head &lt;= tail) &#123;</div><div class="line">		head++;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> tmp = first[que[head]]; tmp; tmp = edge[tmp].next) &#123;</div><div class="line">			<span class="keyword">if</span> (dis[que[head]]+edge[tmp].len &lt; dis[edge[tmp].v]) &#123;</div><div class="line">				dis[edge[tmp].v] = dis[que[head]]+edge[tmp].len;</div><div class="line">				<span class="keyword">if</span> (mark[edge[tmp].v] == <span class="number">0</span>) &#123;</div><div class="line">					mark[edge[tmp].v] = <span class="number">1</span>;</div><div class="line">					tail++;</div><div class="line">					que[tail] = edge[tmp].v;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		mark[que[head]] = <span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; s;</div><div class="line">	<span class="built_in">memset</span>(first, <span class="number">0</span>, <span class="keyword">sizeof</span>(first));</div><div class="line">	<span class="keyword">int</span> u, v, l;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v &gt;&gt; l;</div><div class="line">		insert(u, v, l);</div><div class="line">	&#125;</div><div class="line">	SPFA();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; dis[i] &lt;&lt; <span class="string">" "</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="tarjan">Tarjan</h2>
<blockquote>
<p>【模板】缩点</p>
<p>题目背景 缩点+DP</p>
<p>题目描述 给定一个n个点m条边有向图，每个点有一个权值，求一条路径，使路径经过的点权值之和最大。你只需要求出这个权值和。 允许多次经过一条边或者一个点，但是，重复经过的点，权值只计算一次。</p>
<p>输入输出格式 输入格式： 第一行，n,m 第二行，n个整数，依次代表点权 第三至m+2行，每行两个整数u,v，表示u-&gt;v有一条有向边 输出格式： 共一行，最大的点权之和。</p>
<p>输入输出样例 输入样例： 2 2 1 1 1 2 2 1 输出样例： 2</p>
<p>说明 n&lt;=10<sup>4,m&lt;=10</sup>5,|点权|&lt;=1000 算法：Tarjan缩点+DAGdp <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, m, c[MAX_N+<span class="number">5</span>], f[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> dfn[MAX_N+<span class="number">5</span>], low[MAX_N+<span class="number">5</span>], col[MAX_N+<span class="number">5</span>], val[MAX_N+<span class="number">5</span>], ind, cnt;</div><div class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>], E[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="built_in">stack</span> &lt;<span class="keyword">int</span>&gt; sta;</div><div class="line"><span class="keyword">bool</span> insta[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</div><div class="line">	dfn[u] = low[u] = ++ind, sta.push(u), insta[u] = <span class="literal">true</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</div><div class="line">		<span class="keyword">int</span> v = G[u][i];</div><div class="line">		<span class="keyword">if</span> (!dfn[v])	tarjan(v), low[u] = min(low[u], low[v]);</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (insta[v])	low[u] = min(low[u], dfn[v]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (dfn[u] == low[u]) &#123;</div><div class="line">		cnt++;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = sta.top(); ; i = sta.top()) &#123;</div><div class="line">			col[i] = cnt, val[cnt] += c[i], insta[i] = <span class="literal">false</span>;</div><div class="line">			sta.pop();	<span class="keyword">if</span> (u == i)	<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (f[u])	<span class="keyword">return</span> f[u];</div><div class="line">	<span class="keyword">int</span> mx = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; E[u].size(); i++)	mx = max(mx, DFS(E[u][i]));</div><div class="line">	<span class="keyword">return</span> f[u] = val[u]+mx;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;c[i]);</div><div class="line">	<span class="keyword">while</span> (m--) &#123;</div><div class="line">		<span class="keyword">int</span> u, v;	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v);</div><div class="line">		G[u].push_back(v);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</div><div class="line">		<span class="keyword">if</span> (!dfn[i])	tarjan(i);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; u++) &#123;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</div><div class="line">			<span class="keyword">int</span> v = G[u][i];	<span class="keyword">if</span> (col[u] == col[v])	<span class="keyword">continue</span>;</div><div class="line">			E[col[u]].push_back(col[v]);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">int</span> ans = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; i++)</div><div class="line">		<span class="keyword">if</span> (!f[i])	ans = max(ans, DFS(i));</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%d"</span>, ans);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="cur-vertex">Cur Vertex</h2>
<blockquote>
<p>【模板】割点</p>
<p>题目描述 给出一个n个点，m条边的无向图，求图的割点。</p>
<p>输入输出格式 输入格式： 第一行输入n，m 下面m行每行输入x，y表示x到y有一条边 输出格式： 第一行输出割点个数 第二行按照节点编号从小到大输出节点，用空格隔开</p>
<p>输入输出样例 输入样例： 6 7 1 2 1 3 1 4 2 5 3 5 4 5 5 6 输出样例： 1 5</p>
<p>说明 n，m均为100000 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 200000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> v, next;</div><div class="line">&#125; edge[MAX_M+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> first[MAX_N+<span class="number">5</span>], flag[MAX_N+<span class="number">5</span>], num[MAX_N+<span class="number">5</span>], low[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> n, m, cnt = <span class="number">0</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> pos)</span> </span>&#123;</div><div class="line">    edge[pos].next = first[u];</div><div class="line">    edge[pos].v = v;</div><div class="line">    first[u] = pos;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> father)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> child = <span class="number">0</span>;</div><div class="line">    num[cur] = low[cur] = ++cnt;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> tmp = first[cur]; tmp; tmp = edge[tmp].next) &#123;</div><div class="line">        <span class="keyword">if</span> (!num[edge[tmp].v]) &#123;</div><div class="line">            child++;</div><div class="line">            dfs(edge[tmp].v, cur);</div><div class="line">            low[cur] = min(low[cur], low[edge[tmp].v]);</div><div class="line">            <span class="keyword">if</span> (low[edge[tmp].v] &gt;= num[cur]) &#123;</div><div class="line">                flag[cur] = <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (num[edge[tmp].v] &lt; num[cur] &amp;&amp; edge[tmp].v != father) &#123;</div><div class="line">            low[cur] = min(low[cur], num[edge[tmp].v]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (father == <span class="number">-1</span> &amp;&amp; child == <span class="number">1</span>) &#123;</div><div class="line">        flag[cur] = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">        <span class="keyword">int</span> u, v;</div><div class="line">        <span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v;</div><div class="line">        insert(u, v, i*<span class="number">2</span>+<span class="number">1</span>);</div><div class="line">        insert(v, u, i*<span class="number">2</span>+<span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> tot = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (!num[i]) &#123;</div><div class="line">            dfs(i, <span class="number">-1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (flag[i]) &#123;</div><div class="line">            tot++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; tot &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (flag[i]) &#123;</div><div class="line">            <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">" "</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="lowest-common-ancestor">Lowest Common Ancestor</h2>
<blockquote>
<p>【模板】最近公共祖先 LCA</p>
<p>题目描述 如题，给定一棵有根多叉树，请求出指定两个点直接最近的公共祖先。</p>
<p>输入输出格式 输入格式： 第一行包含三个正整数N、M、S，分别表示树的结点个数、询问的个数和树根结点的序号。 接下来N-1行每行包含两个正整数x、y，表示x结点和y结点之间有一条直接连接的边（数据保证可以构成树）。 接下来M行每行包含两个正整数a、b，表示询问a结点和b结点的最近公共祖先。 输出格式： 输出包含M行，每行包含一个正整数，依次为每一个询问的结果。</p>
<p>输入输出样例 输入样例： 5 5 4 3 1 2 4 5 1 1 4 2 4 3 2 3 5 1 2 4 5 输出样例： 4 4 1 4 4</p>
<p>说明 时空限制：1000ms,128M 数据规模： 对于30%的数据：N&lt;=10，M&lt;=10 对于70%的数据：N&lt;=10000，M&lt;=10000 对于100%的数据：N&lt;=500000，M&lt;=500000 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 500000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></div><div class="line">	<span class="keyword">int</span> next, to;</div><div class="line">&#125; edge[(MAX_N&lt;&lt;<span class="number">1</span>)+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> n, m, s, x, y, cnt;</div><div class="line"><span class="keyword">int</span> d[MAX_N+<span class="number">5</span>], p[MAX_N+<span class="number">5</span>][<span class="number">25</span>], first[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">bool</span> vis[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;	<span class="keyword">char</span> ch = getchar();</div><div class="line">	<span class="keyword">while</span> (ch &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>)	ch = getchar();</div><div class="line">	<span class="keyword">while</span> (ch &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>)	ret = ret*<span class="number">10</span>+ch-<span class="string">'0'</span>, ch = getchar();</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">INSERT</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">	edge[++cnt].next = first[a];</div><div class="line">	edge[cnt].to = b;</div><div class="line">	first[a] = cnt;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</div><div class="line">	vis[u] = <span class="literal">true</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; (<span class="number">1</span>&lt;&lt;i) &lt;= n; i++) &#123;</div><div class="line">		<span class="keyword">if</span> ((<span class="number">1</span>&lt;&lt;i) &lt;= d[u]) &#123;</div><div class="line">			p[u][i] = p[p[u][i<span class="number">-1</span>]][i<span class="number">-1</span>];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i; i = edge[i].next) &#123;</div><div class="line">		<span class="keyword">int</span> v = edge[i].to;</div><div class="line">		<span class="keyword">if</span> (!vis[v]) &#123;</div><div class="line">			d[v] = d[u]+<span class="number">1</span>;</div><div class="line">			p[v][<span class="number">0</span>] = u;</div><div class="line">			DFS(v);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> i, j;</div><div class="line">	<span class="keyword">if</span> (d[a] &lt; d[b])	swap(a, b);</div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; (<span class="number">1</span>&lt;&lt;i) &lt;= d[a]; i++) &#123;&#125;</div><div class="line">	i--;</div><div class="line">	<span class="keyword">for</span> (j = i; j &gt;= <span class="number">0</span>; j--) &#123;</div><div class="line">		<span class="keyword">if</span> (d[a]-(<span class="number">1</span>&lt;&lt;j) &gt;= d[b]) &#123;</div><div class="line">			a = p[a][j];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (a == b) &#123;</div><div class="line">		<span class="keyword">return</span> a;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span> (j = i; j &gt;= <span class="number">0</span>; j--) &#123;</div><div class="line">		<span class="keyword">if</span> (p[a][j] != p[b][j]) &#123;</div><div class="line">			a = p[a][j];</div><div class="line">			b = p[b][j];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> p[a][<span class="number">0</span>];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	n = read(), m = read(), s = read();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</div><div class="line">		x = read(), y = read();</div><div class="line">		INSERT(x, y);</div><div class="line">		INSERT(y, x);</div><div class="line">	&#125;</div><div class="line">	DFS(s);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">		x = read(), y = read();</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; LCA(x, y) &lt;&lt; <span class="built_in">endl</span>; </div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="negative-loop">Negative Loop</h2>
<blockquote>
<p>【模板】负环</p>
<p>题目描述 暴力枚举/SPFA/Bellman-ford/奇怪的贪心/超神搜索</p>
<p>输入输出格式 输入格式： 第一行一个正整数T表示数据组数，对于每组数据： 第一行两个正整数N M，表示图有N个顶点，M条边 接下来M行，每行三个整数a b w，表示a-&gt;b有一条权值为w的边（若w&lt;0则为单向，否则双向） 输出格式： 共T行。对于每组数据，存在负环则输出一行“YE5”(不含引号)，否则输出一行“N0”(不含引号)。</p>
<p>输入输出样例 输入样例#1： 2 3 4 1 2 2 1 3 4 2 3 1 3 1 -3 3 3 1 2 3 2 3 4 3 1 -8 输出样例#1： N0 YE5</p>
<p>说明 N,M,|w|≤200 000；1≤a,b≤N；T≤10 建议复制输出格式中的字符串。 此题普通Bellman-Ford或BFS-SPFA会TLE <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 200000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE 25000000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> f;	<span class="keyword">char</span> BUF[SIZE], *buf = BUF;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;x)</span> </span>&#123;</div><div class="line">	<span class="keyword">bool</span> flag = <span class="number">0</span>;	<span class="keyword">while</span> (*buf &lt; <span class="number">48</span>)	<span class="keyword">if</span> (*buf++ == <span class="number">45</span>)	flag = <span class="number">1</span>;</div><div class="line">	x = <span class="number">0</span>;	<span class="keyword">while</span> (*buf &gt; <span class="number">32</span>)	x = x*<span class="number">10</span>+*buf++<span class="number">-48</span>;	x = flag ? -x : x;</div><div class="line">&#125;</div><div class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>], E[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> dis[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">bool</span> insta[MAX_N+<span class="number">5</span>], flag;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">	flag = <span class="literal">false</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	G[i].clear(), E[i].clear();</div><div class="line">	<span class="built_in">memset</span>(dis, <span class="number">0</span>, <span class="keyword">sizeof</span>(dis)), <span class="built_in">memset</span>(insta, <span class="literal">false</span>, <span class="keyword">sizeof</span>(insta));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</div><div class="line">	insta[u] = <span class="literal">true</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</div><div class="line">		<span class="keyword">int</span> v = G[u][i], c = E[u][i];</div><div class="line">		<span class="keyword">if</span> (dis[u]+c &gt;= dis[v])	<span class="keyword">continue</span>;</div><div class="line">		<span class="keyword">if</span> (insta[v] || flag) &#123;flag = <span class="literal">true</span>;	<span class="keyword">break</span>;&#125;</div><div class="line">		dis[v] = dis[u]+c, DFS(v);</div><div class="line">	&#125;</div><div class="line">	insta[u] = <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	f = fread(BUF, <span class="number">1</span>, SIZE, <span class="built_in">stdin</span>);</div><div class="line">	<span class="keyword">int</span> T;	read(T);</div><div class="line">	<span class="keyword">while</span> (T--) &#123;</div><div class="line">		<span class="keyword">int</span> n, m;	read(n), read(m);	init(n);</div><div class="line">		<span class="keyword">while</span> (m--) &#123;</div><div class="line">			<span class="keyword">int</span> u, v, c;	read(u), read(v), read(c);</div><div class="line">			G[u].push_back(v), E[u].push_back(c);</div><div class="line">			<span class="keyword">if</span> (c &gt;= <span class="number">0</span>)	G[v].push_back(u), E[v].push_back(c);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;DFS(i);	<span class="keyword">if</span> (flag)	<span class="keyword">break</span>;&#125;</div><div class="line">		<span class="keyword">if</span> (flag)	<span class="built_in">printf</span>(<span class="string">"YE5\n"</span>);</div><div class="line">		<span class="keyword">else</span>	<span class="built_in">printf</span>(<span class="string">"N0\n"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="network-flow-dinic">Network Flow (Dinic)</h2>
<blockquote>
<p>【模板】网络最大流</p>
<p>题目描述 给出一个网络图，以及其源点和汇点，求出其网络最大流。</p>
<p>输入输出格式 输入格式： 第一行包含四个正整数N、M、S、T，分别表示点的个数、有向边的个数、源点序号、汇点序号。 接下来M行每行包含三个正整数ui、vi、wi，表示第i条有向边从ui出发，到达vi，边权为wi（即该边最大流量为wi）</p>
<p>输出格式： 一行，包含一个正整数，即为该网络的最大流。</p>
<p>输入输出样例 输入样例： 4 5 4 3 4 2 30 4 3 20 2 3 20 2 1 30 1 3 40 输出样例： 50</p>
<p>说明 时空限制：1000ms,128M 数据规模： 对于30%的数据：N&lt;=10，M&lt;=25 对于70%的数据：N&lt;=200，M&lt;=1000 对于100%的数据：N&lt;=10000，M&lt;=100000 样例说明： 题目中存在3条路径： 4–&gt;2–&gt;3，该路线可通过20的流量 4–&gt;3，可通过20的流量 4–&gt;2–&gt;1–&gt;3，可通过10的流量（边4–&gt;2之前已经耗费了20的流量） 故流量总计20+20+10=50。输出50。 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 10000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 100000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2147483647</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></div><div class="line">	<span class="keyword">int</span> v, c, next;</div><div class="line">&#125; E[MAX_M*<span class="number">2</span>+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> first[MAX_N+<span class="number">5</span>], cnt;</div><div class="line"><span class="keyword">int</span> n, m, s, t;</div><div class="line"><span class="keyword">int</span> d[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">	cnt = <span class="number">0</span>;</div><div class="line">	<span class="built_in">memset</span>(first, <span class="number">-1</span>, <span class="keyword">sizeof</span>(first));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">	E[cnt].v = v, E[cnt].c = c;</div><div class="line">	E[cnt].next = first[u];</div><div class="line">	first[u] = cnt++;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BFS</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">memset</span>(d, <span class="number">-1</span>, <span class="keyword">sizeof</span>(d));</div><div class="line">	<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;</div><div class="line">	que.push(s);</div><div class="line">	d[s] = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span> (!que.empty()) &#123;</div><div class="line">		<span class="keyword">int</span> u = que.front();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i != <span class="number">-1</span>; i = E[i].next) &#123;</div><div class="line">			<span class="keyword">int</span> v = E[i].v;</div><div class="line">			<span class="keyword">if</span> (E[i].c &amp;&amp; d[v] == <span class="number">-1</span>) &#123;</div><div class="line">				que.push(v);</div><div class="line">				d[v] = d[u]+<span class="number">1</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		que.pop();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> d[t] != <span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> flow)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (u == t) &#123;</div><div class="line">		<span class="keyword">return</span> flow;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i != <span class="number">-1</span>; i = E[i].next) &#123;</div><div class="line">		<span class="keyword">int</span> v = E[i].v;</div><div class="line">		<span class="keyword">if</span> (E[i].c &amp;&amp; d[u]+<span class="number">1</span> == d[v]) &#123;</div><div class="line">			<span class="keyword">int</span> tmp = DFS(v, min(flow, E[i].c));</div><div class="line">			flow -= tmp, E[i].c -= tmp, ret += tmp;</div><div class="line">			E[i^<span class="number">1</span>].c += tmp;</div><div class="line">			<span class="keyword">if</span> (flow == <span class="number">0</span>)	<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (ret == <span class="number">0</span>)	d[u] = <span class="number">-1</span>;</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	init();</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; s &gt;&gt; t;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">		<span class="keyword">int</span> u, v, c;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v &gt;&gt; c;</div><div class="line">		insert(u, v, c);</div><div class="line">		insert(v, u, <span class="number">0</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">int</span> ans = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span> (BFS()) &#123;</div><div class="line">		ans += DFS(s, INF);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">cout</span> &lt;&lt; ans;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="minimum-cost-maximum-flow">Minimum Cost Maximum Flow</h2>
<blockquote>
<p>【模板】最小费用最大流</p>
<p>题目描述 给出一个网络图，以及其源点和汇点，每条边已知其最大流量和单位流量费用，求出其网络最大流和在最大流情况下的最小费用。</p>
<p>输入输出格式 输入格式： 第一行包含四个正整数N、M、S、T，分别表示点的个数、有向边的个数、源点序号、汇点序号。 接下来M行每行包含四个正整数ui、vi、wi、fi，表示第i条有向边从ui出发，到达vi，边权为wi（即该边最大流量为wi），单位流量的费用为fi。 输出格式： 一行，包含两个整数，依次为最大流量和在最大流量情况下的最小费用。</p>
<p>输入输出样例 输入样例： 4 5 4 3 4 2 30 2 4 3 20 3 2 3 20 1 2 1 30 9 1 3 40 5 输出样例： 50 280</p>
<p>说明 时空限制：1000ms,128M （BYX：最后两个点改成了1200ms） 数据规模： 对于30%的数据：N&lt;=10，M&lt;=10 对于70%的数据：N&lt;=1000，M&lt;=1000 对于100%的数据：N&lt;=5000，M&lt;=50000 样例说明： 最优方案如下： 第一条流为4–&gt;3，流量为20，费用为3<em>20=60。 第二条流为4–&gt;2–&gt;3，流量为20，费用为（2+1）</em>20=60。 第三条流为4–&gt;2–&gt;1–&gt;3，流量为10，费用为（2+9+5）*10=160。 故最大流量为50，在此状况下最小费用为60+60+160=280。 故输出50 280。 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 5000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 50000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2147483647</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, m, s, t, tot, ans;</div><div class="line"><span class="keyword">int</span> pre[MAX_N+<span class="number">5</span>], match[MAX_N+<span class="number">5</span>], cnt;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span><span class="keyword">int</span> u, v, c, w, nxt;&#125; E[MAX_M*<span class="number">2</span>+MAX_N*<span class="number">2</span>+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;cnt = <span class="number">0</span>; <span class="built_in">memset</span>(pre, <span class="number">-1</span>, <span class="keyword">sizeof</span>(pre));&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> c, <span class="keyword">int</span> w)</span> </span>&#123;E[cnt].u = u, E[cnt].v = v, E[cnt].c = c, E[cnt].w = w, E[cnt].nxt = pre[u], pre[u] = cnt++;&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SPFA</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;</div><div class="line">	<span class="keyword">bool</span> inque[MAX_N+<span class="number">5</span>];</div><div class="line">	<span class="keyword">int</span> dis[MAX_N+<span class="number">5</span>], pree[MAX_N+<span class="number">5</span>];</div><div class="line">	<span class="built_in">memset</span>(inque, <span class="literal">false</span>, <span class="keyword">sizeof</span>(inque));</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	dis[i] = INF;</div><div class="line">	<span class="built_in">memset</span>(pree, <span class="number">-1</span>, <span class="keyword">sizeof</span>(pree));</div><div class="line">	dis[s] = <span class="number">0</span>, que.push(s), inque[s] = <span class="literal">true</span>;</div><div class="line">	<span class="keyword">while</span> (!que.empty()) &#123;</div><div class="line">		<span class="keyword">int</span> u = que.front();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = pre[u]; i != <span class="number">-1</span>; i = E[i].nxt) &#123;</div><div class="line">			<span class="keyword">int</span> v = E[i].v;</div><div class="line">			<span class="keyword">if</span> (E[i].c &amp;&amp; dis[u]+E[i].w &lt; dis[v]) &#123;</div><div class="line">				dis[v] = dis[u]+E[i].w, pree[v] = i;</div><div class="line">				<span class="keyword">if</span> (!inque[v])	que.push(v), inque[v] = <span class="literal">true</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		que.pop(), inque[u] = <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (dis[t] == INF)	<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	<span class="keyword">int</span> flow = INF;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = pree[t]; i != <span class="number">-1</span>; i = pree[E[i].u])	flow = min(flow, E[i].c);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = pree[t]; i != <span class="number">-1</span>; i = pree[E[i].u])	E[i].c -= flow, E[i^<span class="number">1</span>].c += flow;</div><div class="line">	tot += flow, ans += dis[t]*flow;</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;n, &amp;m, &amp;s, &amp;t);</div><div class="line">	init();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">		<span class="keyword">int</span> u, v, c, w;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;u, &amp;v, &amp;c, &amp;w);</div><div class="line">		insert(u, v, c, w), insert(v, u, <span class="number">0</span>, -w);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">while</span> (SPFA()) ;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%d %d"</span>, tot, ans);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="bipartite-matching">Bipartite Matching</h2>
<blockquote>
<p>【模板】二分图匹配</p>
<p>题目描述 给定一个二分图，结点个数分别为n，m，边数为e，求二分图最大匹配数</p>
<p>输入输出格式 输入格式： 第一行，n，m，e 第二至e+1行，每行两个正整数u，v，表示u,v有一条连边 输出格式： 共一行，二分图最大匹配</p>
<p>输入输出样例 输入样例： 1 1 1 1 1 输出样例： 1</p>
<p>说明 n,m&lt;=1000，1&lt;=u&lt;=n，1&lt;=v&lt;=m ### Hungary <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, m, e, match[MAX_N+<span class="number">5</span>], cnt;</div><div class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">bool</span> vis[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</div><div class="line">		<span class="keyword">int</span> v = G[u][i];</div><div class="line">		<span class="keyword">if</span> (!vis[v]) &#123;</div><div class="line">			vis[v] = <span class="literal">true</span>;</div><div class="line">			<span class="keyword">if</span> (!match[v] || DFS(match[v])) &#123;</div><div class="line">				match[v] = u;</div><div class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; e;</div><div class="line">	<span class="keyword">int</span> a, b;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; e; i++) &#123;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; a &gt;&gt; b;</div><div class="line">		<span class="keyword">if</span> (a &gt; n || b &gt; m)	<span class="keyword">continue</span>;</div><div class="line">		G[a].push_back(b);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">		<span class="built_in">memset</span>(vis, <span class="literal">false</span>, <span class="keyword">sizeof</span>(vis));</div><div class="line">		<span class="keyword">if</span> (DFS(i)) &#123;</div><div class="line">			cnt++;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">cout</span> &lt;&lt; cnt;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="dinic">Dinic</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 2000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 1000000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2147483647</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, m, s, t, n1, n2;</div><div class="line"><span class="keyword">int</span> pre[MAX_N+<span class="number">5</span>], tmp[MAX_N+<span class="number">5</span>], d[MAX_N+<span class="number">5</span>], cnt;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span><span class="keyword">int</span> v, c, nxt;&#125; E[MAX_M*<span class="number">2</span>+MAX_N*<span class="number">2</span>+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;cnt = <span class="number">0</span>; s = <span class="number">0</span>, t = n; <span class="built_in">memset</span>(pre, <span class="number">-1</span>, <span class="keyword">sizeof</span>(pre));&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> c)</span> </span>&#123;E[cnt].v = v, E[cnt].c = c, E[cnt].nxt = pre[u], pre[u] = cnt++;&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BFS</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">memset</span>(d, <span class="number">-1</span>, <span class="keyword">sizeof</span>(d));</div><div class="line">	<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;</div><div class="line">	que.push(s), d[s] = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span> (!que.empty()) &#123;</div><div class="line">		<span class="keyword">int</span> u = que.front();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = pre[u]; i != <span class="number">-1</span>; i = E[i].nxt) &#123;</div><div class="line">			<span class="keyword">int</span> v = E[i].v;</div><div class="line">			<span class="keyword">if</span> (E[i].c &amp;&amp; d[v] == <span class="number">-1</span>) &#123;</div><div class="line">				d[v] = d[u]+<span class="number">1</span>;</div><div class="line">				que.push(v);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		que.pop();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> d[t] != <span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> flow)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (u == t)	<span class="keyword">return</span> flow;</div><div class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = pre[u]; i != <span class="number">-1</span>; i = E[i].nxt) &#123;</div><div class="line">		<span class="keyword">int</span> v = E[i].v;</div><div class="line">		<span class="keyword">if</span> (E[i].c &amp;&amp; d[u]+<span class="number">1</span> == d[v]) &#123;</div><div class="line">			<span class="keyword">int</span> tmp = DFS(v, min(flow, E[i].c));</div><div class="line">			E[i].c -= tmp, E[i^<span class="number">1</span>].c += tmp, flow -= tmp, ret += tmp;</div><div class="line">			<span class="keyword">if</span> (!flow)	<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (!ret)	d[u] = <span class="number">-1</span>;</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Dinic</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++)	tmp[i] = pre[i];</div><div class="line">	<span class="keyword">while</span> (BFS()) &#123;</div><div class="line">		ret += DFS(s, INF);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++)	pre[i] = tmp[i];</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n1, &amp;n2, &amp;m);	n = n1+n2+<span class="number">1</span>;</div><div class="line">	init();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n1; i++)	insert(s, i, <span class="number">1</span>), insert(i, s, <span class="number">0</span>);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = n1+<span class="number">1</span>; i &lt;= n1+n2; i++)	insert(i, t, <span class="number">1</span>), insert(t, i, <span class="number">0</span>);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">		<span class="keyword">int</span> u, v;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v);</div><div class="line">		<span class="keyword">if</span> (u &gt; n1 || v &gt; n2)	<span class="keyword">continue</span>;</div><div class="line">		insert(u, n1+v, <span class="number">1</span>), insert(n1+v, u, <span class="number">0</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%d"</span>, Dinic());</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="math-theory">Math Theory</h1>
<h2 id="gauss-elimination">Gauss Elimination</h2>
<blockquote>
<p>【模板】高斯消元</p>
<p>题目背景 Gauss消元</p>
<p>题目描述 给定一个线性方程组，对其求解</p>
<p>输入输出格式 输入格式： 第一行，一个正整数n 第二至n+1行，每行n+1个整数，为a1,a2,…an和b，代表一组方程。 输出格式： 共n行，每行一个数，第i行为xi（保留2位小数） 如果无解或不存在唯一解，在第一行输出“No Solution”.</p>
<p>输入输出样例 输入样例#1： 3 1 3 4 5 1 4 7 3 9 3 2 2 输出样例#1： -0.97 5.18 -2.39</p>
<p>说明 1≤n≤100，|ai|≤1e4，|b|≤1e4 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> EXP 1e-7</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> fnt;</div><div class="line"><span class="keyword">int</span> n;	<span class="built_in">vector</span> &lt;fnt&gt; f[MAX_N+<span class="number">5</span>];	fnt ans[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">gauss</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, tmp; i &lt;= n; i++) &#123;</div><div class="line">		<span class="keyword">for</span> (tmp = i; tmp &lt;= n; tmp++)	<span class="keyword">if</span> (f[tmp][i] &lt;= -EXP || f[tmp][i] &gt;= EXP)	<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">if</span> (tmp &gt; n)	<span class="keyword">return</span> <span class="literal">false</span>;	swap(f[i], f[tmp]);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</div><div class="line">			fnt div = f[j][i]/f[i][i];	<span class="keyword">if</span> (j == i)	<span class="keyword">continue</span>;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = i; k &lt;= n+<span class="number">1</span>; k++)	f[j][k] -= f[i][k]*div;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	ans[i] = f[i][n+<span class="number">1</span>]/f[i][i];</div><div class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">		f[i].push_back(<span class="number">0</span>);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n+<span class="number">1</span>; j++) &#123;</div><div class="line">			fnt x;	<span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;x);</div><div class="line">			f[i].push_back(x);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (gauss())	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">printf</span>(<span class="string">"%.2lf\n"</span>, ans[i]);</div><div class="line">	<span class="keyword">else</span>	<span class="built_in">printf</span>(<span class="string">"No Solution"</span>);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="inverse">Inverse</h2>
<blockquote>
<p>【模板】乘法逆元</p>
<p>题目背景 这是一道模板题</p>
<p>题目描述 给定n,p求1~n中所有整数在模p意义下的乘法逆元。</p>
<p>输入输出格式 输入格式： 一行n,p 输出格式： n行,第i行表示i在模p意义下的逆元。</p>
<p>输入输出样例 输入样例#1： 10 13 输出样例#1： 1 7 9 10 8 11 2 5 3 4</p>
<p>说明 1≤n≤3*1e6,n<p<20000528 输入保证p为质数。="" <figure="" class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 3000000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lnt;</div><div class="line">lnt inv[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n, lnt p)</span> </span>&#123;inv[<span class="number">0</span>] = inv[<span class="number">1</span>] = <span class="number">1</span>;	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++)	inv[i] = (p-p/i*inv[p%i]%p)%p;&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> n;	lnt p;	<span class="built_in">scanf</span>(<span class="string">"%d%lld"</span>, &amp;n, &amp;p);</div><div class="line">	init(n, p);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, inv[i]);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></p<20000528></p>
</blockquote>
<h2 id="linear-basis">Linear Basis</h2>
<blockquote>
<p>【模板】线性基</p>
<p>题目背景 这是一道模板题。</p>
<p>题目描述 给定n个整数（数字可能重复），求在这些数中选取任意个，使得他们的异或和最大。</p>
<p>输入输出格式 输入格式： 第一行一个数n，表示元素个数 接下来一行n个数 输出格式： 仅一行，表示答案。</p>
<p>输入输出样例 输入样例#1： 2 1 1 输出样例#1： 1</p>
<p>说明 1≤n≤50，0≤Si≤2^50 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 50</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lnt;</div><div class="line"><span class="keyword">int</span> n;	lnt base[MAX_N+<span class="number">5</span>], <span class="built_in">pow</span>[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);	<span class="built_in">pow</span>[<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= MAX_N; i++)	<span class="built_in">pow</span>[i] = <span class="built_in">pow</span>[i<span class="number">-1</span>]*<span class="number">2</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">		lnt x;	<span class="built_in">scanf</span>(<span class="string">"%lld"</span>, &amp;x);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = MAX_N; j &gt;= <span class="number">0</span>; j--)	<span class="keyword">if</span> (<span class="built_in">pow</span>[j]&amp;x) &#123;</div><div class="line">			<span class="keyword">if</span> (base[j])	x ^= base[j];</div><div class="line">			<span class="keyword">else</span> &#123;base[j] = x;	<span class="keyword">break</span>;&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	lnt ans = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = MAX_N; i &gt;= <span class="number">0</span>; i--)	<span class="keyword">if</span> ((ans^<span class="built_in">pow</span>[i]) &gt; ans)	ans ^= base[i];</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%lld"</span>, ans);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="lucas">Lucas</h2>
<blockquote>
<p>【模板】卢卡斯定理</p>
<p>题目背景 这是一道模板题。</p>
<p>题目描述 给定n,m,p(1≤n,m,p≤1e5)，求C(n+m,m)。 保证P为prime 一个测试点内包含多组数据。</p>
<p>输入输出格式 输入格式： 第一行一个整数T(T≤10)，表示数据组数 第二行开始共T行，每行三个数n m p，意义如上 输出格式： 共T行，每行一个整数表示答案。</p>
<p>输入输出样例 输入样例#1： 2 1 2 5 2 1 5 输出样例#1： 3 3 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_P 100000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lnt;</div><div class="line">lnt f[MAX_P+<span class="number">5</span>] = &#123;<span class="number">1</span>&#125;;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(lnt p)</span> </span>&#123;<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= MAX_P; i++)	f[i] = f[i<span class="number">-1</span>]*i%p;&#125;</div><div class="line"><span class="function">lnt <span class="title">FLT</span><span class="params">(lnt x, lnt p)</span> </span>&#123;</div><div class="line">	lnt ret = <span class="number">1</span>;	x %= p;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> k = p<span class="number">-2</span>; k; k &gt;&gt;= <span class="number">1</span>)	ret = k%<span class="number">2</span> ? ret*x%p : ret, x = x*x%p;</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function">lnt <span class="title">lucas</span><span class="params">(lnt n, lnt m, lnt p)</span> </span>&#123;<span class="keyword">return</span> m ? (n%p &gt;= m%p ? f[n%p]*FLT(f[m%p]*f[n%p-m%p], p)*lucas(n/p, m/p, p)%p : <span class="number">0</span>) : <span class="number">1</span>;&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> T;	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T);</div><div class="line">	<span class="keyword">while</span> (T--) &#123;</div><div class="line">		lnt n, m, p;	<span class="built_in">scanf</span>(<span class="string">"%lld%lld%lld"</span>, &amp;n, &amp;m, &amp;p);</div><div class="line">		init(p), <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, lucas(n+m, min(n, m), p)%p);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="matrix-fast-power">Matrix Fast Power</h2>
<blockquote>
<p>【模板】矩阵快速幂</p>
<p>题目描述 给定n*n的矩阵A，求A^k</p>
<p>输入输出格式 输入格式： 第一行，n,k 第2至n+1行，每行n个数，第i+1行第j个数表示矩阵第i行第j列的元素 输出格式： 输出A<sup>k 共n行，每行n个数，第i行第j个数表示矩阵第i行第j列的元素，每个元素模10</sup>9+7</p>
<p>输入输出样例 输入样例： 2 1 1 1 1 1 输出样例： 1 1 1 1</p>
<p>说明 n&lt;=100, k&lt;=10^12, |矩阵元素|&lt;=1000 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MOD 1000000007</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span> &#123;</span></div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ele[MAX_N][MAX_N];</div><div class="line">    <span class="keyword">inline</span> Matrix <span class="keyword">operator</span> * (<span class="keyword">const</span> Matrix &amp;x) <span class="keyword">const</span> &#123;</div><div class="line">        Matrix ret;</div><div class="line">        <span class="built_in">memset</span>(ret.ele, <span class="number">0</span>, <span class="keyword">sizeof</span>(ret.ele));</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; k++)</div><div class="line">                    ret.ele[i][j] = (ret.ele[i][j]+ele[i][k]*x.ele[k][j])%MOD;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function">Matrix <span class="title">Power</span><span class="params">(Matrix a, <span class="keyword">long</span> <span class="keyword">long</span> k)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (k == <span class="number">1</span>)    <span class="keyword">return</span> a;</div><div class="line">    Matrix ret = Power(a, k/<span class="number">2</span>);</div><div class="line">    <span class="keyword">if</span> (k%<span class="number">2</span>)    <span class="keyword">return</span> a*ret*ret;</div><div class="line">    <span class="keyword">return</span> ret*ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> k;</div><div class="line">    Matrix a;</div><div class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; k;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</div><div class="line">            <span class="built_in">cin</span> &gt;&gt; a.ele[i][j];</div><div class="line">    a = Power(a, k);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</div><div class="line">            <span class="built_in">cout</span> &lt;&lt; a.ele[i][j] &lt;&lt; <span class="string">" "</span>;</div><div class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="prime-sieve">Prime Sieve</h2>
<blockquote>
<p>【模板】线性筛素数</p>
<p>题目描述 如题，给定一个范围N，你需要处理M个某数字是否为质数的询问（每个数字均在范围1-N内）</p>
<p>输入输出格式 输入格式： 第一行包含两个正整数N、M，分别表示查询的范围和查询的个数。 接下来M行每行包含一个不小于1且不大于N的整数，即询问概数是否为质数。 输出格式： 输出包含M行，每行为Yes或No，即依次为每一个询问的结果。</p>
<p>输入输出样例 输入样例： 100 5 2 3 4 91 97 输出样例： Yes Yes No No Yes</p>
<p>说明 时空限制：500ms 128M 数据规模： 对于30%的数据：N&lt;=10000，M&lt;=10000 对于100%的数据：N&lt;=10000000，M&lt;=100000</p>
<p>样例说明： N=100，说明接下来的询问数均不大于100且大于1。 所以2、3、97为质数，4、91非质数。 故依次输出Yes、Yes、No、No、Yes。 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 10000000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, m;</div><div class="line"><span class="keyword">bool</span> IsPrime[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> pri[MAX_N+<span class="number">5</span>], cnt = <span class="number">0</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">FindPrime</span><span class="params">()</span> </span>&#123;</div><div class="line">	IsPrime[<span class="number">0</span>] = IsPrime[<span class="number">1</span>] = <span class="literal">false</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</div><div class="line">		<span class="keyword">if</span> (IsPrime) &#123;</div><div class="line">			pri[cnt++] = i;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; cnt; j++) &#123;</div><div class="line">			<span class="keyword">if</span> (i*pri[j] &gt; n)	<span class="keyword">break</span>;</div><div class="line">			IsPrime[i*pri[j]] = <span class="literal">false</span>;</div><div class="line">			<span class="keyword">if</span> (i%pri[j] == <span class="number">0</span>)	<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">memset</span>(IsPrime, <span class="literal">true</span>, <span class="keyword">sizeof</span>(IsPrime));</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; n;</div><div class="line">	FindPrime();</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; m;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">		<span class="keyword">int</span> x;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; x;</div><div class="line">		<span class="keyword">if</span> (IsPrime[x]) &#123;</div><div class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"Yes"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"No"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="trigeminal-search">Trigeminal Search</h2>
<blockquote>
<p>【模板】三分法</p>
<p>题目描述 如题，给出一个N次函数，保证在范围[l,r]内存在一点x，使得[l,x]上单调增，[x,r]上单调减。试求出x的值。</p>
<p>输入输出格式 输入格式： 第一行一次包含一个正整数N和两个实数l、r，含义如题目描述所示。 第二行包含N+1个实数，从高到低依次表示该N次函数各项的系数。 输出格式： 输出为一行，包含一个实数，即为x的值。四舍五入保留5位小数。</p>
<p>输入输出样例 输入样例： 3 -0.9981 0.5 1 -3 -3 1 输出样例： -0.41421</p>
<p>说明 时空限制：50ms,128M 数据规模： 对于100%的数据：7&lt;=N&lt;=13 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n;</div><div class="line"><span class="keyword">double</span> s, t;</div><div class="line"><span class="keyword">double</span> a[<span class="number">14</span>];</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">calc</span><span class="params">(<span class="keyword">double</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">double</span> tot = <span class="number">0</span>, tmp = <span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++) &#123;</div><div class="line">        tot += tmp*a[i];</div><div class="line">        tmp *= x;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> tot;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">double</span> l, <span class="keyword">double</span> r)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(r-l) &lt;= <span class="number">0.000001</span>) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%.5f"</span>, l);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">double</span> ml = (<span class="number">2</span>*l+r)/<span class="number">3</span>, mr = (l+<span class="number">2</span>*r)/<span class="number">3</span>;</div><div class="line">    <span class="keyword">if</span> (calc(ml) &gt; calc(mr)) &#123;</div><div class="line">        f(l, mr);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        f(ml, r);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; s &gt;&gt; t;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="built_in">cin</span> &gt;&gt; a[i];</div><div class="line">    &#125;</div><div class="line">    f(s, t);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="data-structure">Data Structure</h1>
<h2 id="heap">Heap</h2>
<blockquote>
<p>【模板】堆</p>
<p>题目描述 如题，初始小根堆为空，我们需要支持以下3种操作： 操作1： 1 x 表示将x插入到堆中 操作2： 2 输出该小根堆内的最小数 操作3： 3 删除该小根堆内的最小数</p>
<p>输入输出格式 输入格式： 第一行包含一个整数N，表示操作的个数 接下来N行，每行包含1个或2个正整数，表示三种操作，格式如下： 操作1： 1 x 操作2： 2 操作3： 3 输出格式： 包含若干行正整数，每行依次对应一个操作2的结果。</p>
<p>输入输出样例 输入样例： 5 1 2 1 5 2 3 2 输出样例： 2 5</p>
<p>说明 时空限制：1000ms,128M 数据规模： 对于30%的数据：N&lt;=15 对于70%的数据：N&lt;=10000 对于100%的数据：N&lt;=1000000 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, heap[<span class="number">1000000</span>+<span class="number">5</span>], size = <span class="number">0</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    size++;</div><div class="line">    heap[size] = x;</div><div class="line">    <span class="keyword">int</span> current = size;</div><div class="line">    <span class="keyword">int</span> father = current/<span class="number">2</span>;</div><div class="line">    <span class="keyword">while</span> (father &gt; <span class="number">0</span> &amp;&amp; heap[father] &gt; heap[current]) &#123;</div><div class="line">        swap(heap[father], heap[current]);</div><div class="line">        current = father;</div><div class="line">        father = current/<span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</div><div class="line">    heap[<span class="number">1</span>] = heap[size];</div><div class="line">    size--;</div><div class="line">    <span class="keyword">int</span> current = <span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> child = current*<span class="number">2</span>;</div><div class="line">    <span class="keyword">if</span> (child &lt; size &amp;&amp; heap[child] &gt; heap[child+<span class="number">1</span>])    child++;</div><div class="line">    <span class="keyword">while</span> (child &lt;= size &amp;&amp; heap[current] &gt; heap[child]) &#123;</div><div class="line">        swap(heap[current], heap[child]);</div><div class="line">        current = child;</div><div class="line">        child = <span class="number">2</span>*current;</div><div class="line">        <span class="keyword">if</span> (child &lt; size &amp;&amp; heap[child] &gt; heap[child+<span class="number">1</span>])    child++;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">cin</span> &gt;&gt; n;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">int</span> f;</div><div class="line">        <span class="built_in">cin</span> &gt;&gt; f;</div><div class="line">        <span class="keyword">if</span> (f == <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">int</span> x;</div><div class="line">            <span class="built_in">cin</span> &gt;&gt; x;</div><div class="line">            insert(x);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (f == <span class="number">2</span>) &#123;</div><div class="line">            <span class="built_in">cout</span> &lt;&lt; heap[<span class="number">1</span>] &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            pop();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="mergeable-heap">Mergeable Heap</h2>
<blockquote>
<p>【模板】左偏树（可并堆）</p>
<p>题目描述 如题，一开始有N个小根堆，每个堆包含且仅包含一个数。接下来需要支持两种操作： 操作1： 1 x y 将第x个数和第y个数所在的小根堆合并（若第x或第y个数已经被删除或第x和第y个数在用一个堆内，则无视此操作） 操作2： 2 x 输出第x个数所在的堆最小数，并将其删除（若第x个数已经被删除，则输出-1并无视删除操作）</p>
<p>输入输出格式 输入格式： 第一行包含两个正整数N、M，分别表示一开始小根堆的个数和接下来操作的个数。 第二行包含N个正整数，其中第i个正整数表示第i个小根堆初始时包含且仅包含的数。 接下来M行每行2个或3个正整数，表示一条操作，格式如下： 操作1 ： 1 x y 操作2 ： 2 x 输出格式： 输出包含若干行整数，分别依次对应每一个操作2所得的结果。</p>
<p>输入输出样例 输入样例#1： 5 5 1 5 4 2 3 1 1 5 1 2 5 2 2 1 4 2 2 2 输出样例#1： 1 2</p>
<p>说明 当堆里有多个最小值时，优先删除原序列的靠前的，否则会影响后续操作1导致WA。 时空限制：1000ms，128M 数据规模： 对于30%的数据：N&lt;=10，M&lt;=10 对于70%的数据：N&lt;=1000，M&lt;=1000 对于100%的数据：N&lt;=100000，M&lt;=100000 样例说明： 初始状态下，五个小根堆分别为:{1}、{5}、{4}、{2}、{3}。 第一次操作，将第1个数所在的小根堆与第5个数所在的小根堆合并，故变为四个小根堆：{1,3}、{5}、{4}、{2}。 第二次操作，将第2个数所在的小根堆与第5个数所在的小根堆合并，故变为三个小根堆：{1,3,5}、{4}、{2}。 第三次操作，将第2个数所在的小根堆的最小值输出并删除，故输出1，第一个数被删除，三个小根堆为：{3,5}、{4}、{2}。 第四次操作，将第4个数所在的小根堆与第2个数所在的小根堆合并，故变为两个小根堆：{2,3,5}、{4}。 第五次操作，将第2个数所在的小根堆的最小值输出并删除，故输出2，第四个数被删除，两个小根堆为：{3,5}、{4}。 故输出依次为1、2。 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span><span class="keyword">int</span> val, dis, ls, rs;&#125; heap[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> n, m, fa[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getf</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;<span class="keyword">return</span> fa[x] == x ? fa[x] : getf(fa[x]);&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (!a || !b)	<span class="keyword">return</span> a^b;</div><div class="line">	<span class="keyword">if</span> (heap[a].val &gt; heap[b].val || (heap[a].val == heap[b].val &amp;&amp; a &gt; b))	swap(a, b);</div><div class="line">	heap[a].rs = merge(heap[a].rs, b), fa[heap[a].rs] = a;</div><div class="line">	<span class="keyword">if</span> (heap[heap[a].rs].dis &gt; heap[heap[a].ls].dis)	swap(heap[a].ls, heap[a].rs);</div><div class="line">	heap[a].dis = heap[a].rs == <span class="number">0</span> ? <span class="number">0</span> : heap[heap[a].rs].dis+<span class="number">1</span>;	<span class="keyword">return</span> a;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">pop</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> l = heap[a].ls, r = heap[a].rs;</div><div class="line">	heap[a].ls = heap[a].rs = heap[a].val = <span class="number">0</span>, fa[l] = l, fa[r] = r;</div><div class="line">	<span class="keyword">return</span> merge(l, r);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;heap[i].val), fa[i] = i;</div><div class="line">	<span class="keyword">while</span> (m--) &#123;</div><div class="line">		<span class="keyword">int</span> opt;	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;opt);</div><div class="line">		<span class="keyword">if</span> (opt == <span class="number">1</span>) &#123;</div><div class="line">			<span class="keyword">int</span> x, y;	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y), x = getf(x), y = getf(y);</div><div class="line">			<span class="keyword">if</span> (heap[x].val &amp;&amp; heap[y].val &amp;&amp; x != y)	merge(x, y);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (opt == <span class="number">2</span>) &#123;</div><div class="line">			<span class="keyword">int</span> x;	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x), x = getf(x);</div><div class="line">			<span class="keyword">if</span> (!heap[x].val)	<span class="built_in">printf</span>(<span class="string">"-1\n"</span>);</div><div class="line">			<span class="keyword">else</span>	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, heap[x].val), pop(x);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="binary-indexed-tree">Binary Indexed Tree</h2>
<h3 id="section">1</h3>
<blockquote>
<p>【模板】树状数组 1</p>
<p>题目描述 如题，已知一个数列，你需要进行下面两种操作： 1.将某一个数加上x 2.求出某区间每一个数的和</p>
<p>输入输出格式 输入格式： 第一行包含两个整数N、M，分别表示该数列数字的个数和操作的总个数。 第二行包含N个用空格分隔的整数，其中第i个数字表示数列第i项的初始值。 接下来M行每行包含3或4个整数，表示一个操作，具体如下： 操作1： 格式：1 x k 含义：将第x个数加上k 操作2： 格式：2 x y 含义：输出区间[x,y]内每个数的和 输出格式： 输出包含若干行整数，即为所有操作2的结果。</p>
<p>输入输出样例 输入样例： 5 5 1 5 4 2 3 1 1 3 2 2 5 1 3 -1 1 4 2 2 1 4 输出样例： 14 16</p>
<p>说明 时空限制：1000ms,128M 数据规模： 对于30%的数据：N&lt;=8，M&lt;=10 对于70%的数据：N&lt;=10000，M&lt;=10000 对于100%的数据：N&lt;=500000，M&lt;=500000 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 500000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, m;</div><div class="line"><span class="keyword">int</span> tree[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> x&amp;(-x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">	<span class="keyword">while</span> (pos &lt;= n) &#123;</div><div class="line">		tree[pos] += x;</div><div class="line">		pos += lowbit(pos);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> t)</span> </span>&#123;</div><div class="line">	<span class="keyword">long</span> <span class="keyword">long</span> tot = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span> (t &gt; <span class="number">0</span>) &#123;</div><div class="line">		tot += tree[t];</div><div class="line">		t -= lowbit(t);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> tot;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">memset</span>(tree, <span class="number">0</span>, <span class="keyword">sizeof</span>(tree));</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">		<span class="keyword">int</span> tmp;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; tmp;</div><div class="line">		modify(i, tmp);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">		<span class="keyword">int</span> f, a, b;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; f &gt;&gt; a &gt;&gt; b;</div><div class="line">		<span class="keyword">if</span> (f == <span class="number">1</span>) &#123;</div><div class="line">			modify(a, b);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="built_in">cout</span> &lt;&lt; query(b)-query(a<span class="number">-1</span>) &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="section-1">2</h3>
<blockquote>
<p>【模板】树状数组 2</p>
<p>题目描述 如题，已知一个数列，你需要进行下面两种操作： 1.将某区间每一个数数加上x 2.求出某一个数</p>
<p>输入输出格式 输入格式： 第一行包含两个整数N、M，分别表示该数列数字的个数和操作的总个数。 第二行包含N个用空格分隔的整数，其中第i个数字表示数列第i项的初始值。 接下来M行每行包含3或4个整数，表示一个操作，具体如下： 操作1： 格式：1 x y k 含义：将区间[x,y]内每个数加上k 操作2： 格式：2 x 含义：输出第x个数的值 输出格式： 输出包含若干行整数，即为所有操作2的结果。</p>
<p>输入输出样例 输入样例： 5 5 1 5 4 2 3 1 2 4 2 2 3 1 1 5 -1 1 3 5 7 2 4 输出样例： 6 10</p>
<p>说明 时空限制：1000ms,128M 数据规模： 对于30%的数据：N&lt;=8，M&lt;=10 对于70%的数据：N&lt;=10000，M&lt;=10000 对于100%的数据：N&lt;=500000，M&lt;=500000 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 500000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, m;</div><div class="line"><span class="keyword">int</span> tree[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> x&amp;(-x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">	<span class="keyword">while</span> (pos &lt;= n) &#123;</div><div class="line">		tree[pos] += x;</div><div class="line">		pos += lowbit(pos);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</div><div class="line">	<span class="keyword">long</span> <span class="keyword">long</span> tot = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span> (pos &gt; <span class="number">0</span>) &#123;</div><div class="line">		tot += tree[pos];</div><div class="line">		pos -= lowbit(pos);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> tot;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">memset</span>(tree, <span class="number">0</span>, <span class="keyword">sizeof</span>(tree));</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">		<span class="keyword">int</span> x;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; x;</div><div class="line">		modify(i, x);</div><div class="line">		modify(i+<span class="number">1</span>, -x);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">		<span class="keyword">int</span> f;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; f;</div><div class="line">		<span class="keyword">if</span> (f == <span class="number">1</span>) &#123;</div><div class="line">			<span class="keyword">int</span> l, r, x;</div><div class="line">			<span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r &gt;&gt; x;</div><div class="line">			modify(l, x);</div><div class="line">			modify(r+<span class="number">1</span>, -x);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">int</span> x;</div><div class="line">			<span class="built_in">cin</span> &gt;&gt; x;</div><div class="line">			<span class="built_in">cout</span> &lt;&lt; query(x) &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="segment-tree">Segment Tree</h2>
<h3 id="section-2">1</h3>
<blockquote>
<p>【模板】线段树 1</p>
<p>题目描述 如题，已知一个数列，你需要进行下面两种操作： 1.将某区间每一个数加上x 2.求出某区间每一个数的和</p>
<p>输入输出格式 输入格式： 第一行包含两个整数N、M，分别表示该数列数字的个数和操作的总个数。 第二行包含N个用空格分隔的整数，其中第i个数字表示数列第i项的初始值。 接下来M行每行包含3或4个整数，表示一个操作，具体如下： 操作1： 格式：1 x y k 含义：将区间[x,y]内每个数加上k 操作2： 格式：2 x y 含义：输出区间[x,y]内每个数的和 输出格式： 输出包含若干行整数，即为所有操作2的结果。</p>
<p>输入输出样例 输入样例： 5 5 1 5 4 2 3 2 2 4 1 2 3 2 2 3 4 1 1 5 1 2 1 4 输出样例： 11 8 20</p>
<p>说明 时空限制：1000ms,128M 数据规模： 对于30%的数据：N&lt;=8，M&lt;=10 对于70%的数据：N&lt;=1000，M&lt;=10000 对于100%的数据：N&lt;=100000，M&lt;=100000 （数据保证在int64/long long数据范围内） <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, k;</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> tree[MAX_N*<span class="number">4</span>+<span class="number">50</span>], tag[MAX_N*<span class="number">4</span>+<span class="number">50</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">    tree[v] = tree[v*<span class="number">2</span>]+tree[v*<span class="number">2</span>+<span class="number">1</span>];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">downtag</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</div><div class="line">    tag[v*<span class="number">2</span>] += tag[v];</div><div class="line">    tag[v*<span class="number">2</span>+<span class="number">1</span>] += tag[v];</div><div class="line">    <span class="keyword">int</span> m = (s+t)/<span class="number">2</span>;</div><div class="line">    tree[v*<span class="number">2</span>] += tag[v]*(m-s+<span class="number">1</span>);</div><div class="line">    tree[v*<span class="number">2</span>+<span class="number">1</span>] += tag[v]*(t-m);</div><div class="line">    tag[v] = <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) &#123;</div><div class="line">        tree[v] += x*(t-s+<span class="number">1</span>);</div><div class="line">        tag[v] += x;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> m = (s+t)/<span class="number">2</span>;</div><div class="line">    downtag(v, s, t);</div><div class="line">    <span class="keyword">if</span> (l &lt;= m) &#123;</div><div class="line">        modify(v*<span class="number">2</span>, s, m, l, r, x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (r &gt;= m+<span class="number">1</span>) &#123;</div><div class="line">        modify(v*<span class="number">2</span>+<span class="number">1</span>, m+<span class="number">1</span>, t, l, r, x);</div><div class="line">    &#125;</div><div class="line">    updata(v);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (s == t) &#123;</div><div class="line">        <span class="built_in">cin</span> &gt;&gt; tree[v];</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> m = (s+t)/<span class="number">2</span>;</div><div class="line">    build(v*<span class="number">2</span>, s, m);</div><div class="line">    build(v*<span class="number">2</span>+<span class="number">1</span>, m+<span class="number">1</span>, t);</div><div class="line">    updata(v);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) &#123;</div><div class="line">        <span class="keyword">return</span> tree[v];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> m = (s+t)/<span class="number">2</span>;</div><div class="line">    downtag(v, s, t);</div><div class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span> (l &lt;= m) &#123;</div><div class="line">        ret += query(v*<span class="number">2</span>, s, m, l, r);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (r &gt;= m+<span class="number">1</span>) &#123;</div><div class="line">        ret += query(v*<span class="number">2</span>+<span class="number">1</span>, m+<span class="number">1</span>, t, l, r);</div><div class="line">    &#125;</div><div class="line">    updata(v);</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; k;</div><div class="line">    build(<span class="number">1</span>, <span class="number">1</span>, n);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</div><div class="line">        <span class="keyword">int</span> f, l, r, x;</div><div class="line">        <span class="built_in">cin</span> &gt;&gt; f;</div><div class="line">        <span class="keyword">if</span> (f == <span class="number">1</span>) &#123;</div><div class="line">            <span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r &gt;&gt; x;</div><div class="line">            modify(<span class="number">1</span>, <span class="number">1</span>, n, l, r, x);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r;</div><div class="line">            <span class="built_in">cout</span> &lt;&lt; query(<span class="number">1</span>, <span class="number">1</span>, n, l, r) &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="section-3">2</h3>
<blockquote>
<p>【模板】线段树 2</p>
<p>题目描述 如题，已知一个数列，你需要进行下面两种操作： 1.将某区间每一个数加上x 2.将某区间每一个数乘上x 3.求出某区间每一个数的和</p>
<p>输入输出格式 输入格式： 第一行包含三个整数N、M、P，分别表示该数列数字的个数、操作的总个数和模数。 第二行包含N个用空格分隔的整数，其中第i个数字表示数列第i项的初始值。 接下来M行每行包含3或4个整数，表示一个操作，具体如下： 操作1： 格式：1 x y k 含义：将区间[x,y]内每个数乘上k 操作2： 格式：2 x y k 含义：将区间[x,y]内每个数加上k 操作3： 格式：3 x y 含义：输出区间[x,y]内每个数的和对P取模所得的结果 输出格式： 输出包含若干行整数，即为所有操作3的结果。</p>
<p>输入输出样例 输入样例： 5 5 38 1 5 4 2 3 2 1 4 1 3 2 5 1 2 4 2 2 3 5 5 3 1 4 输出样例： 17 2</p>
<p>说明 时空限制：1000ms,128M 数据规模： 对于30%的数据：N&lt;=8，M&lt;=10 对于70%的数据：N&lt;=1000，M&lt;=10000 对于100%的数据：N&lt;=100000，M&lt;=100000 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, m;</div><div class="line">ll p;</div><div class="line">ll tree[MAX_N*<span class="number">4</span>+<span class="number">5</span>], mul[MAX_N*<span class="number">4</span>+<span class="number">5</span>], add[MAX_N*<span class="number">4</span>+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">	tree[v] = (tree[v*<span class="number">2</span>]+tree[v*<span class="number">2</span>+<span class="number">1</span>])%p;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">downtag</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> mid)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (mul[v] == <span class="number">1</span> &amp;&amp; add[v] == <span class="number">0</span>)	<span class="keyword">return</span>;</div><div class="line">	mul[v*<span class="number">2</span>] = mul[v*<span class="number">2</span>]*mul[v]%p;</div><div class="line">	add[v*<span class="number">2</span>] = (add[v*<span class="number">2</span>]*mul[v]%p+add[v])%p;</div><div class="line">	tree[v*<span class="number">2</span>] = (tree[v*<span class="number">2</span>]*mul[v]%p+add[v]*(ll)(mid-s+<span class="number">1</span>)%p)%p;</div><div class="line">	mul[v*<span class="number">2</span>+<span class="number">1</span>] = mul[v*<span class="number">2</span>+<span class="number">1</span>]*mul[v]%p;</div><div class="line">	add[v*<span class="number">2</span>+<span class="number">1</span>] = (add[v*<span class="number">2</span>+<span class="number">1</span>]*mul[v]%p+add[v])%p;</div><div class="line">	tree[v*<span class="number">2</span>+<span class="number">1</span>] = (tree[v*<span class="number">2</span>+<span class="number">1</span>]*mul[v]%p+add[v]*(ll)(t-mid)%p)%p;</div><div class="line">	mul[v] = <span class="number">1</span>;</div><div class="line">	add[v] = <span class="number">0</span>;</div><div class="line">	<span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">create</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</div><div class="line">	mul[v] = <span class="number">1</span>;</div><div class="line">	add[v] = <span class="number">0</span>;</div><div class="line">	<span class="keyword">if</span> (s == t) &#123;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; tree[v];</div><div class="line">		tree[v] %= p;</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">int</span> mid = (s+t)/<span class="number">2</span>;</div><div class="line">	create(v*<span class="number">2</span>, s, mid);</div><div class="line">	create(v*<span class="number">2</span>+<span class="number">1</span>, mid+<span class="number">1</span>, t);</div><div class="line">	updata(v);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify1</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) &#123;</div><div class="line">		add[v] = (add[v]+(ll)x)%p;</div><div class="line">		tree[v] = (tree[v]+(ll)x*(ll)(t-s+<span class="number">1</span>)%p)%p;</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">int</span> mid = (s+t)/<span class="number">2</span>;</div><div class="line">	downtag(v, s, t, mid);</div><div class="line">	<span class="keyword">if</span> (l &lt;= mid) &#123;</div><div class="line">		modify1(v*<span class="number">2</span>, s, mid, l, r, x);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (r &gt;= mid+<span class="number">1</span>) &#123;</div><div class="line">		modify1(v*<span class="number">2</span>+<span class="number">1</span>, mid+<span class="number">1</span>, t, l, r, x);</div><div class="line">	&#125;</div><div class="line">	updata(v);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify2</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) &#123;</div><div class="line">		mul[v] = mul[v]*(ll)x%p;</div><div class="line">		add[v] = add[v]*(ll)x%p;</div><div class="line">		tree[v] = tree[v]*(ll)x%p;</div><div class="line">		<span class="keyword">return</span>; </div><div class="line">	&#125;</div><div class="line">	<span class="keyword">int</span> mid = (s+t)/<span class="number">2</span>;</div><div class="line">	downtag(v, s, t, mid);</div><div class="line">	<span class="keyword">if</span> (l &lt;= mid) &#123;</div><div class="line">		modify2(v*<span class="number">2</span>, s, mid, l, r, x);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (r &gt;= mid+<span class="number">1</span>) &#123;</div><div class="line">		modify2(v*<span class="number">2</span>+<span class="number">1</span>, mid+<span class="number">1</span>, t, l, r, x);</div><div class="line">	&#125;</div><div class="line">	updata(v);</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) &#123;</div><div class="line">		<span class="keyword">return</span> tree[v];</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">int</span> mid = (s+t)/<span class="number">2</span>;</div><div class="line">	ll ret = <span class="number">0</span>;</div><div class="line">	downtag(v, s, t, mid);</div><div class="line">	<span class="keyword">if</span> (l &lt;= mid) &#123;</div><div class="line">		ret = (ret+query(v*<span class="number">2</span>, s, mid, l, r))%p;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (r &gt;= mid+<span class="number">1</span>) &#123;</div><div class="line">		ret = (ret+query(v*<span class="number">2</span>+<span class="number">1</span>, mid+<span class="number">1</span>, t, l, r))%p;</div><div class="line">	&#125;</div><div class="line">	updata(v);</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; p;</div><div class="line">	create(<span class="number">1</span>, <span class="number">1</span>, n);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">		<span class="keyword">int</span> f;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; f;</div><div class="line">		<span class="keyword">if</span> (f == <span class="number">1</span>) &#123;</div><div class="line">			<span class="keyword">int</span> l, r, x;</div><div class="line">			<span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r &gt;&gt; x;</div><div class="line">			modify2(<span class="number">1</span>, <span class="number">1</span>, n, l, r, x%p);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (f == <span class="number">2</span>) &#123;</div><div class="line">			<span class="keyword">int</span> l, r, x;</div><div class="line">			<span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r &gt;&gt; x;</div><div class="line">			modify1(<span class="number">1</span>, <span class="number">1</span>, n, l, r, x%p);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">int</span> l, r;</div><div class="line">			<span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r;</div><div class="line">			<span class="built_in">cout</span> &lt;&lt; query(<span class="number">1</span>, <span class="number">1</span>, n, l, r) &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="sparse-table">Sparse Table</h2>
<blockquote>
<p>【模板】ST表</p>
<p>题目背景 这是一道ST表经典题——静态区间最大值 请注意最大数据时限只有0.8s，数据强度不低，请务必保证你的每次查询复杂度为O(1)</p>
<p>题目描述 给定一个长度为N的数列，和M次询问，求出每一次询问的区间内数字的最大值。</p>
<p>输入输出格式 输入格式： 第一行包含两个整数N,M，分别表示数列的长度和询问的个数。 第二行包含N个整数（记为ai），依次表示数列的第i项。 接下来M行，每行包含两个整数li,ri，表示查询的区间为[li,ri]。 输出格式： 输出包含M行，每行一个整数，依次表示每一次询问的结果。</p>
<p>输入输出样例 输入样例#1： 8 8 9 3 1 7 5 6 0 8 1 6 1 5 2 7 2 6 1 8 4 8 3 7 1 8 输出样例#1： 9 9 7 7 9 8 7 9</p>
<p>说明 对于30%的数据，满足：1≤N,M≤10 对于70%的数据，满足：1≤N,M≤1e5 对于100%的数据，满足：1≤N≤1e5，1≤M≤1e6，ai∈[0,1e9]，1≤li≤ri≤N <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, m, num[MAX_N+<span class="number">5</span>], mx[MAX_N+<span class="number">5</span>][<span class="number">20</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">setTable</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	mx[i][<span class="number">0</span>] = num[i];</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; (<span class="number">1</span>&lt;&lt;j) &lt;= n; j++)</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i+(<span class="number">1</span>&lt;&lt;j)<span class="number">-1</span> &lt;= n; i++)</div><div class="line">			mx[i][j] = max(mx[i][j<span class="number">-1</span>], mx[i+(<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>)][j<span class="number">-1</span>]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> range = (<span class="keyword">int</span>)(<span class="built_in">log</span>(r-l+<span class="number">1</span>)/<span class="built_in">log</span>(<span class="number">2</span>));</div><div class="line">	<span class="keyword">return</span> max(mx[l][range], mx[r-(<span class="number">1</span>&lt;&lt;range)+<span class="number">1</span>][range]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;num[i]);</div><div class="line">	setTable();</div><div class="line">	<span class="keyword">while</span> (m--) &#123;</div><div class="line">		<span class="keyword">int</span> l, r;	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;l, &amp;r);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, query(l, r));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="chairman-tree">Chairman Tree</h2>
<blockquote>
<p>【模板】可持久化线段树/主席树</p>
<p>题目背景 这是个非常经典的主席树入门题——静态区间第K小 数据已经过加强，请使用主席树。同时请注意常数优化</p>
<p>题目描述 如题，给定N个正整数构成的序列，将对于指定的闭区间查询其区间内的第K小值。</p>
<p>输入输出格式 输入格式： 第一行包含两个正整数N、M，分别表示序列的长度和查询的个数。 第二行包含N个正整数，表示这个序列各项的数字。 接下来M行每行包含三个整数l,r,k，表示查询区间[l,r]内的第k小值。 输出格式： 输出包含k行，每行1个正整数，依次表示每一次查询的结果</p>
<p>输入输出样例 输入样例#1： 5 5 25957 6405 15770 26287 26465 2 2 1 3 4 1 4 5 1 1 2 2 4 4 1 输出样例#1： 6405 15770 26287 25957 26287</p>
<p>说明 数据范围： 对于20%的数据满足：1≤N,M≤10 对于50%的数据满足：1≤N,M≤1000 对于80%的数据满足：1≤N,M≤1e5 对于100%的数据满足：1≤N,M≤2e5 对于数列中的所有数ai，均满足-1e9≤ai≤1e9 样例数据说明： N=5，数列长度为5，数列从第一项开始依次为[25957,6405,15770,26287,26465] 第一次查询为[2,2]区间内的第一小值，即为6405 第二次查询为[3,4]区间内的第一小值，即为15770 第三次查询为[4,5]区间内的第一小值，即为26287 第四次查询为[1,2]区间内的第二小值，即为25957 第五次查询为[4,4]区间内的第一小值，即为26287 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 200000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, m, num[MAX_N+<span class="number">5</span>], hash[MAX_N+<span class="number">5</span>], tot, root[MAX_N+<span class="number">5</span>], cnt;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pre</span> &#123;</span><span class="keyword">int</span> id, val;&#125; p[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span> <span class="params">(<span class="keyword">const</span> pre &amp;a, <span class="keyword">const</span> pre &amp;b)</span> </span>&#123;<span class="keyword">return</span> a.val &lt; b.val;&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span><span class="keyword">int</span> ls, rs, val;&#125; tr[MAX_N*<span class="number">50</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;tr[v].val = tr[tr[v].ls].val+tr[tr[v].rs].val;&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (s == t)	<span class="keyword">return</span>;	<span class="keyword">int</span> mid = s+t&gt;&gt;<span class="number">1</span>;</div><div class="line">	tr[v].ls = ++cnt, tr[v].rs = ++cnt;</div><div class="line">	build(tr[v].ls, s, mid), build(tr[v].rs, mid+<span class="number">1</span>, t);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> o, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">	tr[v] = tr[o];	<span class="keyword">if</span> (s == t) &#123;tr[v].val++;	<span class="keyword">return</span>;&#125;</div><div class="line">	<span class="keyword">int</span> mid = s+t&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span> (x &lt;= mid)	modify(tr[v].ls = ++cnt, tr[o].ls, s, mid, x);</div><div class="line">	<span class="keyword">else</span>	modify(tr[v].rs = ++cnt, tr[o].rs, mid+<span class="number">1</span>, t, x);</div><div class="line">	updata(v);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (s == t)	<span class="keyword">return</span> s;</div><div class="line">	<span class="keyword">int</span> mid = s+t&gt;&gt;<span class="number">1</span>, tmp = tr[tr[v2].ls].val-tr[tr[v1].ls].val;</div><div class="line">	<span class="keyword">if</span> (k &lt;= tmp)	<span class="keyword">return</span> query(tr[v1].ls, tr[v2].ls, s, mid, k);</div><div class="line">	<span class="keyword">else</span>	<span class="keyword">return</span> query(tr[v1].rs, tr[v2].rs, mid+<span class="number">1</span>, t, k-tmp);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	p[i].id = i, <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;p[i].val);</div><div class="line">	sort(p+<span class="number">1</span>, p+n+<span class="number">1</span>, cmp);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;<span class="keyword">if</span> (p[i].val != p[i<span class="number">-1</span>].val || i == <span class="number">1</span>)	hash[++tot] = p[i].val;	num[p[i].id] = tot;&#125;</div><div class="line">	root[<span class="number">0</span>] = ++cnt, build(root[<span class="number">0</span>], <span class="number">1</span>, tot);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	root[i] = ++cnt, modify(root[i], root[i<span class="number">-1</span>], <span class="number">1</span>, tot, num[i]);</div><div class="line">	<span class="keyword">while</span> (m--) &#123;</div><div class="line">		<span class="keyword">int</span> l, r, k;	<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;l, &amp;r, &amp;k);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, hash[query(root[l<span class="number">-1</span>], root[r], <span class="number">1</span>, tot, k)]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="treap">Treap</h2>
<blockquote>
<p>【模板】普通平衡树</p>
<p>题目描述 您需要写一种数据结构（可参考题目标题），来维护一些数，其中需要提供以下操作： 插入x数 删除x数(若有多个相同的数，因只删除一个) 查询x数的排名(若有多个相同的数，因输出最小的排名) 查询排名为x的数 求x的前驱(前驱定义为小于x，且最大的数) 求x的后继(后继定义为大于x，且最小的数)</p>
<p>输入输出格式 输入格式： 第一行为n，表示操作的个数,下面n行每行有两个数opt和x，opt表示操作的序号(1&lt;=opt&lt;=6) 输出格式： 对于操作3,4,5,6每行输出一个数，表示对应答案</p>
<p>输入输出样例 输入样例： 10 1 106465 4 1 1 317721 1 460929 1 644985 1 84185 1 89851 6 81968 1 492737 5 493598 输出样例： 106465 84185 492737</p>
<p>说明 时空限制：1000ms,128M 1.n的数据范围：n&lt;=100000 2.每个数的数据范围：[-1e7,1e7] <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TNode</span> &#123;</span></div><div class="line">    TNode* s[<span class="number">2</span>];</div><div class="line">    <span class="keyword">int</span> val, k, size;</div><div class="line">    TNode() &#123;&#125;</div><div class="line">    TNode(<span class="keyword">int</span> _val, TNode* _s) &#123;val = _val, s[<span class="number">0</span>] = s[<span class="number">1</span>] = _s, k = rand(), size = <span class="number">1</span>;&#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">()</span> </span>&#123;size = s[<span class="number">0</span>]-&gt;size+s[<span class="number">1</span>]-&gt;size+<span class="number">1</span>;&#125;</div><div class="line">&#125; nil, tr[MAX_N+<span class="number">5</span>], *null, *root, *cnt;</div><div class="line"><span class="keyword">typedef</span> TNode* P_TNode;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">    srand(<span class="number">19260817</span>);</div><div class="line">    nil = TNode(<span class="number">0</span>, <span class="literal">NULL</span>), null = &amp;nil;</div><div class="line">    null-&gt;s[<span class="number">0</span>] = null-&gt;s[<span class="number">1</span>] = null, null-&gt;size = <span class="number">0</span>;</div><div class="line">    cnt = tr, root = null;</div><div class="line">&#125;</div><div class="line"><span class="function">P_TNode <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    *cnt = TNode(val, null);</div><div class="line">    <span class="keyword">return</span> cnt++;</div><div class="line">&#125;</div><div class="line"><span class="function">P_TNode <span class="title">merge</span><span class="params">(P_TNode a, P_TNode b)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (a == null)    <span class="keyword">return</span> b;</div><div class="line">    <span class="keyword">if</span> (b == null)    <span class="keyword">return</span> a;</div><div class="line">    <span class="keyword">if</span> (a-&gt;k &gt; b-&gt;k) &#123;a-&gt;s[<span class="number">1</span>] = merge(a-&gt;s[<span class="number">1</span>], b), a-&gt;updata(); <span class="keyword">return</span> a;&#125;</div><div class="line">    <span class="keyword">if</span> (a-&gt;k &lt;= b-&gt;k) &#123;b-&gt;s[<span class="number">0</span>] = merge(a, b-&gt;s[<span class="number">0</span>]), b-&gt;updata(); <span class="keyword">return</span> b;&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">split</span><span class="params">(P_TNode v, <span class="keyword">int</span> val, P_TNode &amp;ls, P_TNode &amp;rs)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (v == null) &#123;ls = rs = null; <span class="keyword">return</span>;&#125;</div><div class="line">    <span class="keyword">if</span> (val &lt; v-&gt;val) &#123;rs = v; split(rs-&gt;s[<span class="number">0</span>], val, ls, rs-&gt;s[<span class="number">0</span>]);&#125;</div><div class="line">    <span class="keyword">if</span> (val &gt;= v-&gt;val) &#123;ls = v;    split(ls-&gt;s[<span class="number">1</span>], val, ls-&gt;s[<span class="number">1</span>], rs);&#125;</div><div class="line">    v-&gt;updata();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    P_TNode ls, rs;</div><div class="line">    split(root, val, ls, rs);</div><div class="line">    root = merge(merge(ls, newnode(val)), rs);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    P_TNode ls, mids, rs;</div><div class="line">    split(root, val<span class="number">-1</span>, ls, rs);</div><div class="line">    split(rs, val, mids, rs);</div><div class="line">    root = merge(ls, merge(merge(mids-&gt;s[<span class="number">0</span>], mids-&gt;s[<span class="number">1</span>]), rs));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_rank</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    P_TNode ls, rs;</div><div class="line">    split(root, val<span class="number">-1</span>, ls, rs);</div><div class="line">    <span class="keyword">int</span> ret = ls-&gt;size+<span class="number">1</span>;</div><div class="line">    root = merge(ls, rs);</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_kth</span><span class="params">(P_TNode v, <span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (k &lt;= v-&gt;s[<span class="number">0</span>]-&gt;size)    <span class="keyword">return</span> get_kth(v-&gt;s[<span class="number">0</span>], k);</div><div class="line">    <span class="keyword">if</span> (k &gt; v-&gt;s[<span class="number">0</span>]-&gt;size+<span class="number">1</span>)    <span class="keyword">return</span> get_kth(v-&gt;s[<span class="number">1</span>], k-v-&gt;s[<span class="number">0</span>]-&gt;size<span class="number">-1</span>);</div><div class="line">    <span class="keyword">return</span> v-&gt;val;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_nearest</span><span class="params">(P_TNode v, <span class="keyword">int</span> sn)</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span> (v-&gt;s[sn] != null)    v = v-&gt;s[sn];</div><div class="line">    <span class="keyword">return</span> v-&gt;val;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">predecessor</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    P_TNode ls, rs;</div><div class="line">    split(root, val<span class="number">-1</span>, ls, rs);</div><div class="line">	<span class="keyword">int</span> ret = get_nearest(ls, <span class="number">1</span>);</div><div class="line">    root = merge(ls, rs);</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">successor</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    P_TNode ls, rs;</div><div class="line">    split(root, val, ls, rs);</div><div class="line">    <span class="keyword">int</span> ret = get_nearest(rs, <span class="number">0</span>);</div><div class="line">	root = merge(ls, rs);</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    init();</div><div class="line">    <span class="keyword">int</span> n, opt, x;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</div><div class="line">    <span class="keyword">while</span> (n--) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;opt, &amp;x);</div><div class="line">        <span class="keyword">if</span> (opt == <span class="number">1</span>)    insert(x);</div><div class="line">        <span class="keyword">if</span> (opt == <span class="number">2</span>)    remove(x);</div><div class="line">        <span class="keyword">if</span> (opt == <span class="number">3</span>)    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, get_rank(x));</div><div class="line">        <span class="keyword">if</span> (opt == <span class="number">4</span>)    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, get_kth(root, x));</div><div class="line">        <span class="keyword">if</span> (opt == <span class="number">5</span>)    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, predecessor(x));</div><div class="line">        <span class="keyword">if</span> (opt == <span class="number">6</span>)    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, successor(x));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="splay">Splay</h2>
<h3 id="normal">Normal</h3>
<blockquote>
<p>【模板】普通平衡树</p>
<p>题目描述 您需要写一种数据结构（可参考题目标题），来维护一些数，其中需要提供以下操作： 插入x数 删除x数(若有多个相同的数，因只删除一个) 查询x数的排名(若有多个相同的数，因输出最小的排名) 查询排名为x的数 求x的前驱(前驱定义为小于x，且最大的数) 求x的后继(后继定义为大于x，且最小的数)</p>
<p>输入输出格式 输入格式： 第一行为n，表示操作的个数,下面n行每行有两个数opt和x，opt表示操作的序号(1&lt;=opt&lt;=6) 输出格式： 对于操作3,4,5,6每行输出一个数，表示对应答案</p>
<p>输入输出样例 输入样例： 10 1 106465 4 1 1 317721 1 460929 1 644985 1 84185 1 89851 6 81968 1 492737 5 493598 输出样例： 106465 84185 492737</p>
<p>说明 时空限制：1000ms,128M 1.n的数据范围：n&lt;=100000 2.每个数的数据范围：[-1e7,1e7] <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2147483647</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SplayNode</span> &#123;</span></div><div class="line">	SplayNode *s[<span class="number">2</span>], *fa;</div><div class="line">	<span class="keyword">int</span> val, w, size;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">()</span></span>;</div><div class="line">&#125; nil;</div><div class="line">SplayNode* null = &amp;nil;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Splay</span> &#123;</span></div><div class="line">	SplayNode tr[MAX_N+<span class="number">5</span>];</div><div class="line">	SplayNode* root;</div><div class="line">	<span class="keyword">int</span> cnt;</div><div class="line">	Splay();</div><div class="line">	<span class="function">SplayNode* <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> _val)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(SplayNode* v, <span class="keyword">bool</span> sn)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(SplayNode* &amp;v)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(SplayNode* now, SplayNode* &amp;to)</span></span>;</div><div class="line">	<span class="function">SplayNode* <span class="title">predecessor</span><span class="params">(<span class="keyword">int</span> _val)</span></span>;</div><div class="line">	<span class="function">SplayNode* <span class="title">successor</span><span class="params">(<span class="keyword">int</span> _val)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> _val)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> _val)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">get_rank</span><span class="params">(<span class="keyword">int</span> _val)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">get_kth</span><span class="params">(<span class="keyword">int</span> rank)</span></span>;</div><div class="line">&#125; BBST;</div><div class="line"><span class="keyword">void</span> SplayNode::updata() &#123;</div><div class="line">	<span class="keyword">if</span> (!s[<span class="number">1</span>])	<span class="keyword">return</span>;</div><div class="line">	size = s[<span class="number">0</span>]-&gt;size+s[<span class="number">1</span>]-&gt;size+w;</div><div class="line">&#125;</div><div class="line">Splay::Splay() &#123;</div><div class="line">	cnt = <span class="number">0</span>;</div><div class="line">	root = newnode(-INF);</div><div class="line">	root-&gt;s[<span class="number">1</span>] = newnode(INF);</div><div class="line">	root-&gt;s[<span class="number">1</span>]-&gt;fa = root;</div><div class="line">&#125;</div><div class="line">SplayNode* Splay::newnode(<span class="keyword">int</span> _val) &#123;</div><div class="line">	cnt++;</div><div class="line">	tr[cnt].s[<span class="number">0</span>] = null, tr[cnt].s[<span class="number">1</span>] = null, tr[cnt].fa = null;</div><div class="line">	tr[cnt].val = _val, tr[cnt].w = tr[cnt].size = <span class="number">1</span>;</div><div class="line">	<span class="keyword">return</span> &amp;tr[cnt];</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Splay::rotate(SplayNode* v, <span class="keyword">bool</span> sn) &#123;</div><div class="line">	SplayNode* tmp = v-&gt;s[sn^<span class="number">1</span>];</div><div class="line">	v-&gt;s[sn^<span class="number">1</span>] = tmp-&gt;s[sn];</div><div class="line">	tmp-&gt;s[sn] = v;</div><div class="line">	v-&gt;s[sn^<span class="number">1</span>]-&gt;fa = v;</div><div class="line">	tmp-&gt;fa = v-&gt;fa;</div><div class="line">	<span class="keyword">if</span> (tmp-&gt;fa != null)	tmp-&gt;fa-&gt;s[tmp-&gt;fa-&gt;s[<span class="number">1</span>] == v] = tmp;</div><div class="line">	<span class="keyword">else</span>	root = tmp;</div><div class="line">	v-&gt;fa = tmp;</div><div class="line">	v-&gt;updata();</div><div class="line">	tmp-&gt;updata();</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Splay::rotate(SplayNode* &amp;v) &#123;</div><div class="line">	<span class="keyword">bool</span> sn = (v-&gt;fa-&gt;s[<span class="number">0</span>] == v) ? <span class="number">1</span> : <span class="number">0</span>;</div><div class="line">	rotate(v-&gt;fa, sn);</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Splay::splay(SplayNode* now, SplayNode* &amp;to) &#123;</div><div class="line">	<span class="keyword">while</span> (now != to) &#123;</div><div class="line">		<span class="keyword">if</span> (now-&gt;fa == to) &#123;</div><div class="line">			rotate(now);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">if</span> ((now-&gt;fa-&gt;s[<span class="number">0</span>] == now) == (now-&gt;fa-&gt;fa-&gt;s[<span class="number">0</span>] == now-&gt;fa))	rotate(now-&gt;fa);</div><div class="line">			<span class="keyword">else</span>	rotate(now);</div><div class="line">			rotate(now);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">SplayNode* Splay::predecessor(<span class="keyword">int</span> _val) &#123;</div><div class="line">	SplayNode* now = root;</div><div class="line">	SplayNode* save = root;</div><div class="line">	<span class="keyword">int</span> maxv = -INF;</div><div class="line">	<span class="keyword">for</span> (;;) &#123;</div><div class="line">		<span class="keyword">if</span> (now-&gt;val &lt; _val &amp;&amp; maxv &lt; _val)	maxv = now-&gt;val, save = now;</div><div class="line">		SplayNode* nxt = now-&gt;s[(_val &lt;= now-&gt;val) ? <span class="number">0</span> : <span class="number">1</span>];</div><div class="line">		<span class="keyword">if</span> (nxt == null)	<span class="keyword">return</span> save;</div><div class="line">		now = nxt;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">SplayNode* Splay::successor(<span class="keyword">int</span> _val) &#123;</div><div class="line">	SplayNode* now = root;</div><div class="line">	SplayNode* save = root;</div><div class="line">	<span class="keyword">int</span> minv = INF;</div><div class="line">	<span class="keyword">for</span> (;;) &#123;</div><div class="line">		<span class="keyword">if</span> (now-&gt;val &gt; _val &amp;&amp; minv &gt; _val)	minv = now-&gt;val, save = now;</div><div class="line">		SplayNode* nxt = now-&gt;s[(_val &lt; now-&gt;val) ? <span class="number">0</span> : <span class="number">1</span>];</div><div class="line">		<span class="keyword">if</span> (nxt == null)	<span class="keyword">return</span> save;</div><div class="line">		now = nxt;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Splay::insert(<span class="keyword">int</span> _val) &#123;</div><div class="line">	SplayNode* pre = predecessor(_val);</div><div class="line">	SplayNode* suc = successor(_val);</div><div class="line">	splay(pre, root), splay(suc, root-&gt;s[<span class="number">1</span>]);</div><div class="line">	<span class="keyword">if</span> (root-&gt;s[<span class="number">1</span>]-&gt;s[<span class="number">0</span>] == null) &#123;</div><div class="line">		root-&gt;s[<span class="number">1</span>]-&gt;s[<span class="number">0</span>] = newnode(_val);</div><div class="line">		root-&gt;s[<span class="number">1</span>]-&gt;s[<span class="number">0</span>]-&gt;fa = root-&gt;s[<span class="number">1</span>];</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		root-&gt;s[<span class="number">1</span>]-&gt;s[<span class="number">0</span>]-&gt;w++;</div><div class="line">		root-&gt;s[<span class="number">1</span>]-&gt;s[<span class="number">0</span>]-&gt;size++;</div><div class="line">	&#125;</div><div class="line">	root-&gt;s[<span class="number">1</span>]-&gt;updata();</div><div class="line">	root-&gt;updata();</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Splay::remove(<span class="keyword">int</span> _val) &#123;</div><div class="line">	SplayNode* pre = predecessor(_val);</div><div class="line">	SplayNode* suc = successor(_val);</div><div class="line">	splay(pre, root), splay(suc, root-&gt;s[<span class="number">1</span>]);</div><div class="line">	root-&gt;s[<span class="number">1</span>]-&gt;s[<span class="number">0</span>]-&gt;w--, root-&gt;s[<span class="number">1</span>]-&gt;s[<span class="number">0</span>]-&gt;size--;</div><div class="line">	<span class="keyword">if</span> (!root-&gt;s[<span class="number">1</span>]-&gt;s[<span class="number">0</span>]-&gt;w)	root-&gt;s[<span class="number">1</span>]-&gt;s[<span class="number">0</span>] = null;</div><div class="line">	root-&gt;s[<span class="number">1</span>]-&gt;updata();</div><div class="line">	root-&gt;updata();</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Splay::get_rank(<span class="keyword">int</span> _val) &#123;</div><div class="line">	SplayNode* pre = predecessor(_val);</div><div class="line">	SplayNode* suc = successor(_val);</div><div class="line">	splay(pre, root), splay(suc, root-&gt;s[<span class="number">1</span>]);</div><div class="line">	<span class="keyword">return</span> root-&gt;size-root-&gt;s[<span class="number">1</span>]-&gt;size;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Splay::get_kth(<span class="keyword">int</span> rank) &#123;</div><div class="line">	rank++;</div><div class="line">	SplayNode* now = root;</div><div class="line">	<span class="keyword">for</span> (;;) &#123;</div><div class="line">		<span class="keyword">if</span> (rank &lt;= now-&gt;s[<span class="number">0</span>]-&gt;size) &#123;</div><div class="line">			now = now-&gt;s[<span class="number">0</span>];</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			rank -= now-&gt;s[<span class="number">0</span>]-&gt;size;</div><div class="line">			<span class="keyword">if</span> (rank &lt;= now-&gt;w)	<span class="keyword">return</span> now-&gt;val;</div><div class="line">			rank -= now-&gt;w;</div><div class="line">			now = now-&gt;s[<span class="number">1</span>];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> n, opt, x;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</div><div class="line">	<span class="keyword">while</span> (n--) &#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;opt, &amp;x);</div><div class="line">		<span class="keyword">if</span> (opt == <span class="number">1</span>)	BBST.insert(x);</div><div class="line">		<span class="keyword">if</span> (opt == <span class="number">2</span>)	BBST.remove(x);</div><div class="line">		<span class="keyword">if</span> (opt == <span class="number">3</span>)	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, BBST.get_rank(x));</div><div class="line">		<span class="keyword">if</span> (opt == <span class="number">4</span>)	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, BBST.get_kth(x));</div><div class="line">		<span class="keyword">if</span> (opt == <span class="number">5</span>)	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, BBST.predecessor(x)-&gt;val);</div><div class="line">		<span class="keyword">if</span> (opt == <span class="number">6</span>)	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, BBST.successor(x)-&gt;val);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="reverse">Reverse</h3>
<blockquote>
<p>【模板】文艺平衡树</p>
<p>题目背景 这是一道经典的Splay模板题——文艺平衡树。</p>
<p>题目描述 您需要写一种数据结构（可参考题目标题），来维护一个有序数列，其中需要提供以下操作：翻转一个区间。 例如原有序序列是5 4 3 2 1，翻转区间是[2,4]的话，结果是5 2 3 4 1</p>
<p>输入输出格式 输入格式： 第一行为n,m，n表示初始序列有n个数，这个序列依次是(1,2…n-1,n)，m表示翻转操作次数 接下来m行每行两个数[l,r]，数据保证 1≤l≤r≤n</p>
<p>输出格式： 输出一行n个数字，表示原始序列经过m次变换后的结果</p>
<p>输入输出样例 输入样例#1： 5 3 1 3 1 3 1 4 输出样例#1： 4 3 2 1 5</p>
<p>说明 n,m≤100000 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SplayNode</span> &#123;</span>SplayNode *s[<span class="number">2</span>], *fa;	<span class="keyword">int</span> val, size;	<span class="keyword">bool</span> rev;	<span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">()</span></span>;	<span class="function"><span class="keyword">void</span> <span class="title">downtag</span><span class="params">()</span></span>;&#125;;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SplayTree</span> &#123;</span></div><div class="line">	SplayNode* root;	<span class="function">SplayNode* <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> _val)</span></span>;	<span class="function">SplayNode* <span class="title">build</span><span class="params">(SplayNode* v, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(SplayNode* v, <span class="keyword">bool</span> sn)</span></span>;	<span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(SplayNode* now, SplayNode* to)</span></span>;</div><div class="line">	<span class="function">SplayNode* <span class="title">find_kth</span><span class="params">(SplayNode* v, <span class="keyword">int</span> k)</span></span>;	<span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>;	<span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(SplayNode* v, <span class="keyword">int</span> n)</span></span>;</div><div class="line">&#125; BBST;</div><div class="line"><span class="keyword">void</span> SplayNode::updata() &#123;size = (s[<span class="number">0</span>] == <span class="literal">NULL</span> ? <span class="number">0</span> : s[<span class="number">0</span>]-&gt;size)+(s[<span class="number">1</span>] == <span class="literal">NULL</span> ? <span class="number">0</span> : s[<span class="number">1</span>]-&gt;size)+<span class="number">1</span>;&#125;</div><div class="line"><span class="keyword">void</span> SplayNode::downtag() &#123;</div><div class="line">	<span class="keyword">if</span> (!rev)	<span class="keyword">return</span>;	rev = <span class="literal">false</span>, swap(s[<span class="number">0</span>], s[<span class="number">1</span>]);</div><div class="line">	<span class="keyword">if</span> (s[<span class="number">0</span>])	s[<span class="number">0</span>]-&gt;rev ^= <span class="number">1</span>;	<span class="keyword">if</span> (s[<span class="number">1</span>])	s[<span class="number">1</span>]-&gt;rev ^= <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line">SplayNode* SplayTree::newnode(<span class="keyword">int</span> _val) &#123;</div><div class="line">	SplayNode* v = <span class="keyword">new</span> SplayNode;</div><div class="line">	v-&gt;s[<span class="number">0</span>] = v-&gt;s[<span class="number">1</span>] = v-&gt;fa = <span class="literal">NULL</span>;</div><div class="line">	v-&gt;val = _val, v-&gt;size = <span class="number">1</span>, v-&gt;rev = <span class="literal">false</span>;</div><div class="line">	<span class="keyword">return</span> v;</div><div class="line">&#125;</div><div class="line">SplayNode* SplayTree::build(SplayNode* fa, <span class="keyword">int</span> l, <span class="keyword">int</span> r) &#123;</div><div class="line">	<span class="keyword">if</span> (l &gt; r)	<span class="keyword">return</span> <span class="literal">NULL</span>;	<span class="keyword">int</span> mid = l+r&gt;&gt;<span class="number">1</span>, val = mid<span class="number">-1</span>;</div><div class="line">	SplayNode* v = newnode(val);	v-&gt;fa = fa;</div><div class="line">	v-&gt;s[<span class="number">0</span>] = build(v, l, mid<span class="number">-1</span>), v-&gt;s[<span class="number">1</span>] = build(v, mid+<span class="number">1</span>, r);</div><div class="line">	v-&gt;updata();	<span class="keyword">return</span> v;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> SplayTree::rotate(SplayNode* v, <span class="keyword">bool</span> sn) &#123;</div><div class="line">	SplayNode* tmp = v-&gt;fa;</div><div class="line">	tmp-&gt;s[sn^<span class="number">1</span>] = v-&gt;s[sn], v-&gt;fa = tmp-&gt;fa;</div><div class="line">	<span class="keyword">if</span> (v-&gt;s[sn])	v-&gt;s[sn]-&gt;fa = tmp;</div><div class="line">	<span class="keyword">if</span> (tmp-&gt;fa != <span class="literal">NULL</span>)	tmp-&gt;fa-&gt;s[tmp == tmp-&gt;fa-&gt;s[<span class="number">1</span>]] = v;</div><div class="line">	v-&gt;s[sn] = tmp, tmp-&gt;fa = v, tmp-&gt;updata(), v-&gt;updata();</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> SplayTree::splay(SplayNode* now, SplayNode* to) &#123;</div><div class="line">	<span class="keyword">while</span> (now-&gt;fa != to)</div><div class="line">		<span class="keyword">if</span> (now-&gt;fa-&gt;s[<span class="number">0</span>] == now) &#123;</div><div class="line">			<span class="keyword">if</span> (now-&gt;fa-&gt;fa != to &amp;&amp; now-&gt;fa == now-&gt;fa-&gt;fa-&gt;s[<span class="number">0</span>])	rotate(now-&gt;fa, <span class="number">1</span>);</div><div class="line">			rotate(now, <span class="number">1</span>);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">if</span> (now-&gt;fa-&gt;fa != to &amp;&amp; now-&gt;fa == now-&gt;fa-&gt;fa-&gt;s[<span class="number">1</span>])	rotate(now-&gt;fa, <span class="number">0</span>);</div><div class="line">			rotate(now, <span class="number">0</span>);</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">if</span> (to == <span class="literal">NULL</span>)	root = now;</div><div class="line">&#125;</div><div class="line">SplayNode* SplayTree::find_kth(SplayNode* v, <span class="keyword">int</span> k) &#123;</div><div class="line">	v-&gt;downtag();	<span class="keyword">int</span> size = v-&gt;s[<span class="number">0</span>] == <span class="literal">NULL</span> ? <span class="number">0</span> : v-&gt;s[<span class="number">0</span>]-&gt;size;</div><div class="line">	<span class="keyword">if</span> (size+<span class="number">1</span> == k)	<span class="keyword">return</span> v;</div><div class="line">	<span class="keyword">if</span> (size &gt;= k)	<span class="keyword">return</span> find_kth(v-&gt;s[<span class="number">0</span>], k);</div><div class="line">	<span class="keyword">return</span> find_kth(v-&gt;s[<span class="number">1</span>], k-size<span class="number">-1</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> SplayTree::reverse(<span class="keyword">int</span> l, <span class="keyword">int</span> r) &#123;</div><div class="line">	SplayNode *nl = find_kth(root, l), *nr = find_kth(root, r+<span class="number">2</span>);</div><div class="line">	splay(nl, <span class="literal">NULL</span>), splay(nr, root);	nr-&gt;s[<span class="number">0</span>]-&gt;rev ^= <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> SplayTree::output(SplayNode* v, <span class="keyword">int</span> n) &#123;</div><div class="line">	<span class="keyword">if</span> (v == <span class="literal">NULL</span>)	<span class="keyword">return</span>;</div><div class="line">	v-&gt;downtag(), output(v-&gt;s[<span class="number">0</span>], n);</div><div class="line">	<span class="keyword">if</span> (v-&gt;val &gt;= <span class="number">1</span> &amp;&amp; v-&gt;val &lt;= n)	<span class="built_in">printf</span>(<span class="string">"%d "</span>, v-&gt;val);</div><div class="line">	output(v-&gt;s[<span class="number">1</span>], n);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> n, m;	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);	BBST.root = BBST.build(<span class="literal">NULL</span>, <span class="number">1</span>, n+<span class="number">2</span>);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, l, r; i &lt;= m; i++)	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;l, &amp;r), BBST.reverse(l, r);</div><div class="line">	BBST.output(BBST.root, n);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="tree-chain-division">Tree Chain Division</h2>
<blockquote>
<p>【模板】树链剖分</p>
<p>题目描述 如题，已知一棵包含N个结点的树（连通且无环），每个节点上包含一个数值，需要支持以下操作： 操作1： 格式： 1 x y z 表示将树从x到y结点最短路径上所有节点的值都加上z 操作2： 格式： 2 x y 表示求树从x到y结点最短路径上所有节点的值之和 操作3： 格式： 3 x z 表示将以x为根节点的子树内所有节点值都加上z 操作4： 格式： 4 x 表示求以x为根节点的子树内所有节点值之和</p>
<p>输入输出格式 输入格式： 第一行包含4个正整数N、M、R、P，分别表示树的结点个数、操作个数、根节点序号和取模数（即所有的输出结果均对此取模）。 接下来一行包含N个非负整数，分别依次表示各个节点上初始的数值。 接下来N-1行每行包含两个整数x、y，表示点x和点y之间连有一条边（保证无环且连通） 接下来M行每行包含若干个正整数，每行表示一个操作，格式如下： 操作1： 1 x y z 操作2： 2 x y 操作3： 3 x z 操作4： 4 x 输出格式： 输出包含若干行，分别依次表示每个操作2或操作4所得的结果（对P取模）</p>
<p>输入输出样例 输入样例： 5 5 2 24 7 3 7 8 0 1 2 1 5 3 1 4 1 3 4 2 3 2 2 4 5 1 5 1 3 2 1 3 输出样例： 2 21 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, m, r, p, ind;</div><div class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> c[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> dep[MAX_N+<span class="number">5</span>], fa[MAX_N+<span class="number">5</span>], size[MAX_N+<span class="number">5</span>], son[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> top[MAX_N+<span class="number">5</span>], dfn[MAX_N+<span class="number">5</span>], last[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> seg[(MAX_N&lt;&lt;<span class="number">2</span>)+<span class="number">5</span>], tag[(MAX_N&lt;&lt;<span class="number">2</span>)+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS1</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</div><div class="line">	size[u] = <span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</div><div class="line">		<span class="keyword">int</span> v = G[u][i];</div><div class="line">		<span class="keyword">if</span> (v == fa[u])	<span class="keyword">continue</span>;</div><div class="line">		dep[v] = dep[u]+<span class="number">1</span>;</div><div class="line">		fa[v] = u;</div><div class="line">		DFS1(v);</div><div class="line">		size[u] += size[v];</div><div class="line">		<span class="keyword">if</span> (!son[u] || size[son[u]] &lt; size[v])	son[u] = v;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> tp)</span> </span>&#123;</div><div class="line">	top[u] = tp, dfn[u] = ++ind;</div><div class="line">	<span class="keyword">if</span> (son[u])	DFS2(son[u], tp);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</div><div class="line">		<span class="keyword">int</span> v = G[u][i];</div><div class="line">		<span class="keyword">if</span> (v == fa[u] || v == son[u])	<span class="keyword">continue</span>;</div><div class="line">		DFS2(v, v);</div><div class="line">	&#125;</div><div class="line">	last[u] = ind;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;seg[v] = (seg[v&lt;&lt;<span class="number">1</span>]+seg[v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>])%p;&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">downtag</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (!tag[v])	<span class="keyword">return</span>;</div><div class="line">	<span class="keyword">int</span> mid = s+t&gt;&gt;<span class="number">1</span>;</div><div class="line">	seg[v&lt;&lt;<span class="number">1</span>] = (seg[v&lt;&lt;<span class="number">1</span>]+tag[v]*(mid-s+<span class="number">1</span>))%p;</div><div class="line">	seg[v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = (seg[v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+tag[v]*(t-mid))%p;</div><div class="line">	tag[v&lt;&lt;<span class="number">1</span>] = (tag[v&lt;&lt;<span class="number">1</span>]+tag[v])%p;</div><div class="line">	tag[v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = (tag[v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+tag[v])%p;</div><div class="line">	tag[v] = <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) &#123;seg[v] = (seg[v]+x*(t-s+<span class="number">1</span>))%p, tag[v] = (tag[v]+x)%p;	<span class="keyword">return</span>;&#125;</div><div class="line">	downtag(v, s, t);</div><div class="line">	<span class="keyword">int</span> mid = s+t&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span> (l &lt;= mid)	modify(v&lt;&lt;<span class="number">1</span>, s, mid, l, r, x);</div><div class="line">	<span class="keyword">if</span> (r &gt;= mid+<span class="number">1</span>)	modify(v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, mid+<span class="number">1</span>, t, l, r, x);</div><div class="line">	updata(v);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r)	<span class="keyword">return</span> seg[v];</div><div class="line">	downtag(v, s, t);</div><div class="line">	<span class="keyword">int</span> mid = s+t&gt;&gt;<span class="number">1</span>, ret = <span class="number">0</span>;</div><div class="line">	<span class="keyword">if</span> (l &lt;= mid)	ret = (ret+query(v&lt;&lt;<span class="number">1</span>, s, mid, l, r))%p;</div><div class="line">	<span class="keyword">if</span> (r &gt;= mid+<span class="number">1</span>)	ret = (ret+query(v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, mid+<span class="number">1</span>, t, l, r))%p;</div><div class="line">	updata(v);</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</div><div class="line">	<span class="keyword">while</span> (top[x] != top[y]) &#123;</div><div class="line">		<span class="keyword">if</span> (dep[top[x]] &lt; dep[top[y]])	swap(x, y);</div><div class="line">		modify(<span class="number">1</span>, <span class="number">1</span>, n, dfn[top[x]], dfn[x], z);</div><div class="line">		x = fa[top[x]];</div><div class="line">	&#125;</div><div class="line">	modify(<span class="number">1</span>, <span class="number">1</span>, n, min(dfn[x], dfn[y]), max(dfn[x], dfn[y]), z);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span> (top[x] != top[y]) &#123;</div><div class="line">		<span class="keyword">if</span> (dep[top[x]] &lt; dep[top[y]])	swap(x, y);</div><div class="line">		ret = (ret+query(<span class="number">1</span>, <span class="number">1</span>, n, dfn[top[x]], dfn[x]))%p;</div><div class="line">		x = fa[top[x]];</div><div class="line">	&#125;</div><div class="line">	ret = (ret+query(<span class="number">1</span>, <span class="number">1</span>, n, min(dfn[x], dfn[y]), max(dfn[x], dfn[y])))%p;</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve3</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> z)</span> </span>&#123;modify(<span class="number">1</span>, <span class="number">1</span>, n, dfn[x], last[x], z);&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve4</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;<span class="keyword">return</span> query(<span class="number">1</span>, <span class="number">1</span>, n, dfn[x], last[x]);&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;n, &amp;m, &amp;r, &amp;p);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;c[i]);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</div><div class="line">		<span class="keyword">int</span> u, v;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v);</div><div class="line">		G[u].push_back(v);</div><div class="line">		G[v].push_back(u);</div><div class="line">	&#125;</div><div class="line">	DFS1(r);</div><div class="line">	DFS2(r, r);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	modify(<span class="number">1</span>, <span class="number">1</span>, n, dfn[i], dfn[i], c[i]);</div><div class="line">	<span class="keyword">while</span> (m--) &#123;</div><div class="line">		<span class="keyword">int</span> opt;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;opt);</div><div class="line">		<span class="keyword">if</span> (opt == <span class="number">1</span>) &#123;</div><div class="line">			<span class="keyword">int</span> x, y, z;</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;x, &amp;y, &amp;z);</div><div class="line">			solve1(x, y, z);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (opt == <span class="number">2</span>) &#123;</div><div class="line">			<span class="keyword">int</span> x, y;</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y);</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, solve2(x, y));</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (opt == <span class="number">3</span>) &#123;</div><div class="line">			<span class="keyword">int</span> x, z;</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;z);</div><div class="line">			solve3(x, z);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (opt == <span class="number">4</span>) &#123;</div><div class="line">			<span class="keyword">int</span> x;</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x);</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, solve4(x));</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="string">String</h1>
<h2 id="kmp">KMP</h2>
<blockquote>
<p>【模板】KMP字符串匹配</p>
<p>题目描述 如题，给出两个字符串s1和s2，其中s2为s1的子串，求出s2在s1中所有出现的位置。 为了减少骗分的情况，接下来还要输出子串的前缀数组next。</p>
<p>输入输出格式 输入格式： 第一行为一个字符串，即为s1（仅包含大写字母） 第二行为一个字符串，即为s2（仅包含大写字母） 输出格式： 若干行，每行包含一个整数，表示s2在s1中出现的位置 接下来1行，包括length(s2)个整数，表示前缀数组next[i]的值。</p>
<p>输入输出样例 输入样例： ABABABC ABA 输出样例： 1 3 0 0 1</p>
<p>说明 时空限制：1000ms，128M 数据规模： 设s1长度为N，s2长度为M 对于30%的数据：N&lt;=15，M&lt;=5 对于70%的数据：N&lt;=10000，M&lt;=100 对于100%的数据：N&lt;=1000000，M&lt;=1000 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 1000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> next[MAX_M];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">CalcNext</span><span class="params">(<span class="built_in">string</span>&amp; s)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> m = s.length();</div><div class="line">	<span class="keyword">int</span> begin = <span class="number">1</span>, matched = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span> (begin+matched &lt; m) &#123;</div><div class="line">		<span class="keyword">if</span> (s[begin+matched] == s[matched]) &#123;</div><div class="line">			matched++;</div><div class="line">			next[begin+matched<span class="number">-1</span>] = matched;</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">if</span> (matched == <span class="number">0</span>) &#123;</div><div class="line">				begin++;</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				begin += matched-next[matched<span class="number">-1</span>];</div><div class="line">				matched = next[matched<span class="number">-1</span>];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">KMP</span><span class="params">(<span class="built_in">string</span>&amp; T, <span class="built_in">string</span>&amp; P)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> n = T.length(), m = P.length();</div><div class="line">	<span class="keyword">int</span> begin = <span class="number">0</span>, matched = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span> (begin &lt;= n-m) &#123;</div><div class="line">		<span class="keyword">if</span> (matched &lt; m &amp;&amp; T[begin+matched] == P[matched]) &#123;</div><div class="line">			matched++;</div><div class="line">			<span class="keyword">if</span> (matched == m) &#123;</div><div class="line">				<span class="built_in">cout</span> &lt;&lt; begin+<span class="number">1</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">if</span> (matched == <span class="number">0</span>) &#123;</div><div class="line">				begin++;</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				begin += matched-next[matched<span class="number">-1</span>];</div><div class="line">				matched = next[matched<span class="number">-1</span>];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">string</span> s1, s2;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; s1 &gt;&gt; s2;</div><div class="line">	CalcNext(s2);</div><div class="line">	KMP(s1, s2);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s2.length(); i++) &#123;</div><div class="line">		<span class="built_in">cout</span> &lt;&lt; next[i] &lt;&lt; <span class="string">" "</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="manacher">Manacher</h2>
<blockquote>
<p>【模板】manacher算法</p>
<p>题目描述 给出一个只由小写英文字符a,b,c…y,z组成的字符串S,求S中最长回文串的长度. 字符串长度为n</p>
<p>输入输出格式 输入格式： 一行小写英文字符a,b,c…y,z组成的字符串S</p>
<p>输出格式： 一个整数表示答案</p>
<p>输入输出样例 输入样例#1： aaa 输出样例#1： 3</p>
<p>说明 字符串长度len &lt;= 11000000 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_L 11000000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">char</span> s[MAX_L*<span class="number">2</span>+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> f[MAX_L*<span class="number">2</span>+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">manacher</span> <span class="params">(<span class="keyword">char</span>* s0)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> len = <span class="built_in">strlen</span>(s0);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++)	s[i*<span class="number">2</span>+<span class="number">1</span>] = <span class="string">'#'</span>, s[i*<span class="number">2</span>+<span class="number">2</span>] = s0[i];</div><div class="line">	s[len = len*<span class="number">2</span>+<span class="number">1</span>] = <span class="string">'#'</span>;</div><div class="line">	<span class="keyword">int</span> pos = <span class="number">0</span>, r = <span class="number">0</span>, ret = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= len; i++) &#123;</div><div class="line">		f[i] = (i &lt; r) ? min(f[<span class="number">2</span>*pos-i], r-i) : <span class="number">1</span>;</div><div class="line">		<span class="keyword">while</span> (i-f[i] &gt;= <span class="number">1</span> &amp;&amp; i+f[i] &lt;= len &amp;&amp; s[i-f[i]] == s[i+f[i]])	f[i]++;</div><div class="line">		<span class="keyword">if</span> (i+f[i] &gt; r)	pos = i, r = i+f[i];</div><div class="line">		ret = max(ret, f[i]<span class="number">-1</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">char</span> s0[MAX_L+<span class="number">5</span>];	<span class="built_in">scanf</span>(<span class="string">"%s"</span>, s0);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, manacher(s0));</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="aho-corasick-automation">Aho-Corasick Automation</h2>
<blockquote>
<p>【模板】AC自动机</p>
<p>题目描述 有N个由小写字母组成的模式串以及一个文本串T。每个模式串可能会在文本串中出现多次。你需要找出哪些模式串在文本串T中出现的次数最多。</p>
<p>输入输出格式 输入格式： 输入含多组数据。 每组数据的第一行为一个正整数N，表示共有N个模式串，1≤N≤150。 接下去N行，每行一个长度小于等于70的模式串。 下一行是一个长度小于等于1e6的文本串T。 输入结束标志为N=0。 输出格式： 对于每组数据，第一行输出模式串最多出现的次数，接下去若干行每行输出一个出现次数最多的模式串，按输入顺序排列。</p>
<p>输入输出样例 输入样例#1： 2 aba bab ababababac 6 beta alpha haha delta dede tata dedeltalphahahahototatalpha 0 输出样例#1： 4 aba 2 alpha haha <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DICNUM 26</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LETTER 10500</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LENGTH 1000000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">char</span> P[<span class="number">155</span>][<span class="number">75</span>], T[MAX_LENGTH+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> root = <span class="number">1</span>, cnt, trie[MAX_LETTER+<span class="number">5</span>][DICNUM], fail[MAX_LETTER+<span class="number">5</span>], end[MAX_LETTER+<span class="number">5</span>], tot[<span class="number">155</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">memset</span>(P, <span class="number">0</span>, <span class="keyword">sizeof</span>(P)), <span class="built_in">memset</span>(T, <span class="number">0</span>, <span class="keyword">sizeof</span>(T)), <span class="built_in">memset</span>(tot, <span class="number">0</span>, <span class="keyword">sizeof</span>(tot));</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; i++)	<span class="built_in">memset</span>(trie[i], <span class="number">0</span>, <span class="keyword">sizeof</span>(trie[i])), fail[i] = end[i] = <span class="number">0</span>;	cnt = <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">char</span> s[])</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> cur = <span class="number">1</span>, len = <span class="built_in">strlen</span>(s);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; cur = trie[cur][s[i++]-<span class="string">'a'</span>])</div><div class="line">		<span class="keyword">if</span> (!trie[cur][s[i]-<span class="string">'a'</span>])	trie[cur][s[i]-<span class="string">'a'</span>] = ++cnt;</div><div class="line">	end[cur] = id;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetFail</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;	que.push(root);</div><div class="line">	<span class="keyword">while</span> (!que.empty()) &#123;</div><div class="line">		<span class="keyword">int</span> u = que.front();	que.pop();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++)</div><div class="line">			<span class="keyword">if</span> (trie[u][i])	fail[trie[u][i]] = trie[fail[u]][i], que.push(trie[u][i]);</div><div class="line">			<span class="keyword">else</span> trie[u][i] = trie[fail[u]][i];</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> cur = root, index, len = <span class="built_in">strlen</span>(T);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</div><div class="line">		index = T[i]-<span class="string">'a'</span>;</div><div class="line">		<span class="keyword">while</span> (!trie[cur][index])	cur = fail[cur];</div><div class="line">		cur = trie[cur][index];</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = cur; j; j = fail[j])	tot[end[j]]++;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> n;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++)	trie[<span class="number">0</span>][i] = root;</div><div class="line">	<span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) &amp;&amp; n) &#123;</div><div class="line">		init();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%s"</span>, P[i]), insert(i, P[i]);</div><div class="line">		SetFail(), <span class="built_in">scanf</span>(<span class="string">"%s"</span>, T), query();</div><div class="line">		<span class="keyword">int</span> ans = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	ans = max(ans, tot[i]);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="keyword">if</span> (tot[i] == ans)	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, P[i]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="hash-table">Hash Table</h2>
<blockquote>
<p>【模板】字符串哈希</p>
<p>题目描述 如题，给定N个字符串（第i个字符串长度为Mi，字符串内包含数字、大小写字母，大小写敏感），请求出N个字符串中共有多少个不同的字符串。</p>
<p>输入输出格式 输入格式： 第一行包含一个整数N，为字符串的个数。 接下来N行每行包含一个字符串，为所提供的字符串。 输出格式： 输出包含一行，包含一个整数，为不同的字符串个数。</p>
<p>输入输出样例 输入样例： 5 abc aaaa abc abcc 12345 输出样例： 4</p>
<p>说明 时空限制：1000ms,128M 数据规模： 对于30%的数据：N&lt;=10，Mi≈6，Mmax&lt;=15; 对于70%的数据：N&lt;=1000，Mi≈100，Mmax&lt;=150 对于100%的数据：N&lt;=10000，Mi≈1000，Mmax&lt;=1500</p>
<p>样例说明： 样例中第一个字符串(abc)和第三个字符串(abc)是一样的，所以所提供字符串的集合为{aaaa,abc,abcc,12345}，故共计4个不同的字符串。 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> size 15000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, cnt = <span class="number">0</span>;</div><div class="line"><span class="built_in">string</span> tmp;</div><div class="line"><span class="built_in">string</span> hash[size];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc</span><span class="params">(<span class="built_in">string</span>&amp; index)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index.length(); i++) &#123;</div><div class="line">		ret = (ret*<span class="number">256</span>+index[i]+<span class="number">128</span>)%size;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">search</span><span class="params">(<span class="built_in">string</span>&amp; index, <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</div><div class="line">	pos = calc(index);</div><div class="line">	<span class="keyword">while</span> (hash[pos] != <span class="string">""</span> &amp;&amp; hash[pos] != index) &#123;</div><div class="line">		pos = (pos+<span class="number">1</span>)%size;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (hash[pos] == index) &#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span>&amp; index)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> pos;</div><div class="line">	<span class="keyword">if</span> (search(index, pos)) &#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		hash[pos] = index;</div><div class="line">		<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; n;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; tmp;</div><div class="line">		cnt += insert(tmp);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">cout</span> &lt;&lt; cnt &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="suffix-array">Suffix Array</h2>
<blockquote>
<p>【模板】后缀排序</p>
<p>题目背景 这是一道模板题。</p>
<p>题目描述 读入一个长度为n的由大小写英文字母或数字组成的字符串，请把这个字符串的所有非空后缀按字典序从小到大排序，然后按顺序输出后缀的第一个字符在原串中的位置。位置编号为1到n。 输入输出格式 输入格式： 一行一个长度为n的仅包含大小写英文字母或数字的字符串。 输出格式： 一行，共n个整数，表示答案。</p>
<p>输入输出样例 输入样例#1： ababa 输出样例#1： 5 3 1 4 2</p>
<p>说明 n&lt;=1e6 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1000000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n;	<span class="keyword">char</span> ch[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> s[MAX_N+<span class="number">5</span>], sa[MAX_N+<span class="number">5</span>], tx[MAX_N+<span class="number">5</span>], ty[MAX_N+<span class="number">5</span>], cnt[MAX_N+<span class="number">5</span>], rank[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">trans</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>)	<span class="keyword">return</span> c-<span class="string">'0'</span>+<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span> (c &gt;= <span class="string">'A'</span> &amp;&amp; c &lt;= <span class="string">'Z'</span>)	<span class="keyword">return</span> c-<span class="string">'A'</span>+<span class="number">11</span>;</div><div class="line">	<span class="keyword">if</span> (c &gt;= <span class="string">'a'</span> &amp;&amp; c &lt;= <span class="string">'z'</span>)	<span class="keyword">return</span> c-<span class="string">'a'</span>+<span class="number">37</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getSA</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> *x = tx, *y = ty;	<span class="keyword">int</span> DICNUM = <span class="number">63</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	cnt[x[i] = s[i]]++;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= DICNUM; i++)	cnt[i] += cnt[i<span class="number">-1</span>];</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = n; i; i--)	sa[cnt[x[i]]--] = i;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">1</span>; h &lt;= n; h &lt;&lt;= <span class="number">1</span>) &#123;</div><div class="line">		<span class="keyword">int</span> c = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = n-h+<span class="number">1</span>; i &lt;= n; i++)	y[++c] = i;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="keyword">if</span> (sa[i] &gt; h)	y[++c] = sa[i]-h;</div><div class="line">		<span class="built_in">memset</span>(cnt, <span class="number">0</span>, <span class="keyword">sizeof</span>(cnt));</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	cnt[x[i]]++;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= DICNUM; i++)	cnt[i] += cnt[i<span class="number">-1</span>];</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = n; i; i--)	sa[cnt[x[y[i]]]--] = y[i];</div><div class="line">		swap(x, y), c = <span class="number">0</span>, x[sa[<span class="number">1</span>]] = ++c;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++)	x[sa[i]] = (y[sa[i]] == y[sa[i<span class="number">-1</span>]] &amp;&amp; y[sa[i]+h] == y[sa[i<span class="number">-1</span>]+h]) ? c : ++c;</div><div class="line">		DICNUM = c;	<span class="keyword">if</span> (c == n)	<span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%s"</span>, ch);	n = <span class="built_in">strlen</span>(ch);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)	s[i+<span class="number">1</span>] = trans(ch[i]);</div><div class="line">	getSA();</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%d"</span>, sa[<span class="number">1</span>]);	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++)	<span class="built_in">printf</span>(<span class="string">" %d"</span>, sa[i]);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="suffix-automation">Suffix Automation</h2>
<blockquote>
<p>【模板】后缀自动机</p>
<p>题目描述 给定一个只包含小写字母的字符串S，请你求出S的所有出现次数不为1的子串的出现次数乘上该子串长度的最大值。</p>
<p>输入输出格式 输入格式： 一行一个仅包含小写字母的字符串S 输出格式： 一个整数，为所求答案</p>
<p>输入输出样例 输入样例#1： abab 输出样例#1： 4</p>
<p>说明 对于10%的数据，|S|&lt;=1000 对于100%的数据，|S|&lt;=1e6 <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1000000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lnt;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span><span class="keyword">int</span> ch[<span class="number">26</span>], par, len;&#125; SAM[MAX_N*<span class="number">2</span>+<span class="number">500</span>];</div><div class="line"><span class="keyword">int</span> sz, root, last, cnt[MAX_N*<span class="number">2</span>+<span class="number">500</span>], dfn[MAX_N*<span class="number">2</span>+<span class="number">500</span>], f[MAX_N*<span class="number">2</span>+<span class="number">500</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> _len)</span> </span>&#123;SAM[++sz].len = _len;	<span class="keyword">return</span> sz;&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;sz = <span class="number">0</span>, root = last = newnode(<span class="number">0</span>);&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">extend</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> p = last, np = newnode(SAM[p].len+<span class="number">1</span>);	last = np, f[np] = <span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span> (; p &amp;&amp; !SAM[p].ch[c]; p = SAM[p].par)	SAM[p].ch[c] = np;</div><div class="line">	<span class="keyword">if</span> (!p)	SAM[np].par = root;</div><div class="line">	<span class="keyword">else</span> &#123;</div><div class="line">		<span class="keyword">int</span> q = SAM[p].ch[c];</div><div class="line">		<span class="keyword">if</span> (SAM[q].len == SAM[p].len+<span class="number">1</span>)	SAM[np].par = q;</div><div class="line">		<span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">int</span> nq = newnode(SAM[p].len+<span class="number">1</span>);</div><div class="line">			<span class="built_in">memcpy</span>(SAM[nq].ch, SAM[q].ch, <span class="keyword">sizeof</span>(SAM[q].ch));</div><div class="line">			SAM[nq].par = SAM[q].par, SAM[q].par = SAM[np].par = nq;</div><div class="line">			<span class="keyword">for</span> (; p &amp;&amp; SAM[p].ch[c] == q; p = SAM[p].par)	SAM[p].ch[c] = nq;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">char</span> s[MAX_N+<span class="number">5</span>];	init(), <span class="built_in">scanf</span>(<span class="string">"%s"</span>, s);	<span class="keyword">int</span> l = <span class="built_in">strlen</span>(s);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; l; i++)	extend(s[i]-<span class="string">'a'</span>);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= sz; i++)	cnt[SAM[i].len]++;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= l; i++)	cnt[i] += cnt[i<span class="number">-1</span>];</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= sz; i++)	dfn[cnt[SAM[i].len]--] = i;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= sz; i++)	<span class="built_in">cout</span> &lt;&lt; dfn[i] &lt;&lt; <span class="string">" "</span>;	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">	lnt ans = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = sz; i &gt;= <span class="number">1</span>; i--) &#123;</div><div class="line">		<span class="keyword">int</span> p = dfn[i];	f[SAM[p].par] += f[p];</div><div class="line">		<span class="keyword">if</span> (f[p] &gt; <span class="number">1</span>)	ans = max(ans, (lnt)f[p]*SAM[p].len);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%lld"</span>, ans);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/20171001-08总结/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          201701001-08总结
        
      </div>
    </a>
  
  
    <a href="/BZOJ1787【AHOI2008】Meet紧急集合 LCA/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">BZOJ1787【AHOI2008】Meet紧急集合 &lt;LCA&gt;</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="ds-share share" data-thread-key="洛谷模板汇总" data-title="【福利】洛谷模板汇总" data-url="http://yoursite.com/洛谷模板汇总/"  data-images="http://chuantu.biz/t6/89/1507626502x2728279003.jpg" data-content="【福利】洛谷模板汇总">
    <div class="ds-share-inline">
      <ul  class="ds-share-icons-16">
      	<li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
        <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
        <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
      </ul>
      <div class="ds-share-icons-more">
      </div>
    </div>
 </div>
 





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2017 Azrael_Death
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
  </script>
  <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  
</footer>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



  </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>