<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>AC自动机基础例题 | NIRVANA</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="AC自动机(Aho-Corasick Automation)用于解决多模式串匹配主串的问题给所有模式串写一个Trie，在Trie上跑KMP，其中KMP的next数组变成了AC自动机的Fail指针计算fail和计算next一样，用dp，只不过这里是树上dp原理不再赘述，上模板 12345678910111213141516171819202122232425262728293031323334353">
<meta name="keywords" content="数据结构,AC自动机">
<meta property="og:type" content="article">
<meta property="og:title" content="AC自动机基础例题">
<meta property="og:url" content="http://yoursite.com/AC自动机基础例题/index.html">
<meta property="og:site_name" content="NIRVANA">
<meta property="og:description" content="AC自动机(Aho-Corasick Automation)用于解决多模式串匹配主串的问题给所有模式串写一个Trie，在Trie上跑KMP，其中KMP的next数组变成了AC自动机的Fail指针计算fail和计算next一样，用dp，只不过这里是树上dp原理不再赘述，上模板 12345678910111213141516171819202122232425262728293031323334353">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-11-09T08:51:13.130Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AC自动机基础例题">
<meta name="twitter:description" content="AC自动机(Aho-Corasick Automation)用于解决多模式串匹配主串的问题给所有模式串写一个Trie，在Trie上跑KMP，其中KMP的next数组变成了AC自动机的Fail指针计算fail和计算next一样，用dp，只不过这里是树上dp原理不再赘述，上模板 12345678910111213141516171819202122232425262728293031323334353">
  
    <link rel="alternative" href="/atom.xml" title="NIRVANA" type="application/atom+xml">
  
  
    <link rel="icon" href="http://chuantu.biz/t6/89/1507626502x2728279003.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
  
  

  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
</head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://chuantu.biz/t6/89/1507626502x2728279003.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Azrael_Death</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Veni Vidi Vici</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/AzraelDeath" title="github">github</a>
					        
								<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/azraeldeath" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/2-SAT/" style="font-size: 10.83px;">2-SAT</a> <a href="/tags/AC自动机/" style="font-size: 10.83px;">AC自动机</a> <a href="/tags/APIO/" style="font-size: 10px;">APIO</a> <a href="/tags/BZOJ/" style="font-size: 20px;">BZOJ</a> <a href="/tags/DFS序/" style="font-size: 10px;">DFS序</a> <a href="/tags/DP/" style="font-size: 15.83px;">DP</a> <a href="/tags/HDU/" style="font-size: 12.5px;">HDU</a> <a href="/tags/LCA/" style="font-size: 12.5px;">LCA</a> <a href="/tags/LG/" style="font-size: 12.5px;">LG</a> <a href="/tags/MST/" style="font-size: 12.5px;">MST</a> <a href="/tags/Manacher/" style="font-size: 10.83px;">Manacher</a> <a href="/tags/NOI/" style="font-size: 10.83px;">NOI</a> <a href="/tags/NOIp/" style="font-size: 13.33px;">NOIp</a> <a href="/tags/POI/" style="font-size: 10px;">POI</a> <a href="/tags/POJ/" style="font-size: 15px;">POJ</a> <a href="/tags/Tarjan/" style="font-size: 10.83px;">Tarjan</a> <a href="/tags/Trie/" style="font-size: 10px;">Trie</a> <a href="/tags/UVa/" style="font-size: 10px;">UVa</a> <a href="/tags/主席树/" style="font-size: 12.5px;">主席树</a> <a href="/tags/二分图/" style="font-size: 10px;">二分图</a> <a href="/tags/二分答案/" style="font-size: 10.83px;">二分答案</a> <a href="/tags/分块/" style="font-size: 10px;">分块</a> <a href="/tags/图论/" style="font-size: 17.5px;">图论</a> <a href="/tags/字符串/" style="font-size: 12.5px;">字符串</a> <a href="/tags/差分/" style="font-size: 10px;">差分</a> <a href="/tags/差分约束系统/" style="font-size: 10px;">差分约束系统</a> <a href="/tags/并查集/" style="font-size: 10.83px;">并查集</a> <a href="/tags/总结/" style="font-size: 16.67px;">总结</a> <a href="/tags/搜索/" style="font-size: 10px;">搜索</a> <a href="/tags/数位DP/" style="font-size: 10.83px;">数位DP</a> <a href="/tags/数据结构/" style="font-size: 18.33px;">数据结构</a> <a href="/tags/数论数学/" style="font-size: 11.67px;">数论数学</a> <a href="/tags/期望DP/" style="font-size: 10px;">期望DP</a> <a href="/tags/树套树/" style="font-size: 10.83px;">树套树</a> <a href="/tags/树状数组/" style="font-size: 11.67px;">树状数组</a> <a href="/tags/树链剖分/" style="font-size: 10px;">树链剖分</a> <a href="/tags/模拟/" style="font-size: 10.83px;">模拟</a> <a href="/tags/状压DP/" style="font-size: 10.83px;">状压DP</a> <a href="/tags/省选/" style="font-size: 19.17px;">省选</a> <a href="/tags/线段树/" style="font-size: 13.33px;">线段树</a> <a href="/tags/组合数学/" style="font-size: 10px;">组合数学</a> <a href="/tags/网络流/" style="font-size: 14.17px;">网络流</a> <a href="/tags/莫队/" style="font-size: 10.83px;">莫队</a> <a href="/tags/补集转换/" style="font-size: 10px;">补集转换</a> <a href="/tags/贪心/" style="font-size: 10px;">贪心</a> <a href="/tags/费用流/" style="font-size: 10px;">费用流</a> <a href="/tags/队列/" style="font-size: 10px;">队列</a> <a href="/tags/高斯消元/" style="font-size: 10px;">高斯消元</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/OwenOwl">OwenOwl</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/Joker_69">Joker</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://dangxingyu.com">DXY</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://309459245.lofter.com">YJQ</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/candy99">Candy</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/zig-zag">ZigZag</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://cxjyxx.me">cxjyxx_me</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.shuizilong.com">ShuiZiLong</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/kuangbin">KuangBin</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Azrael_Death</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://chuantu.biz/t6/89/1507626502x2728279003.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Azrael_Death</h1>
			</hgroup>
			
			<p class="header-subtitle">Veni Vidi Vici</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/AzraelDeath" title="github">github</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/azraeldeath" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-AC自动机基础例题" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/AC自动机基础例题/" class="article-date">
  	<time datetime="2017-07-13T16:00:00.000Z" itemprop="datePublished">2017-07-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      AC自动机基础例题
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AC自动机/">AC自动机</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据结构/">数据结构</a></li></ul>
	</div>

        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>AC自动机(Aho-Corasick Automation)用于解决多模式串匹配主串的问题<br>给所有模式串写一个Trie，在Trie上跑KMP，其中KMP的next数组变成了AC自动机的Fail指针<br>计算fail和计算next一样，用dp，只不过这里是树上dp<br>原理不再赘述，上模板</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ACautomation</span> &#123;</span></div><div class="line"><span class="keyword">private</span>:</div><div class="line">	<span class="keyword">int</span> cnt, root;</div><div class="line">	<span class="keyword">int</span> **child, *sta, *fail;</div><div class="line">	<span class="keyword">bool</span> *flag;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">	ACautomation(<span class="keyword">int</span> tot) &#123;</div><div class="line">		cnt = root = <span class="number">1</span>;</div><div class="line">		sta = <span class="keyword">new</span> <span class="keyword">int</span>[tot+<span class="number">1</span>];</div><div class="line">		<span class="built_in">memset</span>(sta, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>)*(tot+<span class="number">1</span>));</div><div class="line">		fail = <span class="keyword">new</span> <span class="keyword">int</span>[tot+<span class="number">1</span>];</div><div class="line">		<span class="built_in">memset</span>(fail, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>)*(tot+<span class="number">1</span>));</div><div class="line">		flag = <span class="keyword">new</span> <span class="keyword">bool</span>[tot+<span class="number">1</span>];</div><div class="line">		<span class="built_in">memset</span>(flag, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">bool</span>)*(tot+<span class="number">1</span>));</div><div class="line">		child = <span class="keyword">new</span> <span class="keyword">int</span>*[tot+<span class="number">1</span>];</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= tot; i++) &#123;</div><div class="line">			child[i] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">26</span>];</div><div class="line">			<span class="built_in">memset</span>(child[i], <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>)*<span class="number">26</span>);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)	child[<span class="number">0</span>][i] = <span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	~ACautomation() &#123;</div><div class="line">		<span class="keyword">delete</span>[] sta;</div><div class="line">		<span class="keyword">delete</span>[] fail;</div><div class="line">		<span class="keyword">delete</span>[] flag;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= cnt; i++)</div><div class="line">			<span class="keyword">delete</span>[] child[i];</div><div class="line">		<span class="keyword">delete</span>[] child;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span>&amp; s)</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> cur = <span class="number">1</span>, i;</div><div class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; s.length(); cur = child[cur][s[i++]-<span class="string">'a'</span>])</div><div class="line">			<span class="keyword">if</span> (!child[cur][s[i]-<span class="string">'a'</span>])	child[cur][s[i]-<span class="string">'a'</span>] = ++cnt;</div><div class="line">		sta[cur]++;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setFail</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;</div><div class="line">		que.push(<span class="number">1</span>);</div><div class="line">		<span class="keyword">while</span> (!que.empty()) &#123;</div><div class="line">			<span class="keyword">int</span> u = que.front();</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</div><div class="line">				<span class="keyword">if</span> (child[u][i]) &#123;</div><div class="line">					fail[child[u][i]] = child[fail[u]][i];</div><div class="line">					que.push(child[u][i]);</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					child[u][i] = child[fail[u]][i];</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			que.pop();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="built_in">string</span>&amp; s)</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> ret = <span class="number">0</span>, cur = <span class="number">1</span>, index;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</div><div class="line">			flag[cur] = <span class="literal">true</span>;</div><div class="line">			index = s[i]-<span class="string">'a'</span>;</div><div class="line">			<span class="keyword">while</span> (!child[cur][index])	cur = fail[cur];</div><div class="line">			cur = child[cur][index];</div><div class="line">			<span class="keyword">if</span> (flag[cur])	<span class="keyword">continue</span>;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = cur; j; j = fail[j]) &#123;</div><div class="line">				ret += sta[j];</div><div class="line">				sta[j] = <span class="number">0</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> n;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; n;</div><div class="line">	<span class="function">ACautomation <span class="title">T</span><span class="params">(n*<span class="number">50</span>)</span></span>;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">		<span class="built_in">string</span> s;</div><div class="line">		<span class="built_in">cin</span> &gt;&gt; s;</div><div class="line">		T.insert(s);</div><div class="line">	&#125;</div><div class="line">	T.setFail();</div><div class="line">	<span class="built_in">string</span> str;</div><div class="line">	<span class="built_in">cin</span> &gt;&gt; str;</div><div class="line">	<span class="built_in">cout</span> &lt;&lt; T.query(str);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这是本人第一次写AC自动机封装的代码，很拙劣。由于我写Trie树一直把根节点设为1号，所以想出把0号节点所有儿子都指向1，这样如果fail指回到0的时候，child[u][i]都会将其重新指向根节点1，这样思考会简单一些。但是有时候要TLE</p>
<p>我做的第一道AC自动机题目是HDU2222，这是裸的模板，数据也很水</p>
<blockquote>
<p>【HDU2222】 Keywords Search<br>Time Limit: 2000/1000 MS (Java/Others)<br>Memory Limit: 131072/131072 K (Java/Others)</p>
<p>Problem Description<br>In the modern time, Search engine came into the life of everybody like Google, Baidu, etc.<br>Wiskey also wants to bring this feature to his image retrieval system.<br>Every image have a long description, when users type some keywords to find the image, the system will match the keywords with description of image and show the image which the most keywords be matched.<br>To simplify the problem, giving you a description of image, and some keywords, you should tell me how many keywords will be match.</p>
<p>Input<br>First line will contain one integer means how many cases will follow by.<br>Each case will contain two integers N means the number of keywords and N keywords follow. (N &lt;= 10000)<br>Each keyword will only contains characters ‘a’-‘z’, and the length will be not longer than 50.<br>The last line is the description, and the length will be not longer than 1000000.<br>Output<br>Print how many keywords are contained in the description.</p>
<p>Sample Input<br>1<br>5<br>she<br>he<br>say<br>shr<br>her<br>yasherhs<br>Sample Output<br>3</p>
</blockquote>
<p>AC代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LETTER 500000</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> trie[MAX_LETTER+<span class="number">5</span>][<span class="number">26</span>], tag[MAX_LETTER+<span class="number">5</span>], cnt;</div><div class="line"><span class="keyword">int</span> fail[MAX_LETTER+<span class="number">5</span>], flag[MAX_LETTER+<span class="number">5</span>], que[MAX_LETTER+<span class="number">5</span>];</div><div class="line"><span class="keyword">char</span> s[<span class="number">55</span>], str[<span class="number">1000005</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%s"</span>, s);</div><div class="line">	<span class="keyword">int</span> cur, i, l = <span class="built_in">strlen</span>(s);</div><div class="line">	<span class="keyword">for</span> (cur = <span class="number">1</span>, i = <span class="number">0</span>; i &lt; l; cur = trie[cur][s[i++]-<span class="string">'a'</span>])</div><div class="line">		<span class="keyword">if</span> (!trie[cur][s[i]-<span class="string">'a'</span>])	trie[cur][s[i]-<span class="string">'a'</span>] = ++cnt;</div><div class="line">	tag[cur]++;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">1</span>;</div><div class="line">	que[head] = <span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span> (head &lt; tail) &#123;</div><div class="line">		<span class="keyword">int</span> u = que[head++];</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</div><div class="line">			<span class="keyword">if</span> (trie[u][i]) &#123;</div><div class="line">				que[tail++] = trie[u][i];</div><div class="line">				fail[trie[u][i]] = trie[fail[u]][i];</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				trie[u][i] = trie[fail[u]][i];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>, cur = <span class="number">1</span>, index;</div><div class="line">	<span class="keyword">int</span> len = <span class="built_in">strlen</span>(str);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</div><div class="line">		flag[cur] = <span class="number">1</span>;</div><div class="line">		index = str[i]-<span class="string">'a'</span>;</div><div class="line">		<span class="keyword">while</span> (!trie[cur][index])	cur = fail[cur];</div><div class="line">		cur = trie[cur][index];</div><div class="line">		<span class="keyword">if</span> (flag[cur])	<span class="keyword">continue</span>;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = cur; j; j = fail[j]) &#123;</div><div class="line">			ret += tag[j];</div><div class="line">			tag[j] = <span class="number">0</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> T, n;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)	trie[<span class="number">0</span>][i] = <span class="number">1</span>;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T);</div><div class="line">	<span class="keyword">while</span> (T--) &#123;</div><div class="line">		cnt = <span class="number">1</span>;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)	insert();</div><div class="line">		BFS();</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%s"</span>, str);</div><div class="line">		query();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; i++) &#123;</div><div class="line">			tag[i] = fail[i] = flag[i] = <span class="number">0</span>;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">26</span>; j++)</div><div class="line">				trie[i][j] = <span class="number">0</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>HDU3065和这道题很像，也是几乎裸的模板<br>&gt;<br>【HDU3065】病毒侵袭持续中<br>Time Limit: 2000/1000 MS (Java/Others)<br>Memory Limit: 32768/32768 K (Java/Others)<br>&gt;<br>Problem Description<br>小t非常感谢大家帮忙解决了他的上一个问题。然而病毒侵袭持续中。在小t的不懈努力下，他发现了网路中的“万恶之源”。这是一个庞大的病毒网站，他有着好多好多的病毒，但是这个网站包含的病毒很奇怪，这些病毒的特征码很短，而且只包含“英文大写字符”。当然小t好想好想为民除害，但是小t从来不打没有准备的战争。知己知彼，百战不殆，小t首先要做的是知道这个病毒网站特征：包含多少不同的病毒，每种病毒出现了多少次。大家能再帮帮他吗？<br>&gt;<br>Input<br>第一行，一个整数N（1&lt;=N&lt;=1000），表示病毒特征码的个数。<br>接下来N行，每行表示一个病毒特征码，特征码字符串长度在1—50之间，并且只包含“英文大写字符”。任意两个病毒特征码，不会完全相同。<br>在这之后一行，表示“万恶之源”网站源码，源码字符串长度在2000000之内。字符串中字符都是ASCII码可见字符（不包括回车）。<br>Output<br>按以下格式每行一个，输出每个病毒出现次数。未出现的病毒不需要输出。<br>病毒特征码: 出现次数<br>冒号后有一个空格，按病毒特征码的输入顺序进行输出。<br>&gt;<br>Sample Input<br>3<br>AA<br>BB<br>CC<br>ooxxCC%dAAAoen….END<br>Sample Output<br>AA: 2<br>CC: 1<br>&gt;<br>Hint<br>题目描述中没有被提及的所有情况都应该进行考虑。比如两个病毒特征码可能有相互包含或者有重叠的特征码段。<br>计数策略也可一定程度上从Sample中推测。</p>
<p>AC代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LETTER 100000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DICNUM 26</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n, cnt;</div><div class="line"><span class="keyword">int</span> child[MAX_LETTER+<span class="number">5</span>][DICNUM], id[MAX_LETTER+<span class="number">5</span>], fail[MAX_LETTER+<span class="number">5</span>], ans[MAX_N+<span class="number">5</span>];</div><div class="line"><span class="keyword">int</span> que[MAX_LETTER+<span class="number">5</span>];</div><div class="line"><span class="keyword">char</span> s[<span class="number">2000005</span>], dic[<span class="number">1005</span>][<span class="number">55</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">	cnt = <span class="number">1</span>;</div><div class="line">	<span class="built_in">memset</span>(child, <span class="number">0</span>, <span class="keyword">sizeof</span>(child));</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++)	child[<span class="number">0</span>][i] = <span class="number">1</span>;</div><div class="line">	<span class="built_in">memset</span>(id, <span class="number">0</span>, <span class="keyword">sizeof</span>(id));</div><div class="line">	<span class="built_in">memset</span>(fail, <span class="number">0</span>, <span class="keyword">sizeof</span>(fail));</div><div class="line">	<span class="built_in">memset</span>(ans, <span class="number">0</span>, <span class="keyword">sizeof</span>(ans));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</div><div class="line">		<span class="keyword">int</span> cur = <span class="number">1</span>, l = <span class="built_in">strlen</span>(dic[j]);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; l; cur = child[cur][dic[j][i++]-<span class="string">'A'</span>])</div><div class="line">			<span class="keyword">if</span> (!child[cur][dic[j][i]-<span class="string">'A'</span>])	child[cur][dic[j][i]-<span class="string">'A'</span>] = ++cnt;</div><div class="line">		id[cur] = j;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">setFail</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">1</span>;</div><div class="line">	que[head] = <span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span> (head &lt; tail) &#123;</div><div class="line">		<span class="keyword">int</span> u = que[head++];</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++) &#123;</div><div class="line">			<span class="keyword">if</span> (child[u][i]) &#123;</div><div class="line">				que[tail++] = child[u][i];</div><div class="line">				<span class="keyword">int</span> cur = fail[u];</div><div class="line">				<span class="keyword">while</span> (!child[cur][i])	cur = fail[cur];</div><div class="line">				fail[child[u][i]] = child[cur][i];</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				child[u][i] = child[fail[u]][i];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> cur = <span class="number">1</span>, index, l = <span class="built_in">strlen</span>(s);</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; l; i++) &#123;</div><div class="line">		index = s[i]-<span class="string">'A'</span>;</div><div class="line">		<span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; <span class="number">25</span>) &#123;</div><div class="line">			cur = <span class="number">1</span>;</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">while</span> (!child[cur][index])	cur = fail[cur];</div><div class="line">			cur = child[cur][index];</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = cur; j; j = fail[j])</div><div class="line">			<span class="keyword">if</span> (id[j])</div><div class="line">				ans[id[j]]++;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) != EOF) &#123;</div><div class="line">		init();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%s"</span>, dic[i]);</div><div class="line">		insert();</div><div class="line">		setFail();</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%s"</span>, s);</div><div class="line">		query();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</div><div class="line">			<span class="keyword">if</span> (ans[i])</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"%s: %d\n"</span>, dic[i], ans[i]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这两道题用我拙劣的写法还可以过，但是HDU2896就过不了</p>
<blockquote>
<p>【HDU2896】病毒侵袭<br>Time Limit: 2000/1000 MS (Java/Others)<br>Memory Limit: 32768/32768 K (Java/Others)</p>
<p>Problem Description<br>当太阳的光辉逐渐被月亮遮蔽，世界失去了光明，大地迎来最黑暗的时刻。。。。在这样的时刻，人们却异常兴奋——我们能在有生之年看到500年一遇的世界奇观，那是多么幸福的事儿啊~~<br>但网路上总有那么些网站，开始借着民众的好奇心，打着介绍日食的旗号，大肆传播病毒。小t不幸成为受害者之一。小t如此生气，他决定要把世界上所有带病毒的网站都找出来。当然，谁都知道这是不可能的。小t却执意要完成这不能的任务，他说：“子子孙孙无穷匮也！”（愚公后继有人了）。<br>万事开头难，小t收集了好多病毒的特征码，又收集了一批诡异网站的源码，他想知道这些网站中哪些是有病毒的，又是带了怎样的病毒呢？顺便还想知道他到底收集了多少带病毒的网站。这时候他却不知道何从下手了。所以想请大家帮帮忙。小t又是个急性子哦，所以解决问题越快越好哦~~</p>
<p>Input<br>第一行，一个整数N（1&lt;=N&lt;=500），表示病毒特征码的个数。<br>接下来N行，每行表示一个病毒特征码，特征码字符串长度在20—200之间。<br>每个病毒都有一个编号，依此为1—N。<br>不同编号的病毒特征码不会相同。<br>在这之后一行，有一个整数M（1&lt;=M&lt;=1000），表示网站数。<br>接下来M行，每行表示一个网站源码，源码字符串长度在7000—10000之间。<br>每个网站都有一个编号，依此为1—M。<br>以上字符串中字符都是ASCII码可见字符（不包括回车）。<br>Output<br>依次按如下格式输出按网站编号从小到大输出，带病毒的网站编号和包含病毒编号，每行一个含毒网站信息。<br>web 网站编号: 病毒编号 病毒编号 …<br>冒号后有一个空格，病毒编号按从小到大排列，两个病毒编号之间用一个空格隔开，如果一个网站包含病毒，病毒数不会超过3个。<br>最后一行输出统计信息，如下格式<br>total: 带病毒网站数<br>冒号后有一个空格。</p>
<p>Sample Input<br>3<br>aaa<br>bbb<br>ccc<br>2<br>aaabbbccc<br>bbaacc<br>Sample Output<br>web 1: 1 2 3<br>total: 1</p>
</blockquote>
<p>AC代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AC</span> &#123;</span></div><div class="line">	<span class="keyword">int</span> child[<span class="number">200</span>*<span class="number">500</span>+<span class="number">500</span>][<span class="number">128</span>], fail[<span class="number">200</span>*<span class="number">500</span>+<span class="number">500</span>], end[<span class="number">200</span>*<span class="number">500</span>+<span class="number">500</span>];</div><div class="line">	<span class="keyword">int</span> root, cnt;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">128</span>; i++)	child[cnt][i] = <span class="number">-1</span>;</div><div class="line">		end[cnt++] = <span class="number">-1</span>;</div><div class="line">		<span class="keyword">return</span> cnt<span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">		cnt = <span class="number">0</span>;</div><div class="line">		root = newnode();</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">char</span> s[])</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> len = <span class="built_in">strlen</span>(s), cur = root;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; cur = child[cur][s[i++]])</div><div class="line">			<span class="keyword">if</span> (child[cur][s[i]] == <span class="number">-1</span>)	child[cur][s[i]] = newnode();</div><div class="line">		end[cur] = id;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setFail</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;</div><div class="line">		fail[root] = root;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">128</span>; i++) &#123;</div><div class="line">			<span class="keyword">if</span> (child[root][i] == <span class="number">-1</span>) &#123;</div><div class="line">				child[root][i] = root;</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				fail[child[root][i]] = root;</div><div class="line">				que.push(child[root][i]);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">while</span> (!que.empty()) &#123;</div><div class="line">			<span class="keyword">int</span> u = que.front();</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">128</span>; i++) &#123;</div><div class="line">				<span class="keyword">if</span> (child[u][i] != <span class="number">-1</span>) &#123;</div><div class="line">					fail[child[u][i]] = child[fail[u]][i];</div><div class="line">					que.push(child[u][i]);</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					child[u][i] = child[fail[u]][i];</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			que.pop();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">bool</span> flag[<span class="number">505</span>];</div><div class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> id, <span class="keyword">char</span> s[])</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</div><div class="line">		<span class="keyword">int</span> cur = root;</div><div class="line">		<span class="keyword">bool</span> mark = <span class="literal">false</span>;</div><div class="line">		<span class="built_in">memset</span>(flag, <span class="number">0</span>, <span class="keyword">sizeof</span>(flag));</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</div><div class="line">			cur = child[cur][s[i]];</div><div class="line">			<span class="keyword">int</span> tmp = cur;</div><div class="line">			<span class="keyword">while</span> (tmp != root) &#123;</div><div class="line">				<span class="keyword">if</span> (end[tmp] != <span class="number">-1</span>)	flag[end[tmp]] = mark = <span class="literal">true</span>;</div><div class="line">				tmp = fail[tmp];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (!mark)	<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"web %d:"</span>, id);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</div><div class="line">			<span class="keyword">if</span> (flag[i])</div><div class="line">				<span class="built_in">printf</span>(<span class="string">" %d"</span>, i);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">	&#125;</div><div class="line">&#125; ac;</div><div class="line"><span class="keyword">char</span> str[<span class="number">10005</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> n, m, ans;</div><div class="line">	<span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) != EOF) &#123;</div><div class="line">		ac.init();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%s"</span>, str);</div><div class="line">			ac.insert(i, str);</div><div class="line">		&#125;</div><div class="line">		ac.setFail();</div><div class="line">		ans = <span class="number">0</span>;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;m);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%s"</span>, str);</div><div class="line">			ans += ac.query(n, i, str);</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"total: %d\n"</span>, ans);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来看一道稍微有些变化的题（虽然还是基础水题）</p>
<blockquote>
<p>【ZOJ3034】 Detect the Virus<br>One day, Nobita found that his computer is extremely slow. After several hours’ work, he finally found that it was a virus that made his poor computer slow and the virus was activated by a misoperation of opening an attachment of an email.<br>Nobita did use an outstanding anti-virus software, however, for some strange reason, this software did not check email attachments. Now Nobita decide to detect viruses in emails by himself.<br>To detect an virus, a virus sample (several binary bytes) is needed. If these binary bytes can be found in the email attachment (binary data), then the attachment contains the virus.<br>Note that attachments (binary data) in emails are usually encoded in base64. To encode a binary stream in base64, first write the binary stream into bits. Then take 6 bits from the stream in turn, encode these 6 bits into a base64 character according the following table:<br>That is, translate every 3 bytes into 4 base64 characters. If the original binary stream contains 3k + 1 bytes, where k is an integer, fill last bits using zero when encoding and append ‘==’ as padding. If the original binary stream contains 3k + 2 bytes, fill last bits using zero when encoding and append ‘=’ as padding. No padding is needed when the original binary stream contains 3k bytes. </p>
<p>Value    Encoding    Value    Encoding<br>0        A            32        g<br>1        B            33        h<br>2        C            34        i<br>3        D            35        j<br>4        E            36        k<br>5        F            37        l<br>6        G             38        m<br>7        H            39        n<br>8        I            40        o<br>9        J            41        p<br>10        K            42        q<br>11        L            43        r<br>12        M            44        s<br>13        N            45        t<br>14        O            46        u<br>15        P            47        v<br>16        Q            48        w<br>17        R            49        x<br>18        S            50        y<br>19        T            51        z<br>20        U            52        0<br>21        V            53        1<br>22        W            54        2<br>23        X            55        3<br>24        Y            56        4<br>25        Z            57        5<br>26        a            58        6<br>27        b            59        7<br>28        c            60        8<br>29        d            61        9<br>30        e            62        +<br>31        f            63        /</p>
<p>For example, to encode ‘hello’ into base64, first write ‘hello’ as binary bits, that is: 01101000 01100101 01101100 01101100 01101111<br>Then, take 6 bits in turn and fill last bits as zero as padding (zero padding bits are marked in bold): 011010 000110 010101 101100 011011 000110 111100<br>They are 26 6 21 44 27 6 60 in decimal. Look up the table above and use corresponding characters: aGVsbG8<br>Since original binary data contains 1 * 3 + 2 bytes, padding is needed, append ‘=’ and ‘hello’ is finally encoded in base64: aGVsbG8=<br>Section 5.2 of RFC 1521 describes how to encode a binary stream in base64 much more detailedly:<br>Here is a piece of ANSI C code that can encode binary data in base64. It contains a function, encode (infile, outfile), to encode binary file infile in base64 and output result to outfile.</p>
<p>Input<br>Input contains multiple cases (about 15, of which most are small ones). The first line of each case contains an integer N (0 &lt;= N &lt;= 512). In the next N distinct lines, each line contains a sample of a kind of virus, which is not empty, has not more than 64 bytes in binary and is encoded in base64. Then, the next line contains an integer M (1 &lt;= M &lt;= 128). In the following M lines, each line contains the content of a file to be detected, which is not empty, has no more than 2048 bytes in binary and is encoded in base64.<br>There is a blank line after each case.<br>Output<br>For each case, output M lines. The ith line contains the number of kinds of virus detected in the ith file.<br>Output a blank line after each case.</p>
<p>Sample Input<br>3<br>YmFzZTY0<br>dmlydXM=<br>dDog<br>1<br>dGVzdDogdmlydXMu</p>
<p>1<br>QA==<br>2<br>QA==<br>ICAgICAgICA=<br>Sample Output<br>2</p>
<p>1<br>0</p>
<p>Hint<br>In the first sample case, there are three virus samples: base64, virus and t: , the data to be checked is test: virus., which contains the second and the third, two virus samples.</p>
</blockquote>
<p>思路很简单，先解码，然后就是模板题了</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DICNUM 256</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ACautomation</span> &#123;</span></div><div class="line">	<span class="keyword">int</span> cnt, root;</div><div class="line">	<span class="keyword">int</span> child[<span class="number">50000</span>+<span class="number">50</span>][DICNUM], end[<span class="number">50000</span>+<span class="number">50</span>], fail[<span class="number">50000</span>+<span class="number">50</span>];</div><div class="line">	<span class="keyword">int</span> Map[<span class="number">256</span>];</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++)	child[cnt][i] = <span class="number">-1</span>;</div><div class="line">		end[cnt++] = <span class="number">-1</span>;</div><div class="line">		<span class="keyword">return</span> cnt<span class="number">-1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">		cnt = <span class="number">0</span>;</div><div class="line">		root = newnode();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)	Map[i+<span class="string">'A'</span>] = i;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">26</span>; i &lt; <span class="number">52</span>; i++)	Map[i<span class="number">-26</span>+<span class="string">'a'</span>] = i;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">52</span>; i &lt; <span class="number">62</span>; i++)	Map[i<span class="number">-52</span>+<span class="string">'0'</span>] = i;</div><div class="line">		Map[<span class="string">'+'</span>] = <span class="number">62</span>, Map[<span class="string">'/'</span>] = <span class="number">63</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">int</span> tmp[<span class="number">5000</span>+<span class="number">5</span>], tmpl;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ReEncode</span><span class="params">(<span class="keyword">char</span> s[])</span> </span>&#123;</div><div class="line">		<span class="built_in">memset</span>(tmp, <span class="number">0</span>, <span class="keyword">sizeof</span>(tmp));</div><div class="line">		tmpl = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, len = <span class="number">0</span>, x = <span class="number">0</span>; s[i] &amp;&amp; s[i] != <span class="string">'='</span>; i++) &#123;</div><div class="line">			len += <span class="number">6</span>, x = (x&lt;&lt;<span class="number">6</span>)|Map[s[i]];</div><div class="line">			<span class="keyword">if</span> (len &gt;= <span class="number">8</span>) &#123;</div><div class="line">				tmp[tmpl++] = (x&gt;&gt;(len<span class="number">-8</span>))&amp;<span class="number">0xff</span>;</div><div class="line">				len -= <span class="number">8</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">char</span> s[])</span> </span>&#123;</div><div class="line">		ReEncode(s);</div><div class="line">		<span class="keyword">int</span> cur = root;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tmpl; cur = child[cur][tmp[i++]])</div><div class="line">			<span class="keyword">if</span> (child[cur][tmp[i]] == <span class="number">-1</span>)	child[cur][tmp[i]] = newnode();</div><div class="line">		end[cur] = id;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setFail</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;</div><div class="line">		fail[root] = root;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++) &#123;</div><div class="line">			<span class="keyword">if</span> (child[root][i] == <span class="number">-1</span>) &#123;</div><div class="line">				child[root][i] = root;</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				fail[child[root][i]] = root;</div><div class="line">				que.push(child[root][i]);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">while</span> (!que.empty()) &#123;</div><div class="line">			<span class="keyword">int</span> cur = que.front();</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++) &#123;</div><div class="line">				<span class="keyword">if</span> (child[cur][i] == <span class="number">-1</span>) &#123;</div><div class="line">					child[cur][i] = child[fail[cur]][i];</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					fail[child[cur][i]] = child[fail[cur]][i];</div><div class="line">					que.push(child[cur][i]);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			que.pop();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">bool</span> flag[<span class="number">50000</span>+<span class="number">50</span>];</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">char</span> s[])</span> </span>&#123;</div><div class="line">		ReEncode(s);</div><div class="line">		<span class="keyword">int</span> cur = root, ret = <span class="number">0</span>;</div><div class="line">		<span class="built_in">memset</span>(flag, <span class="number">0</span>, <span class="keyword">sizeof</span>(flag));</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tmpl; i++) &#123;</div><div class="line">			cur = child[cur][tmp[i]];</div><div class="line">			<span class="keyword">int</span> t = cur;</div><div class="line">			<span class="keyword">while</span> (t != root) &#123;</div><div class="line">				<span class="keyword">if</span> (end[t] != <span class="number">-1</span> &amp;&amp; !flag[end[t]])	ret++, flag[end[t]] = <span class="literal">true</span>;</div><div class="line">				t = fail[t];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">	&#125; </div><div class="line">&#125; ACauto;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> n, m;</div><div class="line">	<span class="keyword">char</span> str[<span class="number">5000</span>+<span class="number">5</span>];</div><div class="line">	<span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) != EOF) &#123;</div><div class="line">		ACauto.init();</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%s"</span>, str);</div><div class="line">			ACauto.insert(i, str);</div><div class="line">		&#125;</div><div class="line">		ACauto.setFail();</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;m);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%s"</span>, str);</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ACauto.query(i, str));</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"\n"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>AC自动机的玄学博大精深，还可以和dp扯上关系，还是多练题为好</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/主席树原理与基础例题/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          主席树原理与基础例题
        
      </div>
    </a>
  
  
    <a href="/20170710总结/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">20170710总结</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="ds-share share" data-thread-key="AC自动机基础例题" data-title="AC自动机基础例题" data-url="http://yoursite.com/AC自动机基础例题/"  data-images="http://chuantu.biz/t6/89/1507626502x2728279003.jpg" data-content="AC自动机基础例题">
    <div class="ds-share-inline">
      <ul  class="ds-share-icons-16">
      	<li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
        <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
        <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
      </ul>
      <div class="ds-share-icons-more">
      </div>
    </div>
 </div>
 





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2017 Azrael_Death
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
  </script>
  <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  
</footer>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>
<!--
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
-->



  </div>
</body>
</html>